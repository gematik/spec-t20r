<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="516px" preserveAspectRatio="none" style="width:951px;height:516px;background:#FFFFFF;" version="1.1" viewBox="0 0 951 516" width="951px" zoomAndPan="magnify"><defs/><g><g><title>Client</title><rect fill="#FFFFFF" height="425.8594" style="stroke:#181818;stroke-width:1;" width="10" x="27.2651" y="46.2969"/></g><g><title>Envoy (WASM Filter)</title><rect fill="#FFFFFF" height="380.5938" style="stroke:#181818;stroke-width:1;" width="10" x="273.6025" y="82.5625"/></g><g><title>Key Service (HTTP)</title><rect fill="#FFFFFF" height="87.3984" style="stroke:#181818;stroke-width:1;" width="10" x="574.8389" y="153.8281"/></g><g><title>ValKey DB</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="747.8545" y="182.9609"/></g><g><title>Upstream Service</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="870.6816" y="347.625"/></g><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="444.8594" width="8" x="28.2651" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="32" x2="32" y1="36.2969" y2="481.1563"/></g><g><title>Envoy (WASM Filter)</title><rect fill="#000000" fill-opacity="0.00000" height="444.8594" width="8" x="274.6025" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="278.2251" x2="278.2251" y1="36.2969" y2="481.1563"/></g><g><title>Key Service (HTTP)</title><rect fill="#000000" fill-opacity="0.00000" height="444.8594" width="8" x="575.8389" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="578.98" x2="578.98" y1="36.2969" y2="481.1563"/></g><g><title>ValKey DB</title><rect fill="#000000" fill-opacity="0.00000" height="444.8594" width="8" x="748.8545" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="752.3745" x2="752.3745" y1="36.2969" y2="481.1563"/></g><g><title>Upstream Service</title><rect fill="#000000" fill-opacity="0.00000" height="444.8594" width="8" x="871.6816" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="875.3345" x2="875.3345" y1="36.2969" y2="481.1563"/></g><g class="participant participant-head" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.5303" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="12" y="24.9951">Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.5303" x="5" y="480.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="12" y="500.1514">Client</text></g><g class="participant participant-head" data-participant="Envoy"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156.7549" x="200.2251" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142.7549" x="207.2251" y="24.9951">Envoy (WASM Filter)</text></g><g class="participant participant-tail" data-participant="Envoy"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156.7549" x="200.2251" y="480.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142.7549" x="207.2251" y="500.1514">Envoy (WASM Filter)</text></g><g class="participant participant-head" data-participant="KS"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147.7178" x="505.98" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.7178" x="512.98" y="24.9951">Key Service (HTTP)</text></g><g class="participant participant-tail" data-participant="KS"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147.7178" x="505.98" y="480.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.7178" x="512.98" y="500.1514">Key Service (HTTP)</text></g><g class="participant participant-head" data-participant="ValKey"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.96" x="709.3745" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.96" x="716.3745" y="24.9951">ValKey DB</text></g><g class="participant participant-tail" data-participant="ValKey"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.96" x="709.3745" y="480.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.96" x="716.3745" y="500.1514">ValKey DB</text></g><g class="participant participant-head" data-participant="US"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.6943" x="806.3345" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.6943" x="813.3345" y="24.9951">Upstream Service</text></g><g class="participant participant-tail" data-participant="US"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.6943" x="806.3345" y="480.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.6943" x="813.3345" y="500.1514">Upstream Service</text></g><g><title>Client</title><rect fill="#FFFFFF" height="425.8594" style="stroke:#181818;stroke-width:1;" width="10" x="27.2651" y="46.2969"/></g><g><title>Envoy (WASM Filter)</title><rect fill="#FFFFFF" height="380.5938" style="stroke:#181818;stroke-width:1;" width="10" x="273.6025" y="82.5625"/></g><g><title>Key Service (HTTP)</title><rect fill="#FFFFFF" height="87.3984" style="stroke:#181818;stroke-width:1;" width="10" x="574.8389" y="153.8281"/></g><g><title>ValKey DB</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="747.8545" y="182.9609"/></g><g><title>Upstream Service</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="870.6816" y="347.625"/></g><g class="message" data-participant-1="Client" data-participant-2="Envoy"><polygon fill="#181818" points="261.6025,78.5625,271.6025,82.5625,261.6025,86.5625,265.6025,82.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="37.2651" x2="267.6025" y1="82.5625" y2="82.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.271" x="44.2651" y="62.3638">HTTPS Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217.3374" x="44.2651" y="77.4966">(Header: con-id, Encrypted Body)</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Envoy"><line style="stroke:#181818;stroke-width:1;" x1="283.6025" x2="325.6025" y1="111.6953" y2="111.6953"/><line style="stroke:#181818;stroke-width:1;" x1="325.6025" x2="325.6025" y1="111.6953" y2="124.6953"/><line style="stroke:#181818;stroke-width:1;" x1="284.6025" x2="325.6025" y1="124.6953" y2="124.6953"/><polygon fill="#181818" points="294.6025,120.6953,284.6025,124.6953,294.6025,128.6953,290.6025,124.6953" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.8906" x="290.6025" y="106.6294">Read 'con-id' Header</text></g><g class="message" data-participant-1="Envoy" data-participant-2="KS"><polygon fill="#181818" points="562.8389,149.8281,572.8389,153.8281,562.8389,157.8281,566.8389,153.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="283.6025" x2="568.8389" y1="153.8281" y2="153.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.5503" x="290.6025" y="148.7622">GET /keys/{con-id}</text></g><g class="message" data-participant-1="KS" data-participant-2="ValKey"><polygon fill="#181818" points="735.8545,178.9609,745.8545,182.9609,735.8545,186.9609,739.8545,182.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="584.8389" x2="741.8545" y1="182.9609" y2="182.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.0156" x="591.8389" y="177.895">GET key_for:&lt;con-id&gt;</text></g><g class="message" data-participant-1="ValKey" data-participant-2="KS"><polygon fill="#181818" points="595.8389,208.0938,585.8389,212.0938,595.8389,216.0938,591.8389,212.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="589.8389" x2="751.8545" y1="212.0938" y2="212.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.2998" x="601.8389" y="207.0278">Return Key</text></g><g class="message" data-participant-1="KS" data-participant-2="Envoy"><polygon fill="#181818" points="294.6025,237.2266,284.6025,241.2266,294.6025,245.2266,290.6025,241.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="288.6025" x2="578.8389" y1="241.2266" y2="241.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.064" x="300.6025" y="236.1606">Return Key in HTTP Response</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Envoy"><line style="stroke:#181818;stroke-width:1;" x1="283.6025" x2="325.6025" y1="270.3594" y2="270.3594"/><line style="stroke:#181818;stroke-width:1;" x1="325.6025" x2="325.6025" y1="270.3594" y2="283.3594"/><line style="stroke:#181818;stroke-width:1;" x1="284.6025" x2="325.6025" y1="283.3594" y2="283.3594"/><polygon fill="#181818" points="294.6025,279.3594,284.6025,283.3594,294.6025,287.3594,290.6025,283.3594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.6113" x="290.6025" y="265.2935">Decrypt Request Body using Key</text></g><path d="M288,296.3594 L288,321.3594 L461,321.3594 L461,306.3594 L451,296.3594 L288,296.3594" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M451,296.3594 L451,306.3594 L461,306.3594 L451,296.3594" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152.1533" x="294" y="313.4263">Store Key for Response</text><g class="message" data-participant-1="Envoy" data-participant-2="US"><polygon fill="#181818" points="858.6816,343.625,868.6816,347.625,858.6816,351.625,862.6816,347.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="283.6025" x2="864.6816" y1="347.625" y2="347.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.0479" x="290.6025" y="342.5591">Forward Decrypted HTTP Request</text></g><g class="message" data-participant-1="US" data-participant-2="Envoy"><polygon fill="#181818" points="294.6025,372.7578,284.6025,376.7578,294.6025,380.7578,290.6025,376.7578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="288.6025" x2="874.6816" y1="376.7578" y2="376.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.0283" x="300.6025" y="371.6919">HTTP Response (Plaintext Body)</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Envoy"><line style="stroke:#181818;stroke-width:1;" x1="283.6025" x2="325.6025" y1="405.8906" y2="405.8906"/><line style="stroke:#181818;stroke-width:1;" x1="325.6025" x2="325.6025" y1="405.8906" y2="418.8906"/><line style="stroke:#181818;stroke-width:1;" x1="284.6025" x2="325.6025" y1="418.8906" y2="418.8906"/><polygon fill="#181818" points="294.6025,414.8906,284.6025,418.8906,294.6025,422.8906,290.6025,418.8906" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267.2363" x="290.6025" y="400.8247">Encrypt Response Body using stored Key</text></g><g class="message" data-participant-1="Envoy" data-participant-2="Client"><polygon fill="#181818" points="48.2651,459.1563,38.2651,463.1563,48.2651,467.1563,44.2651,463.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="42.2651" x2="277.6025" y1="463.1563" y2="463.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.9004" x="54.2651" y="442.9575">HTTPS Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.3311" x="54.2651" y="458.0903">(Encrypted Body)</text></g><!--SRC=[TP9VIyCm5CNVzoaklgnZbhqNAJYtEIZACAk-21BQknciIKsoQH6_k-bDElVFfpR9xznppqq006gkhIX4pQM5cqgW-t0J_dfm15nCvLOr43rTipkOYSgY7boqFEsVuXasm51lHO4GpPVBXQSpTee-yggb9sCY_EgKocjZDVBthYh1EUiH6TeV3lTMSUfR7WuJQ1jWy80V6pJsMKPpv2Ng10ebOr5UkX25RcgB9OnLsGoe2gb3aSHfUGbzp_V1w_UnZ97HxNG9epTipEZRipy4PInEGyoESj3BIkdaodCfSPw9uzGf88vRMxlH4hg9k3hkpESwF0OXAQNRChMI1izac22bxEP0MM5ZX5pl3EwLHT1Y_Mf1hI3ec5KQoSGrVDOWz-bdIdzoNNP6RfoX9V8ZGNwKuA1dY1OL5zBYb_tt8i9L_MdsKfYsqN8NnWkTNNWUdH_RYTrJEBxwNm00]--></g></svg>