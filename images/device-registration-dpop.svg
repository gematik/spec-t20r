<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="757px" preserveAspectRatio="none" style="width:947px;height:757px;background:#FFFFFF;" version="1.1" viewBox="0 0 947 757" width="947px" zoomAndPan="magnify"><defs/><g><g><title>Client</title><rect fill="#FFFFFF" height="567.7891" style="stroke:#181818;stroke-width:1;" width="10" x="88.1753" y="91.2969"/></g><g><title>App Attestation</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="323.9629" y="499.2891"/></g><g><title>PEP</title><rect fill="#FFFFFF" height="546.6563" style="stroke:#181818;stroke-width:1;" width="10" x="611.9985" y="112.4297"/></g><g><title>IDP</title><rect fill="#FFFFFF" height="197.9297" style="stroke:#181818;stroke-width:1;" width="10" x="911.0786" y="214.9609"/></g><rect fill="none" height="52.2656" style="stroke:#000000;stroke-width:1.5;" width="931.7544" x="10" y="332.4922"/><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="595.7891" width="8" x="32.9551" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="36" x2="36" y1="81.2969" y2="677.0859"/></g><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="595.7891" width="8" x="89.1753" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="92.9102" x2="92.9102" y1="81.2969" y2="677.0859"/></g><g><title>App Attestation</title><rect fill="#000000" fill-opacity="0.00000" height="595.7891" width="8" x="324.9629" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="328.3882" x2="328.3882" y1="81.2969" y2="677.0859"/></g><g><title>PEP</title><rect fill="#000000" fill-opacity="0.00000" height="595.7891" width="8" x="612.9985" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="616.9341" x2="616.9341" y1="81.2969" y2="677.0859"/></g><g><title>Fachdienst</title><rect fill="#000000" fill-opacity="0.00000" height="595.7891" width="8" x="838.2788" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="842.1548" x2="842.1548" y1="81.2969" y2="677.0859"/></g><g><title>IDP</title><rect fill="#000000" fill-opacity="0.00000" height="595.7891" width="8" x="912.0786" y="81.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="915.4028" x2="915.4028" y1="81.2969" y2="677.0859"/></g><g class="participant participant-head" data-participant="u"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="18" y="77.9951">User</text><ellipse cx="36.9551" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M36.9551,21.5 L36.9551,48.5 M23.9551,29.5 L49.9551,29.5 M36.9551,48.5 L23.9551,63.5 M36.9551,48.5 L49.9551,63.5" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="u"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="18" y="689.0811">User</text><ellipse cx="36.9551" cy="700.8828" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M36.9551,708.8828 L36.9551,735.8828 M23.9551,716.8828 L49.9551,716.8828 M36.9551,735.8828 L23.9551,750.8828 M36.9551,735.8828 L49.9551,750.8828" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="c"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.5303" x="65.9102" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="72.9102" y="69.9951">Client</text></g><g class="participant participant-tail" data-participant="c"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.5303" x="65.9102" y="676.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="72.9102" y="696.0811">Client</text></g><g class="participant participant-head" data-participant="aas"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.1494" x="267.3882" y="33.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.1494" x="274.3882" y="53.6982">App Attestation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.7412" x="303.0923" y="69.9951">Service</text></g><g class="participant participant-tail" data-participant="aas"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.1494" x="267.3882" y="676.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.1494" x="274.3882" y="696.0811">App Attestation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.7412" x="303.0923" y="712.3779">Service</text></g><g class="participant participant-head" data-participant="as"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="158.1289" x="537.9341" y="33.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.7305" x="604.1333" y="53.6982">PEP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144.1289" x="544.9341" y="69.9951">Authorization Server</text></g><g class="participant participant-tail" data-participant="as"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="158.1289" x="537.9341" y="676.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.7305" x="604.1333" y="696.0811">PEP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144.1289" x="544.9341" y="712.3779">Authorization Server</text></g><g class="participant participant-head" data-participant="fd"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90.248" x="797.1548" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.248" x="804.1548" y="69.9951">Fachdienst</text></g><g class="participant participant-tail" data-participant="fd"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90.248" x="797.1548" y="676.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.248" x="804.1548" y="696.0811">Fachdienst</text></g><g class="participant participant-head" data-participant="idp"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="37.3516" x="897.4028" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="23.3516" x="904.4028" y="69.9951">IDP</text></g><g class="participant participant-tail" data-participant="idp"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="37.3516" x="897.4028" y="676.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="23.3516" x="904.4028" y="696.0811">IDP</text></g><g><title>Client</title><rect fill="#FFFFFF" height="567.7891" style="stroke:#181818;stroke-width:1;" width="10" x="88.1753" y="91.2969"/></g><g><title>App Attestation</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="323.9629" y="499.2891"/></g><g><title>PEP</title><rect fill="#FFFFFF" height="546.6563" style="stroke:#181818;stroke-width:1;" width="10" x="611.9985" y="112.4297"/></g><g><title>IDP</title><rect fill="#FFFFFF" height="197.9297" style="stroke:#181818;stroke-width:1;" width="10" x="911.0786" y="214.9609"/></g><g class="message" data-participant-1="c" data-participant-2="as"><polygon fill="#181818" points="599.9985,108.4297,609.9985,112.4297,599.9985,116.4297,603.9985,112.4297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="98.1753" x2="605.9985" y1="112.4297" y2="112.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.2319" x="105.1753" y="107.3638">https GET /fd_ressource</text></g><g class="message" data-participant-1="as" data-participant-2="c"><polygon fill="#181818" points="109.1753,152.6953,99.1753,156.6953,109.1753,160.6953,105.1753,156.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="103.1753" x2="610.9985" y1="156.6953" y2="156.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="489.8232" x="115.1753" y="136.4966">401 Unauthorized {"supported_idp_list":[...], "attestation_required": "true",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.5635" x="115.1753" y="151.6294">"DPoP_required": "true"}</text></g><g class="message" data-participant-1="c" data-participant-2="as"><polygon fill="#181818" points="599.9985,181.8281,609.9985,185.8281,599.9985,189.8281,603.9985,185.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="98.1753" x2="605.9985" y1="185.8281" y2="185.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.46" x="105.1753" y="180.7622">GET /register/choosen_idp</text></g><g class="message" data-participant-1="as" data-participant-2="idp"><polygon fill="#181818" points="899.0786,210.9609,909.0786,214.9609,899.0786,218.9609,903.0786,214.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="621.9985" x2="905.0786" y1="214.9609" y2="214.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.3398" x="628.9985" y="209.895">POST /par</text></g><g class="message" data-participant-1="idp" data-participant-2="as"><polygon fill="#181818" points="632.9985,240.0938,622.9985,244.0938,632.9985,248.0938,628.9985,244.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="626.9985" x2="910.0786" y1="244.0938" y2="244.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="638.9985" y="239.0278">200 OK</text></g><g class="message" data-participant-1="as" data-participant-2="c"><polygon fill="#181818" points="109.1753,284.3594,99.1753,288.3594,109.1753,292.3594,105.1753,288.3594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="103.1753" x2="610.9985" y1="288.3594" y2="288.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54.4819" x="115.1753" y="268.1606">Redirect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.9048" x="115.1753" y="283.2935">location: idp_url</text></g><g class="message" data-participant-1="c" data-participant-2="idp"><polygon fill="#181818" points="899.0786,313.4922,909.0786,317.4922,899.0786,321.4922,903.0786,317.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="98.1753" x2="905.0786" y1="317.4922" y2="317.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.0146" x="105.1753" y="312.4263">GET /authorize</text></g><path d="M10,332.4922 L163.8623,332.4922 L163.8623,339.625 L153.8623,349.625 L10,349.625 L10,332.4922" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="52.2656" style="stroke:#000000;stroke-width:1.5;" width="931.7544" x="10" y="332.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108.8623" x="25" y="345.5591">Authentication</text><path d="M20,354.625 L20,379.625 L931,379.625 L931,364.625 L921,354.625 L20,354.625" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M921,354.625 L921,364.625 L931,364.625 L921,354.625" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.0024" x="385.376" y="371.6919">idp specific authentication</text><g class="message" data-participant-1="idp" data-participant-2="c"><polygon fill="#181818" points="109.1753,408.8906,99.1753,412.8906,109.1753,416.8906,105.1753,412.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="103.1753" x2="915.0786" y1="412.8906" y2="412.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269.3311" x="115.1753" y="407.8247">302 Redirect url_with_authorization_code</text></g><g class="message" data-participant-1="c" data-participant-2="c"><line style="stroke:#181818;stroke-width:1;" x1="98.1753" x2="140.1753" y1="442.0234" y2="442.0234"/><line style="stroke:#181818;stroke-width:1;" x1="140.1753" x2="140.1753" y1="442.0234" y2="455.0234"/><line style="stroke:#181818;stroke-width:1;" x1="99.1753" x2="140.1753" y1="455.0234" y2="455.0234"/><polygon fill="#181818" points="109.1753,451.0234,99.1753,455.0234,109.1753,459.0234,105.1753,455.0234" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.4785" x="105.1753" y="436.9575">generate key pair (for DPoP)</text></g><g class="message" data-participant-1="c" data-participant-2="aas"><polygon fill="#181818" points="311.9629,495.2891,321.9629,499.2891,311.9629,503.2891,315.9629,499.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="98.1753" x2="317.9629" y1="499.2891" y2="499.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.7876" x="105.1753" y="479.0903">Request App/Device attestation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.3081" x="105.1753" y="494.2231">Parameter: nonce</text></g><g class="message" data-participant-1="aas" data-participant-2="c"><polygon fill="#181818" points="109.1753,524.4219,99.1753,528.4219,109.1753,532.4219,105.1753,528.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="103.1753" x2="327.9629" y1="528.4219" y2="528.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.8394" x="115.1753" y="523.356">signed_attestation_token</text></g><g class="message" data-participant-1="c" data-participant-2="as"><polygon fill="#181818" points="599.9985,568.6875,609.9985,572.6875,599.9985,576.6875,603.9985,572.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="98.1753" x2="605.9985" y1="572.6875" y2="572.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.1963" x="105.1753" y="552.4888">POST /register</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.4849" x="105.1753" y="567.6216">[signed_attestation_token, jkt]</text></g><g class="message" data-participant-1="as" data-participant-2="as"><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="621.9985" x2="663.9985" y1="616.9531" y2="616.9531"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="663.9985" x2="663.9985" y1="616.9531" y2="629.9531"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="622.9985" x2="663.9985" y1="629.9531" y2="629.9531"/><polygon fill="#181818" points="632.9985,625.9531,622.9985,629.9531,632.9985,633.9531,628.9985,629.9531" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.1162" x="628.9985" y="596.7544">creaate and sign</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.2803" x="628.9985" y="611.8872">jwt device_registration_token</text></g><g class="message" data-participant-1="as" data-participant-2="c"><polygon fill="#181818" points="104.1753,655.0859,94.1753,659.0859,104.1753,663.0859,100.1753,659.0859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="98.1753" x2="615.9985" y1="659.0859" y2="659.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284.1782" x="110.1753" y="654.02">[jwt device_registration_token; includes jkt]</text></g><!--SRC=[VL9DRzim3BthLn0-TSZdkfqye43GTCEmGursFSM58KXCh2QJF8bgiGtxxwFaVBWPDXyCY7paU-IZLEGyH901YeU0lX2Tz6IKwQGbK3b-lJDewNL6SYBb5bq72o8C9CauMzjxzCz6uHcw1rStLMqNaLhdpS-CXmG_PrthZFueLQkPEPnH6ztb_ETbLGYXO3HA_ybL2ev6K49Br0NuTFCLPclTU0p1HQzGS7x2C5N2-_bRUB1ohmGr_2f2x3hd2NN3_PkTOTPoDPrE7yTGoDE0tEvxD1vrKK91Fc8nhcsnh5prT-RtKLVPg_6uuRxePwfrBg1DL5dLLHugYwzkxnd9yueKckpBB-TpkFqocE0EDNCfgktEgQoiJ3sQw7TxLdxjQOzpYertaVtYDnjg-Ze1_5b728wTW3ZkAnDxw52PjU4hU5s1LaDkTTJ8Z9CItiqlZyA0bJGlXjf63WrlbDFO2-GfDcZHIwRUuW_efF5miUPpJEjySrZUmTKxNY-x07nnioMc6mCvFBnAUlaDURibJsEJtQTj1REnxEpGHt9Rj4AZL6IUamI63_pgRJWOLjlLlrgCuMbBZmTdKgdoA7D3tbAggktJ2u7Eafk-enzgECbS_HVu0OnLkwWnz9H3xInT30DA_040]--></g></svg>