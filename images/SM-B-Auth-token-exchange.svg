<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="3011px" preserveAspectRatio="none" style="width:1604px;height:3011px;background:#FFFFFF;" version="1.1" viewBox="0 0 1604 3011" width="1604px" zoomAndPan="magnify"><defs/><g><rect fill="#F8F8FF" height="2999.1094" style="stroke:#181818;stroke-width:0.5;" width="685.0078" x="150.1621" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="484.2041" y="15.2822">LEI</text><rect fill="#E6E6FA" height="2982.4688" style="stroke:#181818;stroke-width:0.5;" width="468.9233" x="150.1621" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="345.5271" y="31.9229">Prim&#228;rsystem</text><rect fill="#F4A460" height="2965.8281" style="stroke:#181818;stroke-width:0.5;" width="89" x="150.1621" y="39.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="162.1621" y="48.5635">ZETA Client</text><rect fill="#C9FFC9" height="2999.1094" style="stroke:#181818;stroke-width:0.5;" width="715.479" x="847.1699" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1180.5491" y="15.2822">Anbieter</text><rect fill="#F4A460" height="2982.4688" style="stroke:#181818;stroke-width:0.5;" width="598.979" x="847.1699" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1113.5149" y="31.9229">ZETA Guard</text><rect fill="#8FBC8F" height="2982.4688" style="stroke:#181818;stroke-width:0.5;" width="104.5" x="1458.1489" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1472.8672" y="31.9229">TI 2.0 Dienst</text><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="2800.9063" width="8" x="39.5" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="43" x2="43" y1="126.5625" y2="2927.4688"/></g><g><title>ZETA</title><rect fill="#000000" fill-opacity="0.00000" height="2800.9063" width="8" x="191.1621" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="194.6621" x2="194.6621" y1="126.5625" y2="2927.4688"/></g><g><title/><rect fill="#FFFFFF" height="2733.9844" style="stroke:#181818;stroke-width:1;" width="10" x="189.6621" y="175.4844"/></g><g><title>TPM</title><rect fill="#000000" fill-opacity="0.00000" height="2800.9063" width="8" x="585.9639" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="589.4639" x2="589.4639" y1="126.5625" y2="2927.4688"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="584.4639" y="741.9375"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="584.4639" y="1539.2344"/></g><g><title>Konnektor or</title><rect fill="#000000" fill-opacity="0.00000" height="2800.9063" width="8" x="671.0122" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="674.5122" x2="674.5122" y1="126.5625" y2="2927.4688"/></g><g><title/><rect fill="#FFFFFF" height="76.9219" style="stroke:#181818;stroke-width:1;" width="10" x="669.5122" y="1176.9063"/></g><g><title>SM(C)-B</title><rect fill="#000000" fill-opacity="0.00000" height="2800.9063" width="8" x="800.5552" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="804.0552" x2="804.0552" y1="126.5625" y2="2927.4688"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="799.0552" y="1202.5469"/></g><g><title>PEP</title><rect fill="#000000" fill-opacity="0.00000" height="2800.9063" width="8" x="880.5708" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="884.0708" x2="884.0708" y1="126.5625" y2="2927.4688"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="879.0708" y="268.4063"/></g><g><title/><rect fill="#FFFFFF" height="239.4063" style="stroke:#181818;stroke-width:1;" width="10" x="879.0708" y="2670.0625"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="2800.9063" width="8" x="1101.7104" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1105.2104" x2="1105.2104" y1="126.5625" y2="2927.4688"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="1100.2104" y="319.6875"/></g><g><title/><rect fill="#FFFFFF" height="2063.6875" style="stroke:#181818;stroke-width:1;" width="10" x="1100.2104" y="518.8125"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="2800.9063" width="8" x="1398.3628" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1401.8628" x2="1401.8628" y1="126.5625" y2="2927.4688"/></g><g><title/><rect fill="#FFFFFF" height="37.2813" style="stroke:#181818;stroke-width:1;" width="10" x="1396.8628" y="2469.2969"/></g><g><title>Resource Server</title><rect fill="#000000" fill-opacity="0.00000" height="2800.9063" width="8" x="1506.8989" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1510.3989" x2="1510.3989" y1="126.5625" y2="2927.4688"/></g><g><title/><rect fill="#FFFFFF" height="87.5625" style="stroke:#181818;stroke-width:1;" width="10" x="1505.3989" y="2796.2656"/></g><text fill="#000000" font-family="Helvetica" font-size="10" x="28.6035" y="124.2041">User</text><ellipse cx="43" cy="63.4219" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M43,71.4219 L43,98.4219 M30,79.4219 L56,79.4219 M43,98.4219 L30,113.4219 M43,98.4219 L56,113.4219" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="173.187" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="181.603" y="104.5635">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="180.187" y="116.2041">Client</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="572.0806" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="579.0806" y="116.2041">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="635.0854" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="642.0854" y="104.5635">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="646.0918" y="116.2041">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="776.9404" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="783.9404" y="116.2041">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.8018" x="851.1699" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="874.8813" y="104.5635">PEP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="858.1699" y="116.2041">http Proxy</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="1046.7358" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1095.3301" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1053.7358" y="116.2041">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1361.5767" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1391.9824" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1368.5767" y="116.2041">Policy Engine</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.5" x="1462.1489" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1469.1489" y="116.2041">Resource Server</text><text fill="#000000" font-family="Helvetica" font-size="10" x="28.6035" y="2996.751">User</text><ellipse cx="43" cy="2935.9688" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M43,2943.9688 L43,2970.9688 M30,2951.9688 L56,2951.9688 M43,2970.9688 L30,2985.9688 M43,2970.9688 L56,2985.9688" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="173.187" y="2927.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="181.603" y="2943.751">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="180.187" y="2955.3916">Client</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="572.0806" y="2927.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="579.0806" y="2943.751">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="635.0854" y="2927.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="642.0854" y="2943.751">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="646.0918" y="2955.3916">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="776.9404" y="2927.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="783.9404" y="2943.751">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.8018" x="851.1699" y="2927.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="874.8813" y="2943.751">PEP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="858.1699" y="2955.3916">http Proxy</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="1046.7358" y="2927.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1095.3301" y="2943.751">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1053.7358" y="2955.3916">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1361.5767" y="2927.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1391.9824" y="2943.751">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1368.5767" y="2955.3916">Policy Engine</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.5" x="1462.1489" y="2927.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1469.1489" y="2943.751">Resource Server</text><polygon fill="#181818" points="177.6621,171.4844,187.6621,175.4844,177.6621,179.4844,181.6621,175.4844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="43" x2="183.6621" y1="175.4844" y2="175.4844"/><text fill="#000000" font-family="Helvetica" font-size="10" x="50" y="159.4854">(01)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="147.8447">User wants to</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="159.4854">access resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="171.126">on Resource Server</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="202.3047"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="202.3047" y2="202.3047"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="205.3047" y2="205.3047"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="72.7109" x="764.9534" y="193.4844"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="770.9534" y="206.7666">Discovery</text><path d="M178.6621,227.125 L507.2998,227.125 L507.2998,230.7656 L497.2998,240.7656 L178.6621,240.7656 L178.6621,227.125" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="192.7656" style="stroke:#000000;stroke-width:1.5;" width="947.5483" x="178.6621" y="227.125"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="237.4072">ZETA Client has Resource Server FQDN (RS-FQDN)</text><polygon fill="#181818" points="867.0708,264.4063,877.0708,268.4063,867.0708,272.4063,871.0708,268.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="873.0708" y1="268.4063" y2="268.4063"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="264.0479">(02)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="264.0479">GET /.well-known/oauth-protected-resource Host: RS-FQDN</text><polygon fill="#181818" points="210.6621,290.0469,200.6621,294.0469,210.6621,298.0469,206.6621,294.0469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="878.0708" y1="294.0469" y2="294.0469"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="289.6885">(03)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="289.6885">Client: 200 OK; json body with Well-Known json Document (RFC draft-ietf-oauth-resource-metadata)</text><polygon fill="#181818" points="1088.2104,315.6875,1098.2104,319.6875,1088.2104,323.6875,1092.2104,319.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1094.2104" y1="319.6875" y2="319.6875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="315.3291">(04)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="315.3291">GET /.well-known/oauth-authorization-server&#160;Host: AuthS-FQDN</text><polygon fill="#181818" points="210.6621,341.3281,200.6621,345.3281,210.6621,349.3281,206.6621,345.3281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1099.2104" y1="345.3281" y2="345.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="340.9697">(05)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="340.9697">200 OK; json body with Well-Known json Document (RFC8414)</text><path d="M204.6621,358.3281 L204.6621,414.3281 L535.6621,414.3281 L535.6621,368.3281 L525.6621,358.3281 L204.6621,358.3281" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M525.6621,358.3281 L525.6621,368.3281 L535.6621,368.3281 L525.6621,358.3281" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="372.6104">Offene Fragen:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="384.251">- Werden die Well-known JSON Dokumente signiert?</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="395.8916">- Wenn ja, welches Zertifikat wird f&#252;r die Signatur verwendet?</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="407.5322">- Wie wird die Signatur &#252;berpr&#252;ft?</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="452.7109"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="452.7109" y2="452.7109"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="455.7109" y2="455.7109"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="175.46" x="713.5789" y="443.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="719.5789" y="457.1729">Dynamic Client Registration</text><path d="M178.6621,477.5313 L238.6182,477.5313 L238.6182,481.1719 L228.6182,491.1719 L178.6621,491.1719 L178.6621,477.5313" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="74.9219" style="stroke:#000000;stroke-width:1.5;" width="947.5483" x="178.6621" y="477.5313"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="487.8135">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.6182" y="488.8135">[Client has no client_id]</text><polygon fill="#181818" points="1088.2104,514.8125,1098.2104,518.8125,1088.2104,522.8125,1092.2104,518.8125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1094.2104" y1="518.8125" y2="518.8125"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="514.4541">(06)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="514.4541">POST /register (RFC7591)</text><polygon fill="#181818" points="210.6621,540.4531,200.6621,544.4531,210.6621,548.4531,206.6621,544.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1099.2104" y1="544.4531" y2="544.4531"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="540.0947">(07)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="540.0947">Client Information Response with client_id (RFC7591)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="585.2734"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="585.2734" y2="585.2734"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="588.2734" y2="588.2734"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="104.7813" x="748.9182" y="576.4531"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="754.9182" y="589.7354">Key Generation</text><path d="M8,610.0938 L67.9561,610.0938 L67.9561,613.7344 L57.9561,623.7344 L8,623.7344 L8,610.0938" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="247.7656" style="stroke:#000000;stroke-width:1.5;" width="627.4639" x="8" y="610.0938"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="23" y="620.376">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="82.9561" y="621.376">[Client has no Client Attestation Key Pair]</text><path d="M27,637.7344 L86.9561,637.7344 L86.9561,641.375 L76.9561,651.375 L27,651.375 L27,637.7344" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="206.125" style="stroke:#000000;stroke-width:1.5;" width="583.4639" x="27" y="637.7344"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="42" y="648.0166">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="101.9561" y="649.0166">[Client uses TPM]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="27" x2="610.4639" y1="786.5781" y2="786.5781"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="32" y="797.8604">[Client uses self signed Attestation Key (deprecated)]</text><polygon fill="#181818" points="54,686.6563,44,690.6563,54,694.6563,50,690.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="48" x2="188.6621" y1="690.6563" y2="690.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="60" y="680.4775">(08)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.5273" y="674.6572">Obtain Admin</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.5273" y="686.2979">access to TPM</text><polygon fill="#181818" points="177.6621,712.2969,187.6621,716.2969,177.6621,720.2969,181.6621,716.2969" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="43" x2="183.6621" y1="716.2969" y2="716.2969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="50" y="711.9385">(09)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="711.9385">TPM Admin access</text><polygon fill="#181818" points="572.4639,737.9375,582.4639,741.9375,572.4639,745.9375,576.4639,741.9375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="578.4639" y1="741.9375" y2="741.9375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="737.5791">(10)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="737.5791">Create Client Attestation Key Pair in TPM</text><polygon fill="#181818" points="210.6621,763.5781,200.6621,767.5781,210.6621,771.5781,206.6621,767.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="583.4639" y1="767.5781" y2="767.5781"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="763.2197">(11)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="763.2197">Public Attestation Key</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="822.8594" y2="822.8594"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="822.8594" y2="835.8594"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="835.8594" y2="835.8594"/><polygon fill="#181818" points="210.6621,831.8594,200.6621,835.8594,210.6621,839.8594,206.6621,835.8594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="818.501">(12)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="818.501">Create self signed Client Attestation Key Pair</text><path d="M178.6621,875.8594 L238.6182,875.8594 L238.6182,879.5 L228.6182,889.5 L178.6621,889.5 L178.6621,875.8594" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="62.2813" style="stroke:#000000;stroke-width:1.5;" width="312.1816" x="178.6621" y="875.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="886.1416">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.6182" y="887.1416">[Client has no Client Instance Key Pair]</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="917.1406" y2="917.1406"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="917.1406" y2="930.1406"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="930.1406" y2="930.1406"/><polygon fill="#181818" points="210.6621,926.1406,200.6621,930.1406,210.6621,934.1406,206.6621,930.1406" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="912.7822">(13)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="912.7822">Create Client Instance Key Pair</text><path d="M12.6035,956.1406 L72.5596,956.1406 L72.5596,959.7813 L62.5596,969.7813 L12.6035,969.7813 L12.6035,956.1406" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1481.5156" style="stroke:#000000;stroke-width:1.5;" width="1371.1577" x="12.6035" y="956.1406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="27.6035" y="966.4229">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="87.5596" y="967.4229">[Client has no valid refresh token]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="12.6035" x2="1383.7612" y1="2202.8906" y2="2202.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="17.6035" y="2214.1729">[Client has valid Refresh token]</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="998.6016"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="998.6016" y2="998.6016"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="1001.6016" y2="1001.6016"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="117.9746" x="742.3215" y="989.7813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="748.3215" y="1003.0635">Token Generation</text><path d="M178.6621,1023.4219 L373.6084,1023.4219 L373.6084,1027.0625 L363.6084,1037.0625 L178.6621,1037.0625 L178.6621,1023.4219" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="277.0469" style="stroke:#000000;stroke-width:1.5;" width="646.3931" x="178.6621" y="1023.4219"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="1033.7041">SM(C)-B Access Token JWT</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1064.7031" y2="1064.7031"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1064.7031" y2="1077.7031"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1077.7031" y2="1077.7031"/><polygon fill="#181818" points="210.6621,1073.7031,200.6621,1077.7031,210.6621,1081.7031,206.6621,1077.7031" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1060.3447">(14)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1060.3447">generate DPoP key pair</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1138.2656" y2="1138.2656"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1138.2656" y2="1151.2656"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1151.2656" y2="1151.2656"/><polygon fill="#181818" points="210.6621,1147.2656,200.6621,1151.2656,210.6621,1155.2656,206.6621,1151.2656" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1116.4463">(15)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1098.9854">Generate SM(C)-B Access Token JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1110.626">("typ": "JWT", "alg": "ES256"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1122.2666">"sub": "telematik_id",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1133.9072">"scope": "RS specific scopes" "cnf": with public Client Attestation Key)</text><polygon fill="#181818" points="657.5122,1172.9063,667.5122,1176.9063,657.5122,1180.9063,661.5122,1176.9063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="663.5122" y1="1176.9063" y2="1176.9063"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1172.5479">(16)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1172.5479">externalAuthenticate SM(C)-B Access Token JWT-hash</text><polygon fill="#181818" points="787.0552,1198.5469,797.0552,1202.5469,787.0552,1206.5469,791.0552,1202.5469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="679.5122" x2="793.0552" y1="1202.5469" y2="1202.5469"/><text fill="#000000" font-family="Helvetica" font-size="10" x="686.5122" y="1198.1885">(17)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="711.0396" y="1198.1885">sign JWT-hash</text><polygon fill="#181818" points="690.5122,1224.1875,680.5122,1228.1875,690.5122,1232.1875,686.5122,1228.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="684.5122" x2="798.0552" y1="1228.1875" y2="1228.1875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="696.5122" y="1223.8291">(18)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="721.0396" y="1223.8291">JWT-Signature</text><polygon fill="#181818" points="210.6621,1249.8281,200.6621,1253.8281,210.6621,1257.8281,206.6621,1253.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="204.6621" x2="668.5122" y1="1253.8281" y2="1253.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1249.4697">(19)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1249.4697">JWT-Signature</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1279.4688" y2="1279.4688"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1279.4688" y2="1292.4688"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1292.4688" y2="1292.4688"/><polygon fill="#181818" points="210.6621,1288.4688,200.6621,1292.4688,210.6621,1296.4688,206.6621,1292.4688" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1275.1104">(20)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1275.1104">Add JWT-Signature to SM(C)-B Access Token</text><path d="M159.6621,1318.4688 L329.833,1318.4688 L329.833,1322.1094 L319.833,1332.1094 L159.6621,1332.1094 L159.6621,1318.4688" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="336.6875" style="stroke:#000000;stroke-width:1.5;" width="475.8018" x="159.6621" y="1318.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="174.6621" y="1328.751">Client Attestation JWT</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1383.0313" y2="1383.0313"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1383.0313" y2="1396.0313"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1396.0313" y2="1396.0313"/><polygon fill="#181818" points="210.6621,1392.0313,200.6621,1396.0313,210.6621,1400.0313,206.6621,1396.0313" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1367.0322">(21)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1355.3916">Generate Client Attestation JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1367.0322">("typ": "oauth-client-attestation+jwt", "alg": "ES256"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1378.6729">"sub": "client_id", "cnf" with public Client Instance Key)</text><path d="M178.6621,1408.0313 L238.6182,1408.0313 L238.6182,1411.6719 L228.6182,1421.6719 L178.6621,1421.6719 L178.6621,1408.0313" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="233.125" style="stroke:#000000;stroke-width:1.5;" width="431.8018" x="178.6621" y="1408.0313"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="1418.3135">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.6182" y="1419.3135">[Client uses TPM]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="178.6621" x2="610.4639" y1="1583.875" y2="1583.875"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="183.6621" y="1595.1572">[Client uses self signed Attestation Key (deprecated)]</text><polygon fill="#181818" points="577.4639,1445.3125,587.4639,1449.3125,577.4639,1453.3125,581.4639,1449.3125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="583.4639" y1="1449.3125" y2="1449.3125"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1444.9541">(22)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1444.9541">Get TPM evidence</text><polygon fill="#181818" points="210.6621,1470.9531,200.6621,1474.9531,210.6621,1478.9531,206.6621,1474.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="588.4639" y1="1474.9531" y2="1474.9531"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1470.5947">(23)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1470.5947">TPM2B_ATTEST Objekt and TPM EK certificate chain</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1500.5938" y2="1500.5938"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1500.5938" y2="1513.5938"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1513.5938" y2="1513.5938"/><polygon fill="#181818" points="210.6621,1509.5938,200.6621,1513.5938,210.6621,1517.5938,206.6621,1513.5938" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1496.2354">(24)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1496.2354">Add TPM evidence to Client Attestation JWT</text><polygon fill="#181818" points="572.4639,1535.2344,582.4639,1539.2344,572.4639,1543.2344,576.4639,1539.2344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="578.4639" y1="1539.2344" y2="1539.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1534.876">(25)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1534.876">Sign Client Attestation JWT with Client Attestation Key</text><polygon fill="#181818" points="210.6621,1560.875,200.6621,1564.875,210.6621,1568.875,206.6621,1564.875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="583.4639" y1="1564.875" y2="1564.875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1560.5166">(26)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1560.5166">Client Attestation JWT Signature</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1620.1563" y2="1620.1563"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1620.1563" y2="1633.1563"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1633.1563" y2="1633.1563"/><polygon fill="#181818" points="210.6621,1629.1563,200.6621,1633.1563,210.6621,1637.1563,206.6621,1633.1563" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1615.7979">(27)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1615.7979">Sign Client Attestation JWT with Client Key</text><path d="M178.6621,1673.1563 L431.6602,1673.1563 L431.6602,1676.7969 L421.6602,1686.7969 L178.6621,1686.7969 L178.6621,1673.1563" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="187.125" style="stroke:#000000;stroke-width:1.5;" width="942.5483" x="178.6621" y="1673.1563"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="1683.4385">Client Attestation PoP and DPoP JWT</text><polygon fill="#181818" points="1088.2104,1710.4375,1098.2104,1714.4375,1088.2104,1718.4375,1092.2104,1714.4375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1094.2104" y1="1714.4375" y2="1714.4375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1710.0791">(28)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1710.0791">GET /nonce</text><polygon fill="#181818" points="210.6621,1736.0781,200.6621,1740.0781,210.6621,1744.0781,206.6621,1740.0781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1099.2104" y1="1740.0781" y2="1740.0781"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1735.7197">(29)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1735.7197">return 200 OK new-nonce: nonce</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1789" y2="1789"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1789" y2="1802"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1802" y2="1802"/><polygon fill="#181818" points="210.6621,1798,200.6621,1802,210.6621,1806,206.6621,1802" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1773.001">(30)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1761.3604">Generate Client Attestation PoP JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1773.001">("typ": "oauth-client-attestation-pop+jwt", "nonce"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1784.6416">sign with the private Client Instance Key)</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1839.2813" y2="1839.2813"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1839.2813" y2="1852.2813"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1852.2813" y2="1852.2813"/><polygon fill="#181818" points="210.6621,1848.2813,200.6621,1852.2813,210.6621,1856.2813,206.6621,1852.2813" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1829.1025">(31)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1823.2822">Generate DPoP JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1834.9229">("nonce", sign with the private DPoP Key)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="1893.1016"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="1893.1016" y2="1893.1016"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="1896.1016" y2="1896.1016"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="109.3418" x="746.6379" y="1884.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="752.6379" y="1897.5635">Token Exchange</text><polygon fill="#181818" points="1088.2104,2032.3281,1098.2104,2036.3281,1088.2104,2040.3281,1092.2104,2036.3281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1094.2104" y1="2036.3281" y2="2036.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1979.5869">(32)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1927.2041">POST /token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1938.8447">POST /token HTTP/1.1</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1950.4854">Host: auths.example.com</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1962.126">Content-Type: application/x-www-form-urlencoded</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1973.7666">OAuth-Client-Attestation: &lt;Base64url-kodiertes Client Attestation JWT&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1985.4072">OAuth-Client-Attestation-PoP: &lt;Base64url-kodiertes Client Attestation PoP JWT&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1997.0479">grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange&amp;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2008.6885">subject_token=&lt;SM(C)-B Access Token JWT&gt;&amp;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2020.3291">subject_token_type=urn%3Aexample%3Asmc-b-jwt&amp;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2031.9697">audience=https%3A%2F%2Fbackend.example.com%2Fapi</text><path d="M833.8149,2049.3281 L833.8149,2070.3281 L1099.8149,2070.3281 L1099.8149,2059.3281 L1089.8149,2049.3281 L833.8149,2049.3281" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1089.8149,2049.3281 L1089.8149,2059.3281 L1099.8149,2059.3281 L1089.8149,2049.3281" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="839.8149" y="2063.6104">RFC7523 (JWT Client Assertion), RFC9449 (DPoP)</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2093.6094" y2="2093.6094"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2093.6094" y2="2106.6094"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2106.6094" y2="2106.6094"/><polygon fill="#181818" points="1121.2104,2102.6094,1111.2104,2106.6094,1121.2104,2110.6094,1117.2104,2106.6094" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2089.251">(33)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2089.251">verify SM(C)-B Access Token JWT</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2132.25" y2="2132.25"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2132.25" y2="2145.25"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2145.25" y2="2145.25"/><polygon fill="#181818" points="1121.2104,2141.25,1111.2104,2145.25,1121.2104,2149.25,1117.2104,2145.25" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2127.8916">(34)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2127.8916">verify Client Attestation JWT and PoP JWT</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2170.8906" y2="2170.8906"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2170.8906" y2="2183.8906"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2183.8906" y2="2183.8906"/><polygon fill="#181818" points="1121.2104,2179.8906,1111.2104,2183.8906,1121.2104,2187.8906,1117.2104,2183.8906" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2166.5322">(35)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2166.5322">Create state for Session, Identity and Client</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="2240.3516"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="2240.3516" y2="2240.3516"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="2243.3516" y2="2243.3516"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="156.4414" x="723.0881" y="2231.5313"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="729.0881" y="2244.8135">Refresh Token Exchange</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="2278.8125" y2="2278.8125"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="2278.8125" y2="2291.8125"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="2291.8125" y2="2291.8125"/><polygon fill="#181818" points="210.6621,2287.8125,200.6621,2291.8125,210.6621,2295.8125,206.6621,2291.8125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2274.4541">(36)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2274.4541">create DPoP JWT without nonce</text><polygon fill="#181818" points="1088.2104,2348.375,1098.2104,2352.375,1088.2104,2356.375,1092.2104,2352.375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1094.2104" y1="2352.375" y2="2352.375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2330.5557">(37)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2313.0947">POST /token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2324.7354">DPoP: ... (DPoP JWT)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2336.376">grant_type=refresh_token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2348.0166">refresh_token= ... (Refresh token)</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2378.0156" y2="2378.0156"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2378.0156" y2="2391.0156"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2391.0156" y2="2391.0156"/><polygon fill="#181818" points="1121.2104,2387.0156,1111.2104,2391.0156,1121.2104,2395.0156,1117.2104,2391.0156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2373.6572">(38)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2373.6572">verify Refresh token and DPoP JWT</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2416.6563" y2="2416.6563"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2416.6563" y2="2429.6563"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2429.6563" y2="2429.6563"/><polygon fill="#181818" points="1121.2104,2425.6563,1111.2104,2429.6563,1121.2104,2433.6563,1117.2104,2429.6563" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2412.2979">(39)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2412.2979">invalidate Refresh token</text><polygon fill="#181818" points="1384.8628,2465.2969,1394.8628,2469.2969,1384.8628,2473.2969,1388.8628,2469.2969" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1390.8628" y1="2469.2969" y2="2469.2969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2464.9385">(40)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2464.9385">POST /v1/data/authz, json body {  "input": {...}}</text><polygon fill="#181818" points="1121.2104,2502.5781,1111.2104,2506.5781,1121.2104,2510.5781,1117.2104,2506.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1115.2104" x2="1395.8628" y1="2506.5781" y2="2506.5781"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1127.2104" y="2496.3994">(41)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1151.7378" y="2490.5791">200 OK, json body {"result": {"allow": true,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1151.7378" y="2502.2197">"access_token_attributes": {...}}</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2543.8594" y2="2543.8594"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2543.8594" y2="2556.8594"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2556.8594" y2="2556.8594"/><polygon fill="#181818" points="1121.2104,2552.8594,1111.2104,2556.8594,1121.2104,2560.8594,1117.2104,2556.8594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2533.6807">(42)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2527.8604">issue Access and Refresh token with DPoP Binding</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1148.0952" y="2539.501">and Access token attributes</text><polygon fill="#181818" points="210.6621,2578.5,200.6621,2582.5,210.6621,2586.5,206.6621,2582.5" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1099.2104" y1="2582.5" y2="2582.5"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="2578.1416">(43)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="2578.1416">200 OK, Access token, Refresh token, bound to DPoP</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="2608.1406" y2="2608.1406"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="2608.1406" y2="2621.1406"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="2621.1406" y2="2621.1406"/><polygon fill="#181818" points="210.6621,2617.1406,200.6621,2621.1406,210.6621,2625.1406,206.6621,2621.1406" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2603.7822">(44)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2603.7822">Create DPoP Proof for RS</text><polygon fill="#181818" points="867.0708,2666.0625,877.0708,2670.0625,867.0708,2674.0625,871.0708,2670.0625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="873.0708" y1="2670.0625" y2="2670.0625"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2654.0635">(45)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2642.4229">GET /resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2654.0635">Authorization: DPoP ... (Accesss token)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2665.7041">DPoP: ... (DPoP token)</text><line style="stroke:#181818;stroke-width:1;" x1="889.0708" x2="931.0708" y1="2695.7031" y2="2695.7031"/><line style="stroke:#181818;stroke-width:1;" x1="931.0708" x2="931.0708" y1="2695.7031" y2="2708.7031"/><line style="stroke:#181818;stroke-width:1;" x1="890.0708" x2="931.0708" y1="2708.7031" y2="2708.7031"/><polygon fill="#181818" points="900.0708,2704.7031,890.0708,2708.7031,900.0708,2712.7031,896.0708,2708.7031" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="896.0708" y="2691.3447">(46)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.5981" y="2691.3447">verify Access token and DPoP Proof</text><line style="stroke:#181818;stroke-width:1;" x1="889.0708" x2="931.0708" y1="2745.9844" y2="2745.9844"/><line style="stroke:#181818;stroke-width:1;" x1="931.0708" x2="931.0708" y1="2745.9844" y2="2758.9844"/><line style="stroke:#181818;stroke-width:1;" x1="890.0708" x2="931.0708" y1="2758.9844" y2="2758.9844"/><polygon fill="#181818" points="900.0708,2754.9844,890.0708,2758.9844,900.0708,2762.9844,896.0708,2758.9844" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="896.0708" y="2735.8057">(47)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.5981" y="2729.9854">additional checks according to</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.5981" y="2741.626">Access token attributes</text><polygon fill="#181818" points="1493.3989,2792.2656,1503.3989,2796.2656,1493.3989,2800.2656,1497.3989,2796.2656" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="889.0708" x2="1499.3989" y1="2796.2656" y2="2796.2656"/><text fill="#000000" font-family="Helvetica" font-size="10" x="896.0708" y="2786.0869">(48)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.5981" y="2780.2666">forward GET /resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.5981" y="2791.9072">with header and header content as json</text><line style="stroke:#181818;stroke-width:1;" x1="1515.3989" x2="1557.3989" y1="2845.1875" y2="2845.1875"/><line style="stroke:#181818;stroke-width:1;" x1="1557.3989" x2="1557.3989" y1="2845.1875" y2="2858.1875"/><line style="stroke:#181818;stroke-width:1;" x1="1516.3989" x2="1557.3989" y1="2858.1875" y2="2858.1875"/><polygon fill="#181818" points="1526.3989,2854.1875,1516.3989,2858.1875,1526.3989,2862.1875,1522.3989,2858.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1522.3989" y="2829.1885">(49)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1546.9263" y="2817.5479">provide</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1546.9263" y="2829.1885">resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1546.9263" y="2840.8291">access</text><polygon fill="#181818" points="900.0708,2879.8281,890.0708,2883.8281,900.0708,2887.8281,896.0708,2883.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="894.0708" x2="1504.3989" y1="2883.8281" y2="2883.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="906.0708" y="2879.4697">(50)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="930.5981" y="2879.4697">200 OK, resource</text><polygon fill="#181818" points="210.6621,2905.4688,200.6621,2909.4688,210.6621,2913.4688,206.6621,2909.4688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="878.0708" y1="2909.4688" y2="2909.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="2905.1104">(51)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="2905.1104">200 OK, resource</text><!--SRC=[fLZhSkEs5VxFfpXL9etjYhx5IRjgl1tPbYzxCskfizECPtOWyaZYYW8u86XPcycxz4SUOtzbNwpd0AH4IgBZRcUyAm8uz_FXu00YDqhcio5gQEqS7kwsl6mQorHeCOC8Ho9FpAMIfXz_GZWwtBxuJimGhZ5vG1E7ea9puMZUAgcoL8GOBQdFLQvZr1NQ1ENOJBhHnpmp89L4p_jJgiLu9i2W-WH6vpJL3OtIyA-CM8Vg4LflUZSj-EPgeZBpVX8Rz03iVA3ZsPVVTBR83Cw8ueruG1aH5q11yNDlq8Np94PfQBqlPBGuqsekBGK06KNEnAcGfg02aJckUrcmML8IomAzTQP1yDPoq2yJhiYgHA-Lb3XbbvXqDLBwNWvk_2jXS2uMhJMk_jipIzz_ktE-wv-rl5AuYqbN3cCqgCcjGU_y-jtjczkhVtjLjwzoeQDDhwiwhWEh8kW5zt9YJ0g1Le-BrWPTDpUJlYEz858UAXr_4YPM4lge7zYE3QwWjs89L1A72-Z9SIon7Yfdy-06ZlSFuO9YJj3uvaBeQH_5bKRSbgmxPyqTPWIn44iRQhbQnek11FxB8iCT2ooOavWCZBgN8Wmnoq0Niku9bh0cs1EXYHyeJuKCppiz9LEpKD7Y0avFFM-iLPv21Mym8GlNvC3bFo_UmSvTt-UFNJAte2NhheCENFK6SB0_noJnfv8ITg04XTfFjJ8O6epyqaYufhtGWK8GoLaQU1tGYFBgLnmkVuyF3-7szT_XOqOk3bMqW7bi9l2UzRrcVMxbGeNvZAtQkRiyXqYBaV49QoFVMLFQuC_GY4WOmNv4MBTWvPV5JgDheWebFxDH-lq_pZlBkU6WdQK9Xycgcr_ZtjzEZaxMx2yLq9-ak8EEnnC3QbJcdZ5sEngXHBYaqeMoOwTyKgGZb135w7HQF-5L__OTwPnQdGXPF9PK4yq_baoIx19jeD244ypWPrgCH_5K639VHp3wybbRcNtY52RNG26QSvrRoQ1LIriZ-_APwdsgltmUMKBU3koFnnl30NWXnImEorpTuJZEZ7QRcY0j4bE5ibGGsj67cDYtP3YuxLEAjPL2KEVe_lM75qUxpqjU8Uv6ZfIUEHjeywHAPkZIk5HUaLnwyXeNS4K9MHc_nVfYr3K6C-C8cIyGCHyO5VeyepHGHRVHNRd9PQC3jqCZOWdTQ1RBPUqmQadlYat5CJuYB3KuuZMfj4pEQrmLbwqM0l6NAfRHB2TOHLLba0-fsgxBiQGLd3jkJ3AiEPvXCh8enMZ3afq8KuqXSKUxQtuiy-XSgKfvEl2SG_xNcB0REX24f9fNOMhKsyXZeRAfuq4aX2YD8wfg4yhZb8uRHjI0lzOn1U2gV74aGzTbtz6-UZ_m6c8oTc8GBW8Lm9HCIjca1kgzlQkIladHtjwzt6cPHThgG8l6hJQqH3BcKQz__CEFhNlPol8XZmqcoFjfIZkdrURvKAN8AtI6PYc6L6j2i9DP2rgX7D6QtN2fGz7sxAsdVzdLT00VQVjBaV0UfzKuVCeJd_8mgQDwASfEhzebqa8zKSUYge6Lrkq4zqvrevY-h8oulXDAjfgkCXrFSjPjtSnbDuhg0hXKR8j5iH6M4DiITGRO7o9cEryDB-xWTUNK5ol2ltoScoU0jAo_JCCmsOQIwhvp46cggniry0fTEuqFCPsY8HPKwxMDniTd7xg3GOzEczlXHue-K8DhwNgl8NIdfyLSEA5AlQ6icfggFixC4r7Vi9TJsi3W8hDzunJ2DchufgSDikjOt5BH_z-QlYrOptMsT92n_CU8vch8kRDbSHFUHLz1wERUaTho4FVsBCrc-w2HGYAB5X0apdrBtm7xyrNxfZ3gMNl7JrLQxX-haJQEhLCsE5G78TNL2yIMZVAaUHSrOvo6DcpNO6aBiMM3vEfjxv6sX1oZFSosnDbrSFOGP4ML8LmF1i71qVxHlNIzESSXsyT7CKiJt0_LZExBTEtdi0mMASLTf6d2sv22S_3ep-TpdnixFzS9RJOLONGlRrcnx-pmAv7lm4zd8iCVJuZOdwg8ssK2yNRulMoMurCWdY-hY3396skw6twWZECfOUhRxxjy-Q4V-uIHqOT50VrQGfy9QM3Zv6CHuZzJ_dEgJY49ueNJdvfEm9Vhf5NDHO3fAvk5_j0dY16voCaFWi0ftzdPe6-FB-blA49YZwfPeLcHnfxd7NptZ8GJ2F_N78A5MmVsz_TXfqJfBiz_NHJ9GN-8GgDc6IBBk9uhUOgBLnEheynSkMBrUTyTUFQkbk38NjNAUuQzAHn_3pjSgDPPTzky_kBav8KptTudt1sfA33BKD6LAnujcXk_1lg6Yiarhonvwvnb_spuVmetz4aJCRRX9k9koYmiU_aEKItrtDAwVlPkevyjPvui16NX2PqDPJfjYL6vAMffmyNFwdec88f- -yEIfpPnwfXhJkmsXRX6LJzDrZbYQQF3hjK3PAlaaZhebIuz71tm-yO10_LJk_Aky0j0AvPfRkXC-8MC_VLNM3qH1JqlwDd3gT3h3gKQVukqvubbftuhKNFwuhTFRj3TDR6e1NJ6w7YO4twMghpAYK-wDhpCiXnBX78ywX6onuKDqLaierYExJuZicvvbRLnNAhrcjvPsZMETbrDc_pCIIZrLApBstXUyHflSDQsG2lQnGp_kxwtvOrizLZdce7b4rB7yLi0EViA0tUtGRE0LlNfYf_EdA82OFMubFYo1bQ8HHJ5h5yar7PYECtujgyq1zW-CZP5rqcuexoHitEXetN_RBucA2BKLdln6Rf2pQ-W3AkL2nIlktufCzMAkzjxkP9NF4BSkPIowMKwIvfgiaZQsblYKzJNmHflPLGKhFy2]--></g></svg>