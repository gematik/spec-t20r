<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="2972px" preserveAspectRatio="none" style="width:1594px;height:2972px;background:#FFFFFF;" version="1.1" viewBox="0 0 1594 2972" width="1594px" zoomAndPan="magnify"><defs/><g><rect fill="#F8F8FF" height="2960.4688" style="stroke:#181818;stroke-width:0.5;" width="675.2275" x="150.1621" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="479.314" y="15.2822">LEI</text><rect fill="#E6E6FA" height="2943.8281" style="stroke:#181818;stroke-width:0.5;" width="459.1431" x="150.1621" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="340.637" y="31.9229">Prim&#228;rsystem</text><rect fill="#F4A460" height="2927.1875" style="stroke:#181818;stroke-width:0.5;" width="89" x="150.1621" y="39.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="162.1621" y="48.5635">ZETA Client</text><rect fill="#C9FFC9" height="2960.4688" style="stroke:#181818;stroke-width:0.5;" width="715.479" x="837.3896" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1170.7688" y="15.2822">Anbieter</text><rect fill="#F4A460" height="2943.8281" style="stroke:#181818;stroke-width:0.5;" width="598.979" x="837.3896" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1103.7346" y="31.9229">ZETA Guard</text><rect fill="#8FBC8F" height="2943.8281" style="stroke:#181818;stroke-width:0.5;" width="104.5" x="1448.3687" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1463.0869" y="31.9229">TI 2.0 Dienst</text><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="39.5" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="43" x2="43" y1="126.5625" y2="2888.8281"/></g><g><title>ZETA</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="191.1621" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="194.6621" x2="194.6621" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="2695.3438" style="stroke:#181818;stroke-width:1;" width="10" x="189.6621" y="175.4844"/></g><g><title>TPM</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="576.1836" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="579.6836" x2="579.6836" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="574.6836" y="741.9375"/></g><g><title/><rect fill="#FFFFFF" height="76.9219" style="stroke:#181818;stroke-width:1;" width="10" x="574.6836" y="1449.3125"/></g><g><title>Konnektor or</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="661.2319" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="664.7319" x2="664.7319" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="76.9219" style="stroke:#181818;stroke-width:1;" width="10" x="659.7319" y="1176.9063"/></g><g><title>SM(C)-B</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="790.7749" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="794.2749" x2="794.2749" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="789.2749" y="1202.5469"/></g><g><title>PEP</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="870.7905" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="874.2905" x2="874.2905" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="869.2905" y="268.4063"/></g><g><title/><rect fill="#FFFFFF" height="239.4063" style="stroke:#181818;stroke-width:1;" width="10" x="869.2905" y="2631.4219"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="1091.9302" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1095.4302" x2="1095.4302" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="1090.4302" y="319.6875"/></g><g><title/><rect fill="#FFFFFF" height="2025.0469" style="stroke:#181818;stroke-width:1;" width="10" x="1090.4302" y="518.8125"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="1388.5825" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1392.0825" x2="1392.0825" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="37.2813" style="stroke:#181818;stroke-width:1;" width="10" x="1387.0825" y="2430.6563"/></g><g><title>Resource Server</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="1497.1187" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1500.6187" x2="1500.6187" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="87.5625" style="stroke:#181818;stroke-width:1;" width="10" x="1495.6187" y="2757.625"/></g><text fill="#000000" font-family="Helvetica" font-size="10" x="28.6035" y="124.2041">User</text><ellipse cx="43" cy="63.4219" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M43,71.4219 L43,98.4219 M30,79.4219 L56,79.4219 M43,98.4219 L30,113.4219 M43,98.4219 L56,113.4219" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="173.187" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="181.603" y="104.5635">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="180.187" y="116.2041">Client</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="562.3003" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="569.3003" y="116.2041">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="625.3052" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="632.3052" y="104.5635">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="636.3115" y="116.2041">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="767.1602" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="774.1602" y="116.2041">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.8018" x="841.3896" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="865.1011" y="104.5635">PEP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="848.3896" y="116.2041">http Proxy</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="1036.9556" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1085.5498" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1043.9556" y="116.2041">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1351.7964" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1382.2021" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1358.7964" y="116.2041">Policy Engine</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.5" x="1452.3687" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1459.3687" y="116.2041">Resource Server</text><text fill="#000000" font-family="Helvetica" font-size="10" x="28.6035" y="2958.1104">User</text><ellipse cx="43" cy="2897.3281" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M43,2905.3281 L43,2932.3281 M30,2913.3281 L56,2913.3281 M43,2932.3281 L30,2947.3281 M43,2932.3281 L56,2947.3281" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="173.187" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="181.603" y="2905.1104">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="180.187" y="2916.751">Client</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="562.3003" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="569.3003" y="2905.1104">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="625.3052" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="632.3052" y="2905.1104">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="636.3115" y="2916.751">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="767.1602" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="774.1602" y="2905.1104">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.8018" x="841.3896" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="865.1011" y="2905.1104">PEP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="848.3896" y="2916.751">http Proxy</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="1036.9556" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1085.5498" y="2905.1104">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1043.9556" y="2916.751">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1351.7964" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1382.2021" y="2905.1104">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1358.7964" y="2916.751">Policy Engine</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.5" x="1452.3687" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1459.3687" y="2905.1104">Resource Server</text><polygon fill="#181818" points="177.6621,171.4844,187.6621,175.4844,177.6621,179.4844,181.6621,175.4844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="43" x2="183.6621" y1="175.4844" y2="175.4844"/><text fill="#000000" font-family="Helvetica" font-size="10" x="50" y="159.4854">(01)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="147.8447">User wants to</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="159.4854">access resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="171.126">on Resource Server</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1582.8374" x="5" y="202.3047"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="202.3047" y2="202.3047"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="205.3047" y2="205.3047"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="72.7109" x="760.0632" y="193.4844"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="766.0632" y="206.7666">Discovery</text><path d="M178.6621,227.125 L507.2998,227.125 L507.2998,230.7656 L497.2998,240.7656 L178.6621,240.7656 L178.6621,227.125" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="192.7656" style="stroke:#000000;stroke-width:1.5;" width="937.7681" x="178.6621" y="227.125"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="237.4072">ZETA Client has Resource Server FQDN (RS-FQDN)</text><polygon fill="#181818" points="857.2905,264.4063,867.2905,268.4063,857.2905,272.4063,861.2905,268.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="863.2905" y1="268.4063" y2="268.4063"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="264.0479">(02)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="264.0479">GET /.well-known/oauth-protected-resource Host: RS-FQDN</text><polygon fill="#181818" points="210.6621,290.0469,200.6621,294.0469,210.6621,298.0469,206.6621,294.0469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="868.2905" y1="294.0469" y2="294.0469"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="289.6885">(03)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="289.6885">Client: 200 OK; json body with Well-Known json Document (RFC draft-ietf-oauth-resource-metadata)</text><polygon fill="#181818" points="1078.4302,315.6875,1088.4302,319.6875,1078.4302,323.6875,1082.4302,319.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1084.4302" y1="319.6875" y2="319.6875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="315.3291">(04)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="315.3291">GET /.well-known/oauth-authorization-server&#160;Host: AuthS-FQDN</text><polygon fill="#181818" points="210.6621,341.3281,200.6621,345.3281,210.6621,349.3281,206.6621,345.3281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1089.4302" y1="345.3281" y2="345.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="340.9697">(05)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="340.9697">200 OK; json body with Well-Known json Document (RFC8414)</text><path d="M204.6621,358.3281 L204.6621,414.3281 L535.6621,414.3281 L535.6621,368.3281 L525.6621,358.3281 L204.6621,358.3281" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M525.6621,358.3281 L525.6621,368.3281 L535.6621,368.3281 L525.6621,358.3281" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="372.6104">Offene Fragen:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="384.251">- Werden die Well-known JSON Dokumente signiert?</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="395.8916">- Wenn ja, welches Zertifikat wird f&#252;r die Signatur verwendet?</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="407.5322">- Wie wird die Signatur &#252;berpr&#252;ft?</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1582.8374" x="5" y="452.7109"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="452.7109" y2="452.7109"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="455.7109" y2="455.7109"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="182.2422" x="705.2976" y="443.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="711.2976" y="457.1729">Dynamic Client Registreation</text><path d="M178.6621,477.5313 L238.6182,477.5313 L238.6182,481.1719 L228.6182,491.1719 L178.6621,491.1719 L178.6621,477.5313" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="74.9219" style="stroke:#000000;stroke-width:1.5;" width="937.7681" x="178.6621" y="477.5313"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="487.8135">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.6182" y="488.8135">[Client has no client_id]</text><polygon fill="#181818" points="1078.4302,514.8125,1088.4302,518.8125,1078.4302,522.8125,1082.4302,518.8125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1084.4302" y1="518.8125" y2="518.8125"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="514.4541">(06)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="514.4541">POST /register (RFC7591)</text><polygon fill="#181818" points="210.6621,540.4531,200.6621,544.4531,210.6621,548.4531,206.6621,544.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1089.4302" y1="544.4531" y2="544.4531"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="540.0947">(07)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="540.0947">Client Information Response with client_id (RFC7591)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1582.8374" x="5" y="585.2734"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="585.2734" y2="585.2734"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="588.2734" y2="588.2734"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="104.7813" x="744.0281" y="576.4531"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="750.0281" y="589.7354">Key Generation</text><path d="M8,610.0938 L67.9561,610.0938 L67.9561,613.7344 L57.9561,623.7344 L8,623.7344 L8,610.0938" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="247.7656" style="stroke:#000000;stroke-width:1.5;" width="617.6836" x="8" y="610.0938"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="23" y="620.376">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="82.9561" y="621.376">[Client has no Client Attestation Key Pair]</text><path d="M27,637.7344 L86.9561,637.7344 L86.9561,641.375 L76.9561,651.375 L27,651.375 L27,637.7344" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="206.125" style="stroke:#000000;stroke-width:1.5;" width="573.6836" x="27" y="637.7344"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="42" y="648.0166">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="101.9561" y="649.0166">[Client uses TPM]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="27" x2="600.6836" y1="786.5781" y2="786.5781"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="32" y="797.8604">[Client uses self signed Attestation Key (deprecated)]</text><polygon fill="#181818" points="54,686.6563,44,690.6563,54,694.6563,50,690.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="48" x2="188.6621" y1="690.6563" y2="690.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="60" y="680.4775">(08)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.5273" y="674.6572">Obtain Admin</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.5273" y="686.2979">access to TPM</text><polygon fill="#181818" points="177.6621,712.2969,187.6621,716.2969,177.6621,720.2969,181.6621,716.2969" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="43" x2="183.6621" y1="716.2969" y2="716.2969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="50" y="711.9385">(09)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="711.9385">TPM Admin access</text><polygon fill="#181818" points="562.6836,737.9375,572.6836,741.9375,562.6836,745.9375,566.6836,741.9375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="568.6836" y1="741.9375" y2="741.9375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="737.5791">(10)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="737.5791">Create Client Attestation Key Pair in TPM</text><polygon fill="#181818" points="210.6621,763.5781,200.6621,767.5781,210.6621,771.5781,206.6621,767.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="573.6836" y1="767.5781" y2="767.5781"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="763.2197">(11)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="763.2197">Public Attestation Key</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="822.8594" y2="822.8594"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="822.8594" y2="835.8594"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="835.8594" y2="835.8594"/><polygon fill="#181818" points="210.6621,831.8594,200.6621,835.8594,210.6621,839.8594,206.6621,835.8594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="818.501">(12)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="818.501">Create self signed Client Attestation Key Pair</text><path d="M178.6621,875.8594 L238.6182,875.8594 L238.6182,879.5 L228.6182,889.5 L178.6621,889.5 L178.6621,875.8594" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="62.2813" style="stroke:#000000;stroke-width:1.5;" width="312.1816" x="178.6621" y="875.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="886.1416">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.6182" y="887.1416">[Client has no Client Instance Key Pair]</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="917.1406" y2="917.1406"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="917.1406" y2="930.1406"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="930.1406" y2="930.1406"/><polygon fill="#181818" points="210.6621,926.1406,200.6621,930.1406,210.6621,934.1406,206.6621,930.1406" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="912.7822">(13)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="912.7822">Create Client Instance Key Pair</text><path d="M12.6035,956.1406 L72.5596,956.1406 L72.5596,959.7813 L62.5596,969.7813 L12.6035,969.7813 L12.6035,956.1406" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1442.875" style="stroke:#000000;stroke-width:1.5;" width="1361.3774" x="12.6035" y="956.1406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="27.6035" y="966.4229">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="87.5596" y="967.4229">[Client has no valid refresh token]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="12.6035" x2="1373.981" y1="2164.25" y2="2164.25"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="17.6035" y="2175.5322">[Client has valid Refresh token]</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1582.8374" x="5" y="998.6016"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="998.6016" y2="998.6016"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="1001.6016" y2="1001.6016"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="117.9746" x="737.4314" y="989.7813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="743.4314" y="1003.0635">Token Generation</text><path d="M178.6621,1023.4219 L373.6084,1023.4219 L373.6084,1027.0625 L363.6084,1037.0625 L178.6621,1037.0625 L178.6621,1023.4219" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="277.0469" style="stroke:#000000;stroke-width:1.5;" width="636.6128" x="178.6621" y="1023.4219"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="1033.7041">SM(C)-B Access Token JWT</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1064.7031" y2="1064.7031"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1064.7031" y2="1077.7031"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1077.7031" y2="1077.7031"/><polygon fill="#181818" points="210.6621,1073.7031,200.6621,1077.7031,210.6621,1081.7031,206.6621,1077.7031" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1060.3447">(14)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1060.3447">generate DPoP key pair</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1138.2656" y2="1138.2656"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1138.2656" y2="1151.2656"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1151.2656" y2="1151.2656"/><polygon fill="#181818" points="210.6621,1147.2656,200.6621,1151.2656,210.6621,1155.2656,206.6621,1151.2656" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1116.4463">(15)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1098.9854">Generate SM(C)-B Access Token JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1110.626">("typ": "JWT", "alg": "ES256"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1122.2666">"sub": "telematik_id",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1133.9072">"scope": "token_exchange" "cnf": with public Client Attestation Key)</text><polygon fill="#181818" points="647.7319,1172.9063,657.7319,1176.9063,647.7319,1180.9063,651.7319,1176.9063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="653.7319" y1="1176.9063" y2="1176.9063"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1172.5479">(16)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1172.5479">externalAuthenticate SM(C)-B Access Token JWT-hash</text><polygon fill="#181818" points="777.2749,1198.5469,787.2749,1202.5469,777.2749,1206.5469,781.2749,1202.5469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="669.7319" x2="783.2749" y1="1202.5469" y2="1202.5469"/><text fill="#000000" font-family="Helvetica" font-size="10" x="676.7319" y="1198.1885">(17)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="701.2593" y="1198.1885">sign JWT-hash</text><polygon fill="#181818" points="680.7319,1224.1875,670.7319,1228.1875,680.7319,1232.1875,676.7319,1228.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="674.7319" x2="788.2749" y1="1228.1875" y2="1228.1875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="686.7319" y="1223.8291">(18)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="711.2593" y="1223.8291">JWT-Signature</text><polygon fill="#181818" points="210.6621,1249.8281,200.6621,1253.8281,210.6621,1257.8281,206.6621,1253.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="204.6621" x2="658.7319" y1="1253.8281" y2="1253.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1249.4697">(19)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1249.4697">JWT-Signature</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1279.4688" y2="1279.4688"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1279.4688" y2="1292.4688"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1292.4688" y2="1292.4688"/><polygon fill="#181818" points="210.6621,1288.4688,200.6621,1292.4688,210.6621,1296.4688,206.6621,1292.4688" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1275.1104">(20)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1275.1104">Add JWT-Signature to SM(C)-B Access Token</text><path d="M159.6621,1318.4688 L329.833,1318.4688 L329.833,1322.1094 L319.833,1332.1094 L159.6621,1332.1094 L159.6621,1318.4688" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="298.0469" style="stroke:#000000;stroke-width:1.5;" width="466.0215" x="159.6621" y="1318.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="174.6621" y="1328.751">Client Attestation JWT</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1383.0313" y2="1383.0313"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1383.0313" y2="1396.0313"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1396.0313" y2="1396.0313"/><polygon fill="#181818" points="210.6621,1392.0313,200.6621,1396.0313,210.6621,1400.0313,206.6621,1396.0313" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1367.0322">(21)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1355.3916">Generate Client Attestation JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1367.0322">("typ": "oauth-client-attestation+jwt", "alg": "ES256"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1378.6729">"sub": "client_id", "cnf" with public Client Instance Key)</text><path d="M178.6621,1408.0313 L238.6182,1408.0313 L238.6182,1411.6719 L228.6182,1421.6719 L178.6621,1421.6719 L178.6621,1408.0313" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="194.4844" style="stroke:#000000;stroke-width:1.5;" width="422.0215" x="178.6621" y="1408.0313"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="1418.3135">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.6182" y="1419.3135">[Client uses TPM]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="178.6621" x2="600.6836" y1="1545.2344" y2="1545.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="183.6621" y="1556.5166">[Client uses self signed Attestation Key (deprecated)]</text><polygon fill="#181818" points="562.6836,1445.3125,572.6836,1449.3125,562.6836,1453.3125,566.6836,1449.3125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="568.6836" y1="1449.3125" y2="1449.3125"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1444.9541">(22)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1444.9541">Sign Client Attestation JWT with Client Attestation Key</text><polygon fill="#181818" points="210.6621,1470.9531,200.6621,1474.9531,210.6621,1478.9531,206.6621,1474.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="573.6836" y1="1474.9531" y2="1474.9531"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1470.5947">(23)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1470.5947">Client Attestation JWT Signature</text><polygon fill="#181818" points="562.6836,1496.5938,572.6836,1500.5938,562.6836,1504.5938,566.6836,1500.5938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="568.6836" y1="1500.5938" y2="1500.5938"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1496.2354">(24)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1496.2354">Get TPM evidence</text><polygon fill="#181818" points="210.6621,1522.2344,200.6621,1526.2344,210.6621,1530.2344,206.6621,1526.2344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="573.6836" y1="1526.2344" y2="1526.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1521.876">(25)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1521.876">TPM2B_ATTEST Objekt and TPM EK certificate chain</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1581.5156" y2="1581.5156"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1581.5156" y2="1594.5156"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1594.5156" y2="1594.5156"/><polygon fill="#181818" points="210.6621,1590.5156,200.6621,1594.5156,210.6621,1598.5156,206.6621,1594.5156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1577.1572">(26)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1577.1572">Sign Client Attestation JWT with Client Key</text><path d="M178.6621,1634.5156 L431.6602,1634.5156 L431.6602,1638.1563 L421.6602,1648.1563 L178.6621,1648.1563 L178.6621,1634.5156" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="187.125" style="stroke:#000000;stroke-width:1.5;" width="932.7681" x="178.6621" y="1634.5156"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="1644.7979">Client Attestation PoP and DPoP JWT</text><polygon fill="#181818" points="1078.4302,1671.7969,1088.4302,1675.7969,1078.4302,1679.7969,1082.4302,1675.7969" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1084.4302" y1="1675.7969" y2="1675.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1671.4385">(27)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1671.4385">GET /nonce</text><polygon fill="#181818" points="210.6621,1697.4375,200.6621,1701.4375,210.6621,1705.4375,206.6621,1701.4375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1089.4302" y1="1701.4375" y2="1701.4375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1697.0791">(28)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1697.0791">return 200 OK new-nonce: nonce</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1750.3594" y2="1750.3594"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1750.3594" y2="1763.3594"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1763.3594" y2="1763.3594"/><polygon fill="#181818" points="210.6621,1759.3594,200.6621,1763.3594,210.6621,1767.3594,206.6621,1763.3594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1734.3604">(29)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1722.7197">Generate Client Attestation PoP JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1734.3604">("typ": "oauth-client-attestation-pop+jwt", "nonce"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1746.001">sign with the private Client Instance Key)</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1800.6406" y2="1800.6406"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1800.6406" y2="1813.6406"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1813.6406" y2="1813.6406"/><polygon fill="#181818" points="210.6621,1809.6406,200.6621,1813.6406,210.6621,1817.6406,206.6621,1813.6406" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1790.4619">(30)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1784.6416">Generate DPoP JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1796.2822">("nonce", sign with the private DPoP Key)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1582.8374" x="5" y="1854.4609"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="1854.4609" y2="1854.4609"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="1857.4609" y2="1857.4609"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="109.3418" x="741.7478" y="1845.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="747.7478" y="1858.9229">Token Exchange</text><polygon fill="#181818" points="1078.4302,1993.6875,1088.4302,1997.6875,1078.4302,2001.6875,1082.4302,1997.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1084.4302" y1="1997.6875" y2="1997.6875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1940.9463">(31)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1888.5635">POST /token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1900.2041">POST /token HTTP/1.1</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1911.8447">Host: auths.example.com</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1923.4854">Content-Type: application/x-www-form-urlencoded</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1935.126">OAuth-Client-Attestation: &lt;Base64url-kodiertes Client Attestation JWT&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1946.7666">OAuth-Client-Attestation-PoP: &lt;Base64url-kodiertes Client Attestation PoP JWT&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1958.4072">grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange&amp;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1970.0479">subject_token=&lt;SM(C)-B Access Token JWT&gt;&amp;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1981.6885">subject_token_type=urn%3Aexample%3Asmc-b-jwt&amp;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1993.3291">audience=https%3A%2F%2Fbackend.example.com%2Fapi</text><path d="M824.0347,2010.6875 L824.0347,2031.6875 L1090.0347,2031.6875 L1090.0347,2020.6875 L1080.0347,2010.6875 L824.0347,2010.6875" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1080.0347,2010.6875 L1080.0347,2020.6875 L1090.0347,2020.6875 L1080.0347,2010.6875" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="830.0347" y="2024.9697">RFC7523 (JWT Client Assertion), RFC9449 (DPoP)</text><line style="stroke:#181818;stroke-width:1;" x1="1100.4302" x2="1142.4302" y1="2054.9688" y2="2054.9688"/><line style="stroke:#181818;stroke-width:1;" x1="1142.4302" x2="1142.4302" y1="2054.9688" y2="2067.9688"/><line style="stroke:#181818;stroke-width:1;" x1="1101.4302" x2="1142.4302" y1="2067.9688" y2="2067.9688"/><polygon fill="#181818" points="1111.4302,2063.9688,1101.4302,2067.9688,1111.4302,2071.9688,1107.4302,2067.9688" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.4302" y="2050.6104">(32)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1131.9575" y="2050.6104">verify SM(C)-B Access Token JWT</text><line style="stroke:#181818;stroke-width:1;" x1="1100.4302" x2="1142.4302" y1="2093.6094" y2="2093.6094"/><line style="stroke:#181818;stroke-width:1;" x1="1142.4302" x2="1142.4302" y1="2093.6094" y2="2106.6094"/><line style="stroke:#181818;stroke-width:1;" x1="1101.4302" x2="1142.4302" y1="2106.6094" y2="2106.6094"/><polygon fill="#181818" points="1111.4302,2102.6094,1101.4302,2106.6094,1111.4302,2110.6094,1107.4302,2106.6094" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.4302" y="2089.251">(33)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1131.9575" y="2089.251">verify Client Attestation JWT and PoP JWT</text><line style="stroke:#181818;stroke-width:1;" x1="1100.4302" x2="1142.4302" y1="2132.25" y2="2132.25"/><line style="stroke:#181818;stroke-width:1;" x1="1142.4302" x2="1142.4302" y1="2132.25" y2="2145.25"/><line style="stroke:#181818;stroke-width:1;" x1="1101.4302" x2="1142.4302" y1="2145.25" y2="2145.25"/><polygon fill="#181818" points="1111.4302,2141.25,1101.4302,2145.25,1111.4302,2149.25,1107.4302,2145.25" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.4302" y="2127.8916">(34)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1131.9575" y="2127.8916">Create state for Session, Identity and Client</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1582.8374" x="5" y="2201.7109"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="2201.7109" y2="2201.7109"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1587.8374" y1="2204.7109" y2="2204.7109"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="156.4414" x="718.198" y="2192.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="724.198" y="2206.1729">Refresh Token Exchange</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="2240.1719" y2="2240.1719"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="2240.1719" y2="2253.1719"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="2253.1719" y2="2253.1719"/><polygon fill="#181818" points="210.6621,2249.1719,200.6621,2253.1719,210.6621,2257.1719,206.6621,2253.1719" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2235.8135">(35)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2235.8135">create DPoP JWT without nonce</text><polygon fill="#181818" points="1078.4302,2309.7344,1088.4302,2313.7344,1078.4302,2317.7344,1082.4302,2313.7344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1084.4302" y1="2313.7344" y2="2313.7344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2291.915">(36)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2274.4541">POST /token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2286.0947">DPoP: ... (DPoP JWT)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2297.7354">grant_type=refresh_token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2309.376">refresh_token= ... (Refresh token)</text><line style="stroke:#181818;stroke-width:1;" x1="1100.4302" x2="1142.4302" y1="2339.375" y2="2339.375"/><line style="stroke:#181818;stroke-width:1;" x1="1142.4302" x2="1142.4302" y1="2339.375" y2="2352.375"/><line style="stroke:#181818;stroke-width:1;" x1="1101.4302" x2="1142.4302" y1="2352.375" y2="2352.375"/><polygon fill="#181818" points="1111.4302,2348.375,1101.4302,2352.375,1111.4302,2356.375,1107.4302,2352.375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.4302" y="2335.0166">(37)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1131.9575" y="2335.0166">verify Refresh token and DPoP JWT</text><line style="stroke:#181818;stroke-width:1;" x1="1100.4302" x2="1142.4302" y1="2378.0156" y2="2378.0156"/><line style="stroke:#181818;stroke-width:1;" x1="1142.4302" x2="1142.4302" y1="2378.0156" y2="2391.0156"/><line style="stroke:#181818;stroke-width:1;" x1="1101.4302" x2="1142.4302" y1="2391.0156" y2="2391.0156"/><polygon fill="#181818" points="1111.4302,2387.0156,1101.4302,2391.0156,1111.4302,2395.0156,1107.4302,2391.0156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.4302" y="2373.6572">(38)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1131.9575" y="2373.6572">invalidate Refresh token</text><polygon fill="#181818" points="1375.0825,2426.6563,1385.0825,2430.6563,1375.0825,2434.6563,1379.0825,2430.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1100.4302" x2="1381.0825" y1="2430.6563" y2="2430.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.4302" y="2426.2979">(39)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1131.9575" y="2426.2979">POST /v1/data/authz, json body {  "input": {...}}</text><polygon fill="#181818" points="1111.4302,2463.9375,1101.4302,2467.9375,1111.4302,2471.9375,1107.4302,2467.9375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1105.4302" x2="1386.0825" y1="2467.9375" y2="2467.9375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.4302" y="2457.7588">(40)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.9575" y="2451.9385">200 OK, json body {"result": {"allow": true,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.9575" y="2463.5791">"access_token_attributes": {...}}</text><line style="stroke:#181818;stroke-width:1;" x1="1100.4302" x2="1142.4302" y1="2505.2188" y2="2505.2188"/><line style="stroke:#181818;stroke-width:1;" x1="1142.4302" x2="1142.4302" y1="2505.2188" y2="2518.2188"/><line style="stroke:#181818;stroke-width:1;" x1="1101.4302" x2="1142.4302" y1="2518.2188" y2="2518.2188"/><polygon fill="#181818" points="1111.4302,2514.2188,1101.4302,2518.2188,1111.4302,2522.2188,1107.4302,2518.2188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.4302" y="2495.04">(41)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1131.9575" y="2489.2197">issue Access and Refresh token with DPoP Binding</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1138.3149" y="2500.8604">and Access token attributes</text><polygon fill="#181818" points="210.6621,2539.8594,200.6621,2543.8594,210.6621,2547.8594,206.6621,2543.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1089.4302" y1="2543.8594" y2="2543.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="2539.501">(42)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="2539.501">200 OK, Access token, Refresh token, bound to DPoP</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="2569.5" y2="2569.5"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="2569.5" y2="2582.5"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="2582.5" y2="2582.5"/><polygon fill="#181818" points="210.6621,2578.5,200.6621,2582.5,210.6621,2586.5,206.6621,2582.5" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2565.1416">(43)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2565.1416">Create DPoP Proof for RS</text><polygon fill="#181818" points="857.2905,2627.4219,867.2905,2631.4219,857.2905,2635.4219,861.2905,2631.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="863.2905" y1="2631.4219" y2="2631.4219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2615.4229">(44)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2603.7822">GET /resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2615.4229">Authorization: DPoP ... (Accesss token)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2627.0635">DPoP: ... (DPoP token)</text><line style="stroke:#181818;stroke-width:1;" x1="879.2905" x2="921.2905" y1="2657.0625" y2="2657.0625"/><line style="stroke:#181818;stroke-width:1;" x1="921.2905" x2="921.2905" y1="2657.0625" y2="2670.0625"/><line style="stroke:#181818;stroke-width:1;" x1="880.2905" x2="921.2905" y1="2670.0625" y2="2670.0625"/><polygon fill="#181818" points="890.2905,2666.0625,880.2905,2670.0625,890.2905,2674.0625,886.2905,2670.0625" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="886.2905" y="2652.7041">(45)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="910.8179" y="2652.7041">verify Access token and DPoP Proof</text><line style="stroke:#181818;stroke-width:1;" x1="879.2905" x2="921.2905" y1="2707.3438" y2="2707.3438"/><line style="stroke:#181818;stroke-width:1;" x1="921.2905" x2="921.2905" y1="2707.3438" y2="2720.3438"/><line style="stroke:#181818;stroke-width:1;" x1="880.2905" x2="921.2905" y1="2720.3438" y2="2720.3438"/><polygon fill="#181818" points="890.2905,2716.3438,880.2905,2720.3438,890.2905,2724.3438,886.2905,2720.3438" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="886.2905" y="2697.165">(46)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="910.8179" y="2691.3447">additional checks according to</text><text fill="#000000" font-family="Helvetica" font-size="10" x="910.8179" y="2702.9854">Access token attributes</text><polygon fill="#181818" points="1483.6187,2753.625,1493.6187,2757.625,1483.6187,2761.625,1487.6187,2757.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="879.2905" x2="1489.6187" y1="2757.625" y2="2757.625"/><text fill="#000000" font-family="Helvetica" font-size="10" x="886.2905" y="2747.4463">(47)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="910.8179" y="2741.626">forward GET /resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="910.8179" y="2753.2666">with header and header content as json</text><line style="stroke:#181818;stroke-width:1;" x1="1505.6187" x2="1547.6187" y1="2806.5469" y2="2806.5469"/><line style="stroke:#181818;stroke-width:1;" x1="1547.6187" x2="1547.6187" y1="2806.5469" y2="2819.5469"/><line style="stroke:#181818;stroke-width:1;" x1="1506.6187" x2="1547.6187" y1="2819.5469" y2="2819.5469"/><polygon fill="#181818" points="1516.6187,2815.5469,1506.6187,2819.5469,1516.6187,2823.5469,1512.6187,2819.5469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1512.6187" y="2790.5479">(48)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1537.146" y="2778.9072">provide</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1537.146" y="2790.5479">resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1537.146" y="2802.1885">access</text><polygon fill="#181818" points="890.2905,2841.1875,880.2905,2845.1875,890.2905,2849.1875,886.2905,2845.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="884.2905" x2="1494.6187" y1="2845.1875" y2="2845.1875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="896.2905" y="2840.8291">(49)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.8179" y="2840.8291">200 OK, resource</text><polygon fill="#181818" points="210.6621,2866.8281,200.6621,2870.8281,210.6621,2874.8281,206.6621,2870.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="868.2905" y1="2870.8281" y2="2870.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="2866.4697">(50)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="2866.4697">200 OK, resource</text><!--SRC=[fLXjSzku4VxENx7LpVLiL_JR-QwDUav7jkMNE8bPIPrCRppZWSYLn4W2E21eMRcv_z8FzpFowVB7kWkG4Yc9FZUTSI82sFTzi5X0P4R9R3P03OsTmyFTXfTEOfa8BMOGuL1aKtEffEd5dn2E3hSllXSpX6kSFgA9Gr6YkN0qxvHKQI92Z9RKvohJCUeIxHJbo8pRqSSiDI2LHC_xKwB5Q2R0eFe4HcSqrGwDql2lb5W7wWaQRpit3VZcQgnIys4S6_G0x7oWuzcNttIwI0tEYEAjU4GP4HT0Jl5pfz-6yscCqj1wJyXeSQRLN5eA03AAd8aJ8KrE1I9rNFSoPxEa99O5UkjC_U2TvQ1V9boHbObkbPGuOPUOT3LI-bxsR_mhON0k5eqrhjwxCqlVUxTplkkVDRn2k8j9MmvYDAZ9hNxd_FhztTkxgtzxPRUlCg6ZJQ_BEgu3goBe1FToR4m2WLPFYyO6NJipuvuZlI1I7YeTVn8cLX9wg1_PZWskeBDY2TGq3XVGaQDOOZLKpkR-3Hpl7y85nPoWySs5q9CUYYkDk2rPNMTD5rE2M8Y53PLSBUF5G0B_TPxXbWKMp4bC2aRTIn66cAQWSrdt14jO4-o9qCIFbATSXkUTdfAfQQXeSG6dfvutqYfBe8Gt69E5QtBWyfyNxs6ds_FvOvVCpMd9kkkW1LUTFXpipt4wzIUI4dQW18NQJxGo61gC_C98kAQzq89S4CbP6dWTq8ZowfSSBdwF3m_XxlRly34b5mSgMi0yDcFumFfkMPzRkL1XDcEhThgNvn1fCJG-OMteEsiA6_mP6X498zYF2AiMhFoosAbrJPIXvASsIh__ntbdEJSSjBCquJ1PTlDhtFlRoT79cls50lgJ57VGyMXiG0sBt3F6xeP3b0YNLBfGjkoKJufqX1AY69rEwoUywTsz9vqJgnCXZKUIQgBvnv99absY2HIQS8mf_4oByJ2U24FcwmY6NpvhAxD7dC9a6YX4SwvpAncqQcahP5y-KxrFz9VFGql8su7zyNXZE00lf9Z5OP6hBexYr6XqkvemBQQcZ6Mf8BIZXvZujwGukEjHZhKLGrZdyFxrXrT7ko_BNYxkHWwLdZaRQFSaIgReyhXKNf9Sk7AB2xYYZEYbyLkipqTjOp0rZf3v0X7pYL6YprBA0vLq6zwLcrmtMd0tC2AMq8vciLmM3wEMzAxQb1pZCy9IWoDUaqhBv3o77P-p48Y_KB6CPZ71AiegWsn0vNPTZYKj0TrnupJ5YkCfJeSMfXXjMB8JOQ8n9EveTysFPHwTAsKfpmUUSyZ_QXDsGoU2a5JqIaorUcjvB5GsTJoAAI5Auv3AsfZoEA7pXX7LvwzrJ06uCf-VoT1ssNUqRpxqlPgOZ9mOX8j01J0Xan8sgOPwR- -geAzJjBTtBtSQPf4qMj2WSQC93J4TyQZJE_xXnyQzRAJPWCS6fyZxQK8xfz7a-L0bQ5TOsWC-XMCXHzY0HYY7D6ytM-8Gj3rpwwbVjZGjm2VQ-b9CUN_JQXm-vuLFEHXN4RqKPQTNlH9feOQePH5LmqhhTe8RfwfHJ5-KHLpV1GLRHLUHYcSvgxPkvh4THLK1N2QsnIBV14juROawW-iFqRAThu8LT-gwKkgB5U5VFixDCo1QrbwcOPXiGqbvppc8rDNKZVh78QentsdQ3iHSs4OztAo8DRAhkTqmwmfTYu-FCPti8TO8f_7nsKExt-_G0NWt-4YW06gwBLtd5a9tejkjG7ijBXhQZLBy_nRZRV1uQMIBQ38G_nYENCROGrlFDh6PDmG4JUxwgA4ESM_FqcoU-nef_Z9lta3YtBVqBR0_NmNwtAWN0TzFL5A0tsearDiYOuD3HGmINMxzjw3yMVCkAiOu3KtOhi7IvcABpiOLoqvUfEqfj2NEhlMo1PqLbOPmtUy71qVxH_VITTKSXtGVdyGicU9-g6PqqwKBEuUblqWexY99fWnM2ix1ap-VpttkoFnCq-KzL156z_AE5VlE3hyK-HRyT2PI_F64YFs9YhZH9H1lXz_hUZa-1UBbil88axoHfblT0sKSJmbJttxVvciB_TZ7XvG-B0hernBwJ4W36oU_E0V_JFdFQ0-798WNJd-gExvUhvEMDUS1fgzq5le3do16v28ZFmW2ftpRPeE-FRwalu48YJqgPuLcHH9xddVmtGiIJY3yNtC85cujsD_VXvq2fRiy_tLH90Vz0GgDccM8DEMgf-GfBjwChOuYSyMArUTzT-3PMzOKX_QILLmGR8j__3tiSA5QPzrjylghavDNpdHx4N2tcxp0B4D5bwLukAZls6heQoecrxoYvArp5esluVyft7JdJrDYRC9DnAsGMLZsuWMXNEgv5tMDQ7UZ4IrcdYq4HU49dGr5Ecs9KPd9QsdDZStgUY4WyaRvOSbJcJXrp1KdTkj2NA6gdYRh7B6qqM7NgW6oLN997NGAbnwF3lXbue21-gbPUX7u1Q0HooGpT2RyGiR- -Yki7dU2ZXTqxE6KwtM7KeM_GTgpgMMdPccgvlJ5hvRSMRlxNLuBw8pHyI0Z_2nLUQKJdtHjU9cc6HO8vNXK8sIF2nkYirX6iHpPVKPaxU8EQkEuLElLlP0qAnpDgfec-PcHK6fLMPUtyJ3YrLwzh6s1LhIB6VxTdhVbTMlrpEQQWUNZJylnMm0v-t83TxT1CuTM-T697xsSeXnWrRWK-B86beX55CMiNqofESDmal8rNMaEi7qUh8kkaz2bl96pSw6ZTVziliOe8jHMU_uPkaBDxvSCgvKB5Azkhv2PQCKzvxrSoSjV3xekfMnwaSw2ffmiahRs2lWSzNMmnbiQvGNhlm00]--></g></svg>