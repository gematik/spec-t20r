<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="2972px" preserveAspectRatio="none" style="width:1604px;height:2972px;background:#FFFFFF;" version="1.1" viewBox="0 0 1604 2972" width="1604px" zoomAndPan="magnify"><defs/><g><rect fill="#F8F8FF" height="2960.4688" style="stroke:#181818;stroke-width:0.5;" width="685.0078" x="150.1621" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="484.2041" y="15.2822">LEI</text><rect fill="#E6E6FA" height="2943.8281" style="stroke:#181818;stroke-width:0.5;" width="468.9233" x="150.1621" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="345.5271" y="31.9229">Prim&#228;rsystem</text><rect fill="#F4A460" height="2927.1875" style="stroke:#181818;stroke-width:0.5;" width="89" x="150.1621" y="39.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="162.1621" y="48.5635">ZETA Client</text><rect fill="#C9FFC9" height="2960.4688" style="stroke:#181818;stroke-width:0.5;" width="715.479" x="847.1699" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1180.5491" y="15.2822">Anbieter</text><rect fill="#F4A460" height="2943.8281" style="stroke:#181818;stroke-width:0.5;" width="598.979" x="847.1699" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1113.5149" y="31.9229">ZETA Guard</text><rect fill="#8FBC8F" height="2943.8281" style="stroke:#181818;stroke-width:0.5;" width="104.5" x="1458.1489" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1472.8672" y="31.9229">TI 2.0 Dienst</text><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="39.5" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="43" x2="43" y1="126.5625" y2="2888.8281"/></g><g><title>ZETA</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="191.1621" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="194.6621" x2="194.6621" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="2695.3438" style="stroke:#181818;stroke-width:1;" width="10" x="189.6621" y="175.4844"/></g><g><title>TPM</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="585.9639" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="589.4639" x2="589.4639" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="584.4639" y="741.9375"/></g><g><title/><rect fill="#FFFFFF" height="76.9219" style="stroke:#181818;stroke-width:1;" width="10" x="584.4639" y="1449.3125"/></g><g><title>Konnektor or</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="671.0122" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="674.5122" x2="674.5122" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="76.9219" style="stroke:#181818;stroke-width:1;" width="10" x="669.5122" y="1176.9063"/></g><g><title>SM(C)-B</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="800.5552" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="804.0552" x2="804.0552" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="799.0552" y="1202.5469"/></g><g><title>PEP</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="880.5708" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="884.0708" x2="884.0708" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="879.0708" y="268.4063"/></g><g><title/><rect fill="#FFFFFF" height="239.4063" style="stroke:#181818;stroke-width:1;" width="10" x="879.0708" y="2631.4219"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="1101.7104" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1105.2104" x2="1105.2104" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="1100.2104" y="319.6875"/></g><g><title/><rect fill="#FFFFFF" height="2025.0469" style="stroke:#181818;stroke-width:1;" width="10" x="1100.2104" y="518.8125"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="1398.3628" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1401.8628" x2="1401.8628" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="37.2813" style="stroke:#181818;stroke-width:1;" width="10" x="1396.8628" y="2430.6563"/></g><g><title>Resource Server</title><rect fill="#000000" fill-opacity="0.00000" height="2762.2656" width="8" x="1506.8989" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1510.3989" x2="1510.3989" y1="126.5625" y2="2888.8281"/></g><g><title/><rect fill="#FFFFFF" height="87.5625" style="stroke:#181818;stroke-width:1;" width="10" x="1505.3989" y="2757.625"/></g><text fill="#000000" font-family="Helvetica" font-size="10" x="28.6035" y="124.2041">User</text><ellipse cx="43" cy="63.4219" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M43,71.4219 L43,98.4219 M30,79.4219 L56,79.4219 M43,98.4219 L30,113.4219 M43,98.4219 L56,113.4219" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="173.187" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="181.603" y="104.5635">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="180.187" y="116.2041">Client</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="572.0806" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="579.0806" y="116.2041">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="635.0854" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="642.0854" y="104.5635">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="646.0918" y="116.2041">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="776.9404" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="783.9404" y="116.2041">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.8018" x="851.1699" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="874.8813" y="104.5635">PEP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="858.1699" y="116.2041">http Proxy</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="1046.7358" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1095.3301" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1053.7358" y="116.2041">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1361.5767" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1391.9824" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1368.5767" y="116.2041">Policy Engine</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.5" x="1462.1489" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1469.1489" y="116.2041">Resource Server</text><text fill="#000000" font-family="Helvetica" font-size="10" x="28.6035" y="2958.1104">User</text><ellipse cx="43" cy="2897.3281" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M43,2905.3281 L43,2932.3281 M30,2913.3281 L56,2913.3281 M43,2932.3281 L30,2947.3281 M43,2932.3281 L56,2947.3281" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="173.187" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="181.603" y="2905.1104">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="180.187" y="2916.751">Client</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="572.0806" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="579.0806" y="2905.1104">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="635.0854" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="642.0854" y="2905.1104">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="646.0918" y="2916.751">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="776.9404" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="783.9404" y="2905.1104">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.8018" x="851.1699" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="874.8813" y="2905.1104">PEP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="858.1699" y="2916.751">http Proxy</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="1046.7358" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1095.3301" y="2905.1104">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1053.7358" y="2916.751">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1361.5767" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1391.9824" y="2905.1104">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1368.5767" y="2916.751">Policy Engine</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.5" x="1462.1489" y="2888.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1469.1489" y="2905.1104">Resource Server</text><polygon fill="#181818" points="177.6621,171.4844,187.6621,175.4844,177.6621,179.4844,181.6621,175.4844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="43" x2="183.6621" y1="175.4844" y2="175.4844"/><text fill="#000000" font-family="Helvetica" font-size="10" x="50" y="159.4854">(01)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="147.8447">User wants to</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="159.4854">access resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="171.126">on Resource Server</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="202.3047"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="202.3047" y2="202.3047"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="205.3047" y2="205.3047"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="72.7109" x="764.9534" y="193.4844"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="770.9534" y="206.7666">Discovery</text><path d="M178.6621,227.125 L507.2998,227.125 L507.2998,230.7656 L497.2998,240.7656 L178.6621,240.7656 L178.6621,227.125" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="192.7656" style="stroke:#000000;stroke-width:1.5;" width="947.5483" x="178.6621" y="227.125"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="237.4072">ZETA Client has Resource Server FQDN (RS-FQDN)</text><polygon fill="#181818" points="867.0708,264.4063,877.0708,268.4063,867.0708,272.4063,871.0708,268.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="873.0708" y1="268.4063" y2="268.4063"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="264.0479">(02)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="264.0479">GET /.well-known/oauth-protected-resource Host: RS-FQDN</text><polygon fill="#181818" points="210.6621,290.0469,200.6621,294.0469,210.6621,298.0469,206.6621,294.0469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="878.0708" y1="294.0469" y2="294.0469"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="289.6885">(03)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="289.6885">Client: 200 OK; json body with Well-Known json Document (RFC draft-ietf-oauth-resource-metadata)</text><polygon fill="#181818" points="1088.2104,315.6875,1098.2104,319.6875,1088.2104,323.6875,1092.2104,319.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1094.2104" y1="319.6875" y2="319.6875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="315.3291">(04)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="315.3291">GET /.well-known/oauth-authorization-server&#160;Host: AuthS-FQDN</text><polygon fill="#181818" points="210.6621,341.3281,200.6621,345.3281,210.6621,349.3281,206.6621,345.3281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1099.2104" y1="345.3281" y2="345.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="340.9697">(05)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="340.9697">200 OK; json body with Well-Known json Document (RFC8414)</text><path d="M204.6621,358.3281 L204.6621,414.3281 L535.6621,414.3281 L535.6621,368.3281 L525.6621,358.3281 L204.6621,358.3281" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M525.6621,358.3281 L525.6621,368.3281 L535.6621,368.3281 L525.6621,358.3281" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="372.6104">Offene Fragen:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="384.251">- Werden die Well-known JSON Dokumente signiert?</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="395.8916">- Wenn ja, welches Zertifikat wird f&#252;r die Signatur verwendet?</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.6621" y="407.5322">- Wie wird die Signatur &#252;berpr&#252;ft?</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="452.7109"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="452.7109" y2="452.7109"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="455.7109" y2="455.7109"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="175.46" x="713.5789" y="443.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="719.5789" y="457.1729">Dynamic Client Registration</text><path d="M178.6621,477.5313 L238.6182,477.5313 L238.6182,481.1719 L228.6182,491.1719 L178.6621,491.1719 L178.6621,477.5313" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="74.9219" style="stroke:#000000;stroke-width:1.5;" width="947.5483" x="178.6621" y="477.5313"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="487.8135">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.6182" y="488.8135">[Client has no client_id]</text><polygon fill="#181818" points="1088.2104,514.8125,1098.2104,518.8125,1088.2104,522.8125,1092.2104,518.8125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1094.2104" y1="518.8125" y2="518.8125"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="514.4541">(06)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="514.4541">POST /register (RFC7591)</text><polygon fill="#181818" points="210.6621,540.4531,200.6621,544.4531,210.6621,548.4531,206.6621,544.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1099.2104" y1="544.4531" y2="544.4531"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="540.0947">(07)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="540.0947">Client Information Response with client_id (RFC7591)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="585.2734"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="585.2734" y2="585.2734"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="588.2734" y2="588.2734"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="104.7813" x="748.9182" y="576.4531"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="754.9182" y="589.7354">Key Generation</text><path d="M8,610.0938 L67.9561,610.0938 L67.9561,613.7344 L57.9561,623.7344 L8,623.7344 L8,610.0938" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="247.7656" style="stroke:#000000;stroke-width:1.5;" width="627.4639" x="8" y="610.0938"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="23" y="620.376">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="82.9561" y="621.376">[Client has no Client Attestation Key Pair]</text><path d="M27,637.7344 L86.9561,637.7344 L86.9561,641.375 L76.9561,651.375 L27,651.375 L27,637.7344" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="206.125" style="stroke:#000000;stroke-width:1.5;" width="583.4639" x="27" y="637.7344"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="42" y="648.0166">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="101.9561" y="649.0166">[Client uses TPM]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="27" x2="610.4639" y1="786.5781" y2="786.5781"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="32" y="797.8604">[Client uses self signed Attestation Key (deprecated)]</text><polygon fill="#181818" points="54,686.6563,44,690.6563,54,694.6563,50,690.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="48" x2="188.6621" y1="690.6563" y2="690.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="60" y="680.4775">(08)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.5273" y="674.6572">Obtain Admin</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.5273" y="686.2979">access to TPM</text><polygon fill="#181818" points="177.6621,712.2969,187.6621,716.2969,177.6621,720.2969,181.6621,716.2969" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="43" x2="183.6621" y1="716.2969" y2="716.2969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="50" y="711.9385">(09)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="74.5273" y="711.9385">TPM Admin access</text><polygon fill="#181818" points="572.4639,737.9375,582.4639,741.9375,572.4639,745.9375,576.4639,741.9375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="578.4639" y1="741.9375" y2="741.9375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="737.5791">(10)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="737.5791">Create Client Attestation Key Pair in TPM</text><polygon fill="#181818" points="210.6621,763.5781,200.6621,767.5781,210.6621,771.5781,206.6621,767.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="583.4639" y1="767.5781" y2="767.5781"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="763.2197">(11)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="763.2197">Public Attestation Key</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="822.8594" y2="822.8594"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="822.8594" y2="835.8594"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="835.8594" y2="835.8594"/><polygon fill="#181818" points="210.6621,831.8594,200.6621,835.8594,210.6621,839.8594,206.6621,835.8594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="818.501">(12)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="818.501">Create self signed Client Attestation Key Pair</text><path d="M178.6621,875.8594 L238.6182,875.8594 L238.6182,879.5 L228.6182,889.5 L178.6621,889.5 L178.6621,875.8594" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="62.2813" style="stroke:#000000;stroke-width:1.5;" width="312.1816" x="178.6621" y="875.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="886.1416">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.6182" y="887.1416">[Client has no Client Instance Key Pair]</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="917.1406" y2="917.1406"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="917.1406" y2="930.1406"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="930.1406" y2="930.1406"/><polygon fill="#181818" points="210.6621,926.1406,200.6621,930.1406,210.6621,934.1406,206.6621,930.1406" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="912.7822">(13)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="912.7822">Create Client Instance Key Pair</text><path d="M12.6035,956.1406 L72.5596,956.1406 L72.5596,959.7813 L62.5596,969.7813 L12.6035,969.7813 L12.6035,956.1406" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1442.875" style="stroke:#000000;stroke-width:1.5;" width="1371.1577" x="12.6035" y="956.1406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="27.6035" y="966.4229">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="87.5596" y="967.4229">[Client has no valid refresh token]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="12.6035" x2="1383.7612" y1="2164.25" y2="2164.25"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="17.6035" y="2175.5322">[Client has valid Refresh token]</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="998.6016"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="998.6016" y2="998.6016"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="1001.6016" y2="1001.6016"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="117.9746" x="742.3215" y="989.7813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="748.3215" y="1003.0635">Token Generation</text><path d="M178.6621,1023.4219 L373.6084,1023.4219 L373.6084,1027.0625 L363.6084,1037.0625 L178.6621,1037.0625 L178.6621,1023.4219" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="277.0469" style="stroke:#000000;stroke-width:1.5;" width="646.3931" x="178.6621" y="1023.4219"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="1033.7041">SM(C)-B Access Token JWT</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1064.7031" y2="1064.7031"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1064.7031" y2="1077.7031"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1077.7031" y2="1077.7031"/><polygon fill="#181818" points="210.6621,1073.7031,200.6621,1077.7031,210.6621,1081.7031,206.6621,1077.7031" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1060.3447">(14)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1060.3447">generate DPoP key pair</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1138.2656" y2="1138.2656"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1138.2656" y2="1151.2656"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1151.2656" y2="1151.2656"/><polygon fill="#181818" points="210.6621,1147.2656,200.6621,1151.2656,210.6621,1155.2656,206.6621,1151.2656" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1116.4463">(15)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1098.9854">Generate SM(C)-B Access Token JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1110.626">("typ": "JWT", "alg": "ES256"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1122.2666">"sub": "telematik_id",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1133.9072">"scope": "RS specific scopes" "cnf": with public Client Attestation Key)</text><polygon fill="#181818" points="657.5122,1172.9063,667.5122,1176.9063,657.5122,1180.9063,661.5122,1176.9063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="663.5122" y1="1176.9063" y2="1176.9063"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1172.5479">(16)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1172.5479">externalAuthenticate SM(C)-B Access Token JWT-hash</text><polygon fill="#181818" points="787.0552,1198.5469,797.0552,1202.5469,787.0552,1206.5469,791.0552,1202.5469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="679.5122" x2="793.0552" y1="1202.5469" y2="1202.5469"/><text fill="#000000" font-family="Helvetica" font-size="10" x="686.5122" y="1198.1885">(17)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="711.0396" y="1198.1885">sign JWT-hash</text><polygon fill="#181818" points="690.5122,1224.1875,680.5122,1228.1875,690.5122,1232.1875,686.5122,1228.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="684.5122" x2="798.0552" y1="1228.1875" y2="1228.1875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="696.5122" y="1223.8291">(18)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="721.0396" y="1223.8291">JWT-Signature</text><polygon fill="#181818" points="210.6621,1249.8281,200.6621,1253.8281,210.6621,1257.8281,206.6621,1253.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="204.6621" x2="668.5122" y1="1253.8281" y2="1253.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1249.4697">(19)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1249.4697">JWT-Signature</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1279.4688" y2="1279.4688"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1279.4688" y2="1292.4688"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1292.4688" y2="1292.4688"/><polygon fill="#181818" points="210.6621,1288.4688,200.6621,1292.4688,210.6621,1296.4688,206.6621,1292.4688" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1275.1104">(20)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1275.1104">Add JWT-Signature to SM(C)-B Access Token</text><path d="M159.6621,1318.4688 L329.833,1318.4688 L329.833,1322.1094 L319.833,1332.1094 L159.6621,1332.1094 L159.6621,1318.4688" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="298.0469" style="stroke:#000000;stroke-width:1.5;" width="475.8018" x="159.6621" y="1318.4688"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="174.6621" y="1328.751">Client Attestation JWT</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1383.0313" y2="1383.0313"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1383.0313" y2="1396.0313"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1396.0313" y2="1396.0313"/><polygon fill="#181818" points="210.6621,1392.0313,200.6621,1396.0313,210.6621,1400.0313,206.6621,1396.0313" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1367.0322">(21)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1355.3916">Generate Client Attestation JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1367.0322">("typ": "oauth-client-attestation+jwt", "alg": "ES256"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1378.6729">"sub": "client_id", "cnf" with public Client Instance Key)</text><path d="M178.6621,1408.0313 L238.6182,1408.0313 L238.6182,1411.6719 L228.6182,1421.6719 L178.6621,1421.6719 L178.6621,1408.0313" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="194.4844" style="stroke:#000000;stroke-width:1.5;" width="431.8018" x="178.6621" y="1408.0313"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="1418.3135">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.6182" y="1419.3135">[Client uses TPM]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="178.6621" x2="610.4639" y1="1545.2344" y2="1545.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="183.6621" y="1556.5166">[Client uses self signed Attestation Key (deprecated)]</text><polygon fill="#181818" points="572.4639,1445.3125,582.4639,1449.3125,572.4639,1453.3125,576.4639,1449.3125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="578.4639" y1="1449.3125" y2="1449.3125"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1444.9541">(22)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1444.9541">Sign Client Attestation JWT with Client Attestation Key</text><polygon fill="#181818" points="210.6621,1470.9531,200.6621,1474.9531,210.6621,1478.9531,206.6621,1474.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="583.4639" y1="1474.9531" y2="1474.9531"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1470.5947">(23)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1470.5947">Client Attestation JWT Signature</text><polygon fill="#181818" points="572.4639,1496.5938,582.4639,1500.5938,572.4639,1504.5938,576.4639,1500.5938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="578.4639" y1="1500.5938" y2="1500.5938"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1496.2354">(24)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1496.2354">Get TPM evidence</text><polygon fill="#181818" points="210.6621,1522.2344,200.6621,1526.2344,210.6621,1530.2344,206.6621,1526.2344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="583.4639" y1="1526.2344" y2="1526.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1521.876">(25)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1521.876">TPM2B_ATTEST Objekt and TPM EK certificate chain</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1581.5156" y2="1581.5156"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1581.5156" y2="1594.5156"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1594.5156" y2="1594.5156"/><polygon fill="#181818" points="210.6621,1590.5156,200.6621,1594.5156,210.6621,1598.5156,206.6621,1594.5156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1577.1572">(26)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1577.1572">Sign Client Attestation JWT with Client Key</text><path d="M178.6621,1634.5156 L431.6602,1634.5156 L431.6602,1638.1563 L421.6602,1648.1563 L178.6621,1648.1563 L178.6621,1634.5156" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="187.125" style="stroke:#000000;stroke-width:1.5;" width="942.5483" x="178.6621" y="1634.5156"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.6621" y="1644.7979">Client Attestation PoP and DPoP JWT</text><polygon fill="#181818" points="1088.2104,1671.7969,1098.2104,1675.7969,1088.2104,1679.7969,1092.2104,1675.7969" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1094.2104" y1="1675.7969" y2="1675.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1671.4385">(27)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1671.4385">GET /nonce</text><polygon fill="#181818" points="210.6621,1697.4375,200.6621,1701.4375,210.6621,1705.4375,206.6621,1701.4375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1099.2104" y1="1701.4375" y2="1701.4375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="1697.0791">(28)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="1697.0791">return 200 OK new-nonce: nonce</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1750.3594" y2="1750.3594"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1750.3594" y2="1763.3594"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1763.3594" y2="1763.3594"/><polygon fill="#181818" points="210.6621,1759.3594,200.6621,1763.3594,210.6621,1767.3594,206.6621,1763.3594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1734.3604">(29)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1722.7197">Generate Client Attestation PoP JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1734.3604">("typ": "oauth-client-attestation-pop+jwt", "nonce"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1746.001">sign with the private Client Instance Key)</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="1800.6406" y2="1800.6406"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="1800.6406" y2="1813.6406"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="1813.6406" y2="1813.6406"/><polygon fill="#181818" points="210.6621,1809.6406,200.6621,1813.6406,210.6621,1817.6406,206.6621,1813.6406" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1790.4619">(30)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1784.6416">Generate DPoP JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1796.2822">("nonce", sign with the private DPoP Key)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="1854.4609"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="1854.4609" y2="1854.4609"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="1857.4609" y2="1857.4609"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="109.3418" x="746.6379" y="1845.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="752.6379" y="1858.9229">Token Exchange</text><polygon fill="#181818" points="1088.2104,1993.6875,1098.2104,1997.6875,1088.2104,2001.6875,1092.2104,1997.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1094.2104" y1="1997.6875" y2="1997.6875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="1940.9463">(31)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="231.1895" y="1888.5635">POST /token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1900.2041">POST /token HTTP/1.1</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1911.8447">Host: auths.example.com</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1923.4854">Content-Type: application/x-www-form-urlencoded</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1935.126">OAuth-Client-Attestation: &lt;Base64url-kodiertes Client Attestation JWT&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1946.7666">OAuth-Client-Attestation-PoP: &lt;Base64url-kodiertes Client Attestation PoP JWT&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1958.4072">grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange&amp;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1970.0479">subject_token=&lt;SM(C)-B Access Token JWT&gt;&amp;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1981.6885">subject_token_type=urn%3Aexample%3Asmc-b-jwt&amp;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="1993.3291">audience=https%3A%2F%2Fbackend.example.com%2Fapi</text><path d="M833.8149,2010.6875 L833.8149,2031.6875 L1099.8149,2031.6875 L1099.8149,2020.6875 L1089.8149,2010.6875 L833.8149,2010.6875" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1089.8149,2010.6875 L1089.8149,2020.6875 L1099.8149,2020.6875 L1089.8149,2010.6875" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="839.8149" y="2024.9697">RFC7523 (JWT Client Assertion), RFC9449 (DPoP)</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2054.9688" y2="2054.9688"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2054.9688" y2="2067.9688"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2067.9688" y2="2067.9688"/><polygon fill="#181818" points="1121.2104,2063.9688,1111.2104,2067.9688,1121.2104,2071.9688,1117.2104,2067.9688" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2050.6104">(32)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2050.6104">verify SM(C)-B Access Token JWT</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2093.6094" y2="2093.6094"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2093.6094" y2="2106.6094"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2106.6094" y2="2106.6094"/><polygon fill="#181818" points="1121.2104,2102.6094,1111.2104,2106.6094,1121.2104,2110.6094,1117.2104,2106.6094" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2089.251">(33)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2089.251">verify Client Attestation JWT and PoP JWT</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2132.25" y2="2132.25"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2132.25" y2="2145.25"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2145.25" y2="2145.25"/><polygon fill="#181818" points="1121.2104,2141.25,1111.2104,2145.25,1121.2104,2149.25,1117.2104,2145.25" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2127.8916">(34)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2127.8916">Create state for Session, Identity and Client</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1592.6177" x="5" y="2201.7109"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="2201.7109" y2="2201.7109"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1597.6177" y1="2204.7109" y2="2204.7109"/><rect fill="#EEEEEE" height="19.6406" style="stroke:#000000;stroke-width:2;" width="156.4414" x="723.0881" y="2192.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="729.0881" y="2206.1729">Refresh Token Exchange</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="2240.1719" y2="2240.1719"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="2240.1719" y2="2253.1719"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="2253.1719" y2="2253.1719"/><polygon fill="#181818" points="210.6621,2249.1719,200.6621,2253.1719,210.6621,2257.1719,206.6621,2253.1719" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2235.8135">(35)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2235.8135">create DPoP JWT without nonce</text><polygon fill="#181818" points="1088.2104,2309.7344,1098.2104,2313.7344,1088.2104,2317.7344,1092.2104,2313.7344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="1094.2104" y1="2313.7344" y2="2313.7344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2291.915">(36)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2274.4541">POST /token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2286.0947">DPoP: ... (DPoP JWT)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2297.7354">grant_type=refresh_token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2309.376">refresh_token= ... (Refresh token)</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2339.375" y2="2339.375"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2339.375" y2="2352.375"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2352.375" y2="2352.375"/><polygon fill="#181818" points="1121.2104,2348.375,1111.2104,2352.375,1121.2104,2356.375,1117.2104,2352.375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2335.0166">(37)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2335.0166">verify Refresh token and DPoP JWT</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2378.0156" y2="2378.0156"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2378.0156" y2="2391.0156"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2391.0156" y2="2391.0156"/><polygon fill="#181818" points="1121.2104,2387.0156,1111.2104,2391.0156,1121.2104,2395.0156,1117.2104,2391.0156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2373.6572">(38)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2373.6572">invalidate Refresh token</text><polygon fill="#181818" points="1384.8628,2426.6563,1394.8628,2430.6563,1384.8628,2434.6563,1388.8628,2430.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1390.8628" y1="2430.6563" y2="2430.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2426.2979">(39)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2426.2979">POST /v1/data/authz, json body {  "input": {...}}</text><polygon fill="#181818" points="1121.2104,2463.9375,1111.2104,2467.9375,1121.2104,2471.9375,1117.2104,2467.9375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1115.2104" x2="1395.8628" y1="2467.9375" y2="2467.9375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1127.2104" y="2457.7588">(40)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1151.7378" y="2451.9385">200 OK, json body {"result": {"allow": true,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1151.7378" y="2463.5791">"access_token_attributes": {...}}</text><line style="stroke:#181818;stroke-width:1;" x1="1110.2104" x2="1152.2104" y1="2505.2188" y2="2505.2188"/><line style="stroke:#181818;stroke-width:1;" x1="1152.2104" x2="1152.2104" y1="2505.2188" y2="2518.2188"/><line style="stroke:#181818;stroke-width:1;" x1="1111.2104" x2="1152.2104" y1="2518.2188" y2="2518.2188"/><polygon fill="#181818" points="1121.2104,2514.2188,1111.2104,2518.2188,1121.2104,2522.2188,1117.2104,2518.2188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1117.2104" y="2495.04">(41)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1141.7378" y="2489.2197">issue Access and Refresh token with DPoP Binding</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1148.0952" y="2500.8604">and Access token attributes</text><polygon fill="#181818" points="210.6621,2539.8594,200.6621,2543.8594,210.6621,2547.8594,206.6621,2543.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="1099.2104" y1="2543.8594" y2="2543.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="2539.501">(42)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="2539.501">200 OK, Access token, Refresh token, bound to DPoP</text><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="241.6621" y1="2569.5" y2="2569.5"/><line style="stroke:#181818;stroke-width:1;" x1="241.6621" x2="241.6621" y1="2569.5" y2="2582.5"/><line style="stroke:#181818;stroke-width:1;" x1="200.6621" x2="241.6621" y1="2582.5" y2="2582.5"/><polygon fill="#181818" points="210.6621,2578.5,200.6621,2582.5,210.6621,2586.5,206.6621,2582.5" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2565.1416">(43)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2565.1416">Create DPoP Proof for RS</text><polygon fill="#181818" points="867.0708,2627.4219,877.0708,2631.4219,867.0708,2635.4219,871.0708,2631.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.6621" x2="873.0708" y1="2631.4219" y2="2631.4219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.6621" y="2615.4229">(44)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="231.1895" y="2603.7822">GET /resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2615.4229">Authorization: DPoP ... (Accesss token)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="237.5469" y="2627.0635">DPoP: ... (DPoP token)</text><line style="stroke:#181818;stroke-width:1;" x1="889.0708" x2="931.0708" y1="2657.0625" y2="2657.0625"/><line style="stroke:#181818;stroke-width:1;" x1="931.0708" x2="931.0708" y1="2657.0625" y2="2670.0625"/><line style="stroke:#181818;stroke-width:1;" x1="890.0708" x2="931.0708" y1="2670.0625" y2="2670.0625"/><polygon fill="#181818" points="900.0708,2666.0625,890.0708,2670.0625,900.0708,2674.0625,896.0708,2670.0625" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="896.0708" y="2652.7041">(45)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.5981" y="2652.7041">verify Access token and DPoP Proof</text><line style="stroke:#181818;stroke-width:1;" x1="889.0708" x2="931.0708" y1="2707.3438" y2="2707.3438"/><line style="stroke:#181818;stroke-width:1;" x1="931.0708" x2="931.0708" y1="2707.3438" y2="2720.3438"/><line style="stroke:#181818;stroke-width:1;" x1="890.0708" x2="931.0708" y1="2720.3438" y2="2720.3438"/><polygon fill="#181818" points="900.0708,2716.3438,890.0708,2720.3438,900.0708,2724.3438,896.0708,2720.3438" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="896.0708" y="2697.165">(46)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.5981" y="2691.3447">additional checks according to</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.5981" y="2702.9854">Access token attributes</text><polygon fill="#181818" points="1493.3989,2753.625,1503.3989,2757.625,1493.3989,2761.625,1497.3989,2757.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="889.0708" x2="1499.3989" y1="2757.625" y2="2757.625"/><text fill="#000000" font-family="Helvetica" font-size="10" x="896.0708" y="2747.4463">(47)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.5981" y="2741.626">forward GET /resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="920.5981" y="2753.2666">with header and header content as json</text><line style="stroke:#181818;stroke-width:1;" x1="1515.3989" x2="1557.3989" y1="2806.5469" y2="2806.5469"/><line style="stroke:#181818;stroke-width:1;" x1="1557.3989" x2="1557.3989" y1="2806.5469" y2="2819.5469"/><line style="stroke:#181818;stroke-width:1;" x1="1516.3989" x2="1557.3989" y1="2819.5469" y2="2819.5469"/><polygon fill="#181818" points="1526.3989,2815.5469,1516.3989,2819.5469,1526.3989,2823.5469,1522.3989,2819.5469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1522.3989" y="2790.5479">(48)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1546.9263" y="2778.9072">provide</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1546.9263" y="2790.5479">resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1546.9263" y="2802.1885">access</text><polygon fill="#181818" points="900.0708,2841.1875,890.0708,2845.1875,900.0708,2849.1875,896.0708,2845.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="894.0708" x2="1504.3989" y1="2845.1875" y2="2845.1875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="906.0708" y="2840.8291">(49)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="930.5981" y="2840.8291">200 OK, resource</text><polygon fill="#181818" points="210.6621,2866.8281,200.6621,2870.8281,210.6621,2874.8281,206.6621,2870.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.6621" x2="878.0708" y1="2870.8281" y2="2870.8281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.6621" y="2866.4697">(50)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.1895" y="2866.4697">200 OK, resource</text><!--SRC=[fLZhSkEs5VxFfpXL9etjYhx5IRjgl1tPbYzxCokfizECPdOWyaZYIW8u86XPcycxz4SUOtzbNwpd0AH4IgBZRcUyAm8uz_FXu00YCqfcyo5gQEmT7-ytl7GQoqHeCOS8HoARcMibJI_-X71ol7lndPWZtEBi0KqSYXBDbQDvgwHA4n5YjAA-L9cEKPTePoZ7PjAEFcQf0QaaUjwV4Yt6Sm46rISmEgEfTcYKXd-bn3fKZz1uqxbhm3St4vMQzvFOe0TWvmCTpx_yfjDbQd1E56_40yg8k01oYfyx_JPSpcAKXjPxGaRB2wqMqb80a57aJ9m8QN8g4AdZ6iYSpPAIM1ReRJBrWxUMWtwPS4rM9dgjfCGfkyIawv7I0zc_ys-4mOLODZQuUcylB7tlxTxbld_Hy0hXBYPjEOpHe2Qt-ftBstVtR-vl_ksLtRx9X8wslIxhk0siYg0J3EJ4c0G2hHwNZIswTcOcFKTwHQGyL3h-94oi9FHGFx0TMrn1PyqIg5aSBg4Znx74QgYSpVqxE3qyXYkAEK7ZcokXfpqKDnfnLxAwpfekfWIn40iRAhbQnOk11FxBFCCj2onOa9WKZ1f84OQOfg1pMGE29Mm8zaHeuWVAKox3yyxFoTGqLBIuXFDppnjhbILGmXjCoC8DEN3zpwjtiDVj-VonJ-Rcj6JTRT22cquVZWuNE9lvKqa9ErA2GkqdMXaC3KP-OIJSqbveGIw8vAmCl0reH7drImuNlwV7nt3_-k_mCIKNXofQmY8s4tZF-bwpFhTofS9ipbRjTQyl8T9YP7p2siXtrXGs-7Cq8X96i1yHLYrO-sMnK-kQA4F9JssKVl-FyyvoRZbePsd2ORBivjUuzxUpaxCD-mi5z2Sfxg3ZySI06XMvPupTZqOe4QwfTA5isIcV5Ea89KGnEftMJtZLktz7EgTM9q8QZoNLHFEF5PCakqGJA3JX15FucHRZKJmLXipN4Oo-VDPMPeyuXSaqK8WMNEVMCcZLqbR8ldocUf_eBvz7bf2t0_lZySPm05vACO_38bTT7CUfqMvJ4wJ5p9IXB1M4TlGX9lOT6GxkUvHYRQKGr3cwV_tXnSd-yvANYxkJ8wNdpWRQF8cIAReqhfIN91UUlCObt512riRli3uVjOt1r3X2vWj4p0T6YJvBAGrKqMrqrsvosMZ1_T28M48xciToLJkCMj6xObDoZ8y8ImsEU4CgBPFp6jV5PQU5GFo5YbKqYmbMKLOPP4EgjfjoB6a9vuuRPobM74znDh8enMZBahq84uqXSKVx6twiykXSAKjvEl2SG_vNcx0xEX24f9fNOghLMyjZeRAjuq7C254QHrJL9fJ7AHqtZAW-VsrY2i1L-Vn8XhRBlgDzzRxlrSHaxCGWN0KgW2cPbB19DTG71pS5VPsYWuE1t6kOPT9eGOF6ZIOqn6pCeqxlz8SV6mFPIBCXZmtEaFVJb7PEeydpeKgGL-WCJHCCgTQ4O2VJ1ZH2EQ8rk-4IXwBTsTjC_wghQG4-qlQNOiPxd5RZy2bFVCh3f8hgbIWxlMwNI0lrH2sBgXfMMhSJt3jLZMBweZBYvaues2gwYdGyoLcrTJkNxIYg2k1IiIiM-KPOGMn7r1bWVuYOtNmLlBY3rvLJNwm9__9nOPu0qgh-CWt3P1TAollEGQIkhcxLG0vHZVbEqsuWviAsQk9sLQoHNStjbbatwBfyV8ZfS0-nHZYDJoy-jFlz3Xs2zyEF10gWljlITLv3w0vrknN22HqWkPYjSlp_5kHTy7XkP8jeCX3_68vSojX3MzEsiPat1GHDRloefmxnuC3IR9_z6Yd-Ck_VGEB2j_Gji3zV1VhSg6S1tqzKKe3VQYJKso9ZWqD5319TxlvteFn9ywugnZWDJTYjmTBcOelknXNBpYC1HuxHdaGxukpQBtk2iQBI46xx_U3evF1a85rZpN583_5Hp9CP7ePgJfTTkhDpMFhBXE8kacJ6OANW73twYyN2vwxCppJTtqCLOJIGzwpOTtRufSYtuASBaUAFPqJiJrN4lIw1U3VyNjRByIaGpvULHvZaZJLTx3vGnl6SCFNjzss-kT2FVNz8wSEYW7ujeS-4DB1nyZ4FyPyf_ndjuP04ySBvJtN7ryjDqhBcFC3qbSv3V-WJn8XSPEG7GU2SBzniqBUdr_Gt526nH-MiqAn8Oi_pZhvxHi89XFzh3i72hGM7XuUmLw1qd-U_Behae3z4eL6p396cNFMKFCVbgudLKMIkMB7wlE-EF7lHck78thEAIu9jyq-_XpqkL9ki-qrUVt5sziAPRYy3xeAJ5vXLgEY-58-MzLrR3NrDnUIQLvIyJSwY-JNyFuMRhlrfIenDk8ku5J9Boruy8fHBFVUZhXdjRZMZnSoJXQ0eFA6peKYdBJ4gCtajhRcrMLtF14JUB7zOyLGcpXrpnOdzkX1NgAgdoIP7B6rqsBLgW6oLN547dSAbXvCZVfmuOg1-QfOU1Nu1QCGooGoT2R-GiR_-2kltdQ3Z1HrxEELwtQ5KuM-GzcncsQbPcga5VV739NVNxewNrm8wOtGyp0W_ArLUwSGdNLjUfcc61K8v7jK8sUF2XkWYbb4intQV4Lcxk8VQEAxKUdMF9CqAHxEgfab-PYIKMbNMvMszZNYrrozhMw0LxMA6VxVdxNZWMh-qkMPWzVxJSlmMGCw-tC3zNT3CeLL-T-9tBwSe1rWrBWM-h84bOX55CUiNCshEC9ocV5LNcWDiNmZhekiaT2blvEn2w6ZJFvkl2Oe8jTMUVuQkKFCJ9iDgxGB5gzihP2PQSSyva6jv-Gj2rwMKJI_IMT2KaqNIDXu2dwA-3JPuIwEyOFqN]--></g></svg>