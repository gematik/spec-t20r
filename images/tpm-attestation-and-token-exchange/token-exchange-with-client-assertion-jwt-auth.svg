<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="2526px" preserveAspectRatio="none" style="width:1464px;height:2526px;background:#FFFFFF;" version="1.1" viewBox="0 0 1464 2526" width="1464px" zoomAndPan="magnify"><defs/><g><rect fill="#F8F8FF" height="2514.875" style="stroke:#181818;stroke-width:0.5;" width="977.2695" x="39.793" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="519.9658" y="15.2822">LEI</text><rect fill="#E6E6FA" height="2498.2344" style="stroke:#181818;stroke-width:0.5;" width="758.978" x="39.793" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="380.1853" y="31.9229">Prim&#228;rsystem</text><rect fill="#F4A460" height="2481.5938" style="stroke:#181818;stroke-width:0.5;" width="89" x="39.793" y="39.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="51.793" y="48.5635">ZETA Client</text><rect fill="#C9FFC9" height="2514.875" style="stroke:#181818;stroke-width:0.5;" width="429.8926" x="1029.0625" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1219.6484" y="15.2822">Anbieter</text><rect fill="#F4A460" height="2498.2344" style="stroke:#181818;stroke-width:0.5;" width="429.8926" x="1029.0625" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1210.8643" y="31.9229">ZETA Guard</text><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="2316.6719" width="8" x="15.8965" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="19.3965" x2="19.3965" y1="126.5625" y2="2443.2344"/></g><g><title>ZETA</title><rect fill="#000000" fill-opacity="0.00000" height="2316.6719" width="8" x="80.793" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="84.293" x2="84.293" y1="126.5625" y2="2443.2344"/></g><g><title/><rect fill="#FFFFFF" height="2303.6719" style="stroke:#181818;stroke-width:1;" width="10" x="79.293" y="134.5625"/></g><g><title>ZETA Attestation Service</title><rect fill="#000000" fill-opacity="0.00000" height="2316.6719" width="8" x="401.1709" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="404.6709" x2="404.6709" y1="126.5625" y2="2443.2344"/></g><g><title/><rect fill="#FFFFFF" height="144.8438" style="stroke:#181818;stroke-width:1;" width="10" x="399.6709" y="381.9688"/></g><g><title>TPM</title><rect fill="#000000" fill-opacity="0.00000" height="2316.6719" width="8" x="773.8877" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="777.3877" x2="777.3877" y1="126.5625" y2="2443.2344"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="772.3877" y="436.8906"/></g><g><title>Konnektor or</title><rect fill="#000000" fill-opacity="0.00000" height="2316.6719" width="8" x="850.6978" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="854.1978" x2="854.1978" y1="126.5625" y2="2443.2344"/></g><g><title/><rect fill="#FFFFFF" height="76.9219" style="stroke:#181818;stroke-width:1;" width="10" x="849.1978" y="933.75"/></g><g><title>SM(C)-B</title><rect fill="#000000" fill-opacity="0.00000" height="2316.6719" width="8" x="982.4478" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="985.9478" x2="985.9478" y1="126.5625" y2="2443.2344"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="980.9478" y="959.3906"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="2316.6719" width="8" x="1088.0371" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1091.5371" x2="1091.5371" y1="126.5625" y2="2443.2344"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="1086.5371" y="152.2031"/></g><g><title/><rect fill="#FFFFFF" height="1176.5938" style="stroke:#181818;stroke-width:1;" width="10" x="1086.5371" y="1234.6406"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="2316.6719" width="8" x="1411.1689" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1414.6689" x2="1414.6689" y1="126.5625" y2="2443.2344"/></g><g><title/><rect fill="#FFFFFF" height="60.5625" style="stroke:#181818;stroke-width:1;" width="10" x="1409.6689" y="2021.0625"/></g><text fill="#000000" font-family="Helvetica" font-size="10" x="5" y="124.2041">User</text><ellipse cx="19.3965" cy="63.4219" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M19.3965,71.4219 L19.3965,98.4219 M6.3965,79.4219 L32.3965,79.4219 M19.3965,98.4219 L6.3965,113.4219 M19.3965,98.4219 L32.3965,113.4219" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="62.8179" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="71.2339" y="104.5635">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="69.8179" y="116.2041">Client</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.6826" x="335.3296" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="342.3296" y="104.5635">ZETA Attestation Service</text><text fill="#000000" font-family="Helvetica" font-size="10" x="368.8042" y="116.2041">(Admin rights)</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="760.0044" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="767.0044" y="116.2041">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="814.771" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="821.771" y="104.5635">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="825.7773" y="116.2041">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="958.833" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="965.833" y="116.2041">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="1033.0625" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1081.6567" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1040.0625" y="116.2041">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1374.3828" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1404.7886" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1381.3828" y="116.2041">Policy Engine</text><text fill="#000000" font-family="Helvetica" font-size="10" x="5" y="2512.5166">User</text><ellipse cx="19.3965" cy="2451.7344" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M19.3965,2459.7344 L19.3965,2486.7344 M6.3965,2467.7344 L32.3965,2467.7344 M19.3965,2486.7344 L6.3965,2501.7344 M19.3965,2486.7344 L32.3965,2501.7344" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="62.8179" y="2443.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="71.2339" y="2459.5166">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="69.8179" y="2471.1572">Client</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.6826" x="335.3296" y="2443.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="342.3296" y="2459.5166">ZETA Attestation Service</text><text fill="#000000" font-family="Helvetica" font-size="10" x="368.8042" y="2471.1572">(Admin rights)</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="760.0044" y="2443.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="767.0044" y="2459.5166">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="814.771" y="2443.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="821.771" y="2459.5166">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="825.7773" y="2471.1572">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="958.833" y="2443.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="965.833" y="2459.5166">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="1033.0625" y="2443.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1081.6567" y="2459.5166">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1040.0625" y="2471.1572">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1374.3828" y="2443.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1404.7886" y="2459.5166">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1381.3828" y="2471.1572">Policy Engine</text><polygon fill="#181818" points="1074.5371,148.2031,1084.5371,152.2031,1074.5371,156.2031,1078.5371,152.2031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="1080.5371" y1="152.2031" y2="152.2031"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="147.8447">(01)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="147.8447">GET /nonce</text><polygon fill="#181818" points="100.293,173.8438,90.293,177.8438,100.293,181.8438,96.293,177.8438" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="94.293" x2="1085.5371" y1="177.8438" y2="177.8438"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="173.4854">(02)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="173.4854">return 200 OK new-nonce: nonce</text><path d="M68.293,189.8438 L128.249,189.8438 L128.249,193.4844 L118.249,203.4844 L68.293,203.4844 L68.293,189.8438" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1771.9375" style="stroke:#000000;stroke-width:1.5;" width="1287.2881" x="68.293" y="189.8438"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="83.293" y="200.126">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="143.249" y="201.126">[ZETA Client uses SM(C)-B Access Token (Initial Token Exchange with Attestation)]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="68.293" x2="1355.5811" y1="1509.6875" y2="1509.6875"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="73.293" y="1520.9697">[ZETA Client uses Refresh Token (Renewal without Attestation)]</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="231.125" y2="231.125"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="231.125" y2="244.125"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="244.125" y2="244.125"/><polygon fill="#181818" points="100.293,240.125,90.293,244.125,100.293,248.125,96.293,244.125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="226.7666">(03)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="226.7666">Create DPoP Key Pair (for Token Exchange)</text><path d="M349.9932,218.4844 L349.9932,239.4844 L575.9932,239.4844 L575.9932,228.4844 L565.9932,218.4844 L349.9932,218.4844" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M565.9932,218.4844 L565.9932,228.4844 L575.9932,228.4844 L565.9932,218.4844" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="355.9932" y="232.7666">Session-based Key Pair for DPoP binding.</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="281.4063" y2="281.4063"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="281.4063" y2="294.4063"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="294.4063" y2="294.4063"/><polygon fill="#181818" points="100.293,290.4063,90.293,294.4063,100.293,298.4063,96.293,294.4063" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="271.2275">(04)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="265.4072">Calculate Public Key Hash</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="277.0479">(e.g., SHA256(PublicKeyJWK))</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="331.6875" y2="331.6875"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="331.6875" y2="344.6875"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="344.6875" y2="344.6875"/><polygon fill="#181818" points="100.293,340.6875,90.293,344.6875,100.293,348.6875,96.293,344.6875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="321.5088">(05)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="315.6885">Calculate attestation_challenge for TPM</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="327.3291">`attestation_challenge = HASH(pubKeyHash + nonce)`</text><polygon fill="#181818" points="387.6709,377.9688,397.6709,381.9688,387.6709,385.9688,391.6709,381.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="393.6709" y1="381.9688" y2="381.9688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="371.79">(06)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="365.9697">Get Attestation</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="377.6104">with `attestation_challenge`</text><path d="M414.6709,357.6875 L414.6709,401.6875 L635.6709,401.6875 L635.6709,367.6875 L625.6709,357.6875 L414.6709,357.6875" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M625.6709,357.6875 L625.6709,367.6875 L635.6709,367.6875 L625.6709,357.6875" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="420.6709" y="371.9697">Die TPM-Attestierung wird nur beim</text><text fill="#000000" font-family="Helvetica" font-size="10" x="420.6709" y="383.6104">initialen Token-Austausch durchgef&#252;hrt,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="420.6709" y="395.251">um die Integrit&#228;t des Clients zu pr&#252;fen.</text><polygon fill="#181818" points="760.3877,432.8906,770.3877,436.8906,760.3877,440.8906,764.3877,436.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="409.6709" x2="766.3877" y1="436.8906" y2="436.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" x="416.6709" y="426.7119">(07)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="441.1982" y="420.8916">Get TPM Quote for PCRs (4, 5, 7, 10, 11, 22 or 23)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="441.1982" y="432.5322">and `attestation_challenge` (as qualifyingData), signed with AK</text><polygon fill="#181818" points="420.6709,458.5313,410.6709,462.5313,420.6709,466.5313,416.6709,462.5313" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="414.6709" x2="771.3877" y1="462.5313" y2="462.5313"/><text fill="#000000" font-family="Helvetica" font-size="10" x="426.6709" y="458.1729">(08)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="451.1982" y="458.1729">Return TPM Quote</text><line style="stroke:#181818;stroke-width:1;" x1="409.6709" x2="451.6709" y1="488.1719" y2="488.1719"/><line style="stroke:#181818;stroke-width:1;" x1="451.6709" x2="451.6709" y1="488.1719" y2="501.1719"/><line style="stroke:#181818;stroke-width:1;" x1="410.6709" x2="451.6709" y1="501.1719" y2="501.1719"/><polygon fill="#181818" points="420.6709,497.1719,410.6709,501.1719,420.6709,505.1719,416.6709,501.1719" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="416.6709" y="483.8135">(09)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="441.1982" y="483.8135">Get TCG Event Log</text><polygon fill="#181818" points="100.293,522.8125,90.293,526.8125,100.293,530.8125,96.293,526.8125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="94.293" x2="398.6709" y1="526.8125" y2="526.8125"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="522.4541">(10)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="522.4541">Return Attestation (Quote, EventLog, CertChain)</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="587.375" y2="587.375"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="587.375" y2="600.375"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="600.375" y2="600.375"/><polygon fill="#181818" points="100.293,596.375,90.293,600.375,100.293,604.375,96.293,600.375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="565.5557">(11)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="548.0947">Create Client Statement JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="559.7354">with posture-tpm,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="571.376">includes Attestation</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="583.0166">Signed with Client Instance Key</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="626.0156" y2="626.0156"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="626.0156" y2="639.0156"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="639.0156" y2="639.0156"/><polygon fill="#181818" points="100.293,635.0156,90.293,639.0156,100.293,643.0156,96.293,639.0156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="621.6572">(12)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="621.6572">Create Client Assertion JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="261.5576" y="621.6572">with Attestation</text><path d="M365.3643,613.375 L365.3643,774.375 L680.3643,774.375 L680.3643,623.375 L670.3643,613.375 L365.3643,613.375" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M670.3643,613.375 L670.3643,623.375 L680.3643,623.375 L670.3643,613.375" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="371.3643" y="627.6572">Client Assertion JWT Claims (with Attestation):</text><text fill="#000000" font-family="Helvetica" font-size="10" x="371.3643" y="639.2979">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="650.9385">"iss": "&lt;client_id&gt;", "sub": "&lt;client_id&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="662.5791">"aud": "&lt;AS_Token_Endpoint_URL&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="674.2197">"exp": ..., "jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="685.8604">"cnf": { "jkt": "&lt;DPoP_Key_Thumbprint&gt;" },</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="697.501">// Embed the fresh attestation</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="709.1416">"urn:gematik:params:oauth:client-attestation:tpm2": {</text><text fill="#000000" font-family="Helvetica" font-size="10" x="387.2578" y="720.7822">"attestation_data": "&lt;Base64(Client Statement JWT)&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="387.2578" y="732.4229">"client_statement_format": "client-statement-jwt"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="380.9004" y="744.0635">}</text><text fill="#000000" font-family="Helvetica" font-size="10" x="371.3643" y="755.7041">}</text><text fill="#000000" font-family="Helvetica" font-size="10" x="371.3643" y="767.3447">(sig by Client_Instance_Private_Key)</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="797.3438" y2="797.3438"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="797.3438" y2="810.3438"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="810.3438" y2="810.3438"/><polygon fill="#181818" points="100.293,806.3438,90.293,810.3438,100.293,814.3438,96.293,810.3438" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="792.9854">(13)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="792.9854">Create "SM(C)-B Access Token" (JWT)</text><path d="M320.0762,784.7031 L320.0762,910.7031 L753.0762,910.7031 L753.0762,794.7031 L743.0762,784.7031 L320.0762,784.7031" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M743.0762,784.7031 L743.0762,794.7031 L753.0762,794.7031 L743.0762,784.7031" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="326.0762" y="798.9854">SM(C)-B Access Token Claims:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="326.0762" y="810.626">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="822.2666">"iss": "&lt;client_id&gt;", // Issuer is the client</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="833.9072">"sub": "&lt;Telematik-ID from SM(C)-B&gt;", // Subject is the institution</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="845.5479">"aud": "[&lt;Resource_Server_Endpoint_URL&gt;]", // Audience is the Resource Server</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="857.1885">"exp": ..., // Short-lived</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="868.8291">"iat": ...,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="880.4697">"jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="892.1104">"scope": ... // As required for the Resource Server access</text><text fill="#000000" font-family="Helvetica" font-size="10" x="326.0762" y="903.751">}</text><polygon fill="#181818" points="837.1978,929.75,847.1978,933.75,837.1978,937.75,841.1978,933.75" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="843.1978" y1="933.75" y2="933.75"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="929.3916">(14)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="929.3916">externalAuthenticate (JWT-hash)</text><polygon fill="#181818" points="968.9478,955.3906,978.9478,959.3906,968.9478,963.3906,972.9478,959.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="859.1978" x2="974.9478" y1="959.3906" y2="959.3906"/><text fill="#000000" font-family="Helvetica" font-size="10" x="866.1978" y="955.0322">(15)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="890.7251" y="955.0322">sign (JWT-hash)</text><polygon fill="#181818" points="870.1978,981.0313,860.1978,985.0313,870.1978,989.0313,866.1978,985.0313" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="864.1978" x2="979.9478" y1="985.0313" y2="985.0313"/><text fill="#000000" font-family="Helvetica" font-size="10" x="876.1978" y="980.6729">(16)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="900.7251" y="980.6729">JWT-Signature</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="1010.6719" y2="1006.6719"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="1010.6719" y2="1014.6719"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="848.1978" y1="1010.6719" y2="1010.6719"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="1006.3135">(17)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="1006.3135">JWT-signature</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="1036.3125" y2="1036.3125"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="1036.3125" y2="1049.3125"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="1049.3125" y2="1049.3125"/><polygon fill="#181818" points="100.293,1045.3125,90.293,1049.3125,100.293,1053.3125,96.293,1049.3125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1031.9541">(18)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1031.9541">Add JWT-Signature to SM(C)-B Access Token</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="1074.9531" y2="1074.9531"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="1074.9531" y2="1087.9531"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="1087.9531" y2="1087.9531"/><polygon fill="#181818" points="100.293,1083.9531,90.293,1087.9531,100.293,1091.9531,96.293,1087.9531" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1070.5947">(19)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1070.5947">Create DPoP Proof JWT for Token Exchange</text><path d="M349.3584,1062.3125 L349.3584,1211.3125 L627.3584,1211.3125 L627.3584,1072.3125 L617.3584,1062.3125 L349.3584,1062.3125" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M617.3584,1062.3125 L617.3584,1072.3125 L627.3584,1072.3125 L617.3584,1062.3125" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="355.3584" y="1076.5947">DPoP Proof JWT Claims (for Token Exchange):</text><text fill="#000000" font-family="Helvetica" font-size="10" x="355.3584" y="1088.2354">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1099.876">"typ": "dpop+jwt",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1111.5166">"alg": "ES256",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1123.1572">"jwk": { ... }</text><text fill="#000000" font-family="Helvetica" font-size="10" x="355.3584" y="1134.7979">}.{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1146.4385">"jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1158.0791">"htm": "POST",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1169.7197">"htu": "&lt;AS_Token_Endpoint_URL&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1181.3604">"nonce": "&lt;nonce from AS&gt;", // Binding to AS</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1193.001">"iat": ...</text><text fill="#000000" font-family="Helvetica" font-size="10" x="355.3584" y="1204.6416">}.(sig by DPoP_Private_Key)</text><polygon fill="#181818" points="1074.5371,1230.6406,1084.5371,1234.6406,1074.5371,1238.6406,1078.5371,1234.6406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="1080.5371" y1="1234.6406" y2="1234.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1230.2822">(20)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1230.2822">POST /token (RFC 8693) DPoP: &lt;signed_dpop_jwt&gt;</text><path d="M94.293,1247.6406 L94.293,1338.6406 L507.293,1338.6406 L507.293,1257.6406 L497.293,1247.6406 L94.293,1247.6406" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M497.293,1247.6406 L497.293,1257.6406 L507.293,1257.6406 L497.293,1247.6406" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="100.293" y="1261.9229">Token Exchange Request Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1273.5635">grant_type=urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1285.2041">&amp;subject_token=&lt;SM(C)-B_Access_Token&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1296.8447">&amp;subject_token_type=urn:ietf:params:oauth:token-type:jwt</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1308.4854">&amp;client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1320.126">&amp;client_assertion=&lt;Client_Assertion_JWT_</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="312.8564" y="1320.126">with</text><text fill="#000000" font-family="Helvetica" font-size="10" x="337.4219" y="1320.126">_Attestation&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1331.7666">...</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1361.7656" y2="1361.7656"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1361.7656" y2="1374.7656"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1374.7656" y2="1374.7656"/><polygon fill="#181818" points="1107.5371,1370.7656,1097.5371,1374.7656,1107.5371,1378.7656,1103.5371,1374.7656" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1357.4072">(21)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1357.4072">Validate subject_token (sig, claims)</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1400.4063" y2="1400.4063"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1400.4063" y2="1413.4063"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1413.4063" y2="1413.4063"/><polygon fill="#181818" points="1107.5371,1409.4063,1097.5371,1413.4063,1107.5371,1417.4063,1103.5371,1413.4063" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1396.0479">(22)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1396.0479">Validate client_assertion (sig, claims)</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1439.0469" y2="1439.0469"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1439.0469" y2="1452.0469"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1452.0469" y2="1452.0469"/><polygon fill="#181818" points="1107.5371,1448.0469,1097.5371,1452.0469,1107.5371,1456.0469,1103.5371,1452.0469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1434.6885">(23)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1128.0645" y="1434.6885">Validate embedded TPM Attestation</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1477.6875" y2="1477.6875"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1477.6875" y2="1490.6875"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1490.6875" y2="1490.6875"/><polygon fill="#181818" points="1107.5371,1486.6875,1097.5371,1490.6875,1107.5371,1494.6875,1103.5371,1490.6875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1473.3291">(24)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1473.3291">Validate DPoP Proof JWT</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="1545.9688" y2="1545.9688"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="1545.9688" y2="1558.9688"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="1558.9688" y2="1558.9688"/><polygon fill="#181818" points="100.293,1554.9688,90.293,1558.9688,100.293,1562.9688,96.293,1558.9688" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1541.6104">(25)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1541.6104">Create Client Assertion JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="261.5576" y="1541.6104">without Attestation</text><path d="M384.1338,1533.3281 L384.1338,1659.3281 L687.1338,1659.3281 L687.1338,1543.3281 L677.1338,1533.3281 L384.1338,1533.3281" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M677.1338,1533.3281 L677.1338,1543.3281 L687.1338,1543.3281 L677.1338,1533.3281" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="390.1338" y="1547.6104">Client Assertion JWT Claims (without Attestation):</text><text fill="#000000" font-family="Helvetica" font-size="10" x="390.1338" y="1559.251">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1570.8916">"iss": "&lt;client_id&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1582.5322">"sub": "&lt;client_id&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1594.1729">"aud": "&lt;AS_Token_Endpoint_URL&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1605.8135">"exp": ...,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1617.4541">"jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1629.0947">"cnf": { "jkt": "&lt;DPoP_Key_Thumbprint&gt;" }</text><text fill="#000000" font-family="Helvetica" font-size="10" x="390.1338" y="1640.7354">}</text><text fill="#000000" font-family="Helvetica" font-size="10" x="390.1338" y="1652.376">(sig by Client_Instance_Private_Key)</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="1682.375" y2="1682.375"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="1682.375" y2="1695.375"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="1695.375" y2="1695.375"/><polygon fill="#181818" points="100.293,1691.375,90.293,1695.375,100.293,1699.375,96.293,1695.375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1678.0166">(26)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1678.0166">Create DPoP Proof JWT for Token Exchange</text><polygon fill="#181818" points="1074.5371,1717.0156,1084.5371,1721.0156,1074.5371,1725.0156,1078.5371,1721.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="1080.5371" y1="1721.0156" y2="1721.0156"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1716.6572">(27)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1716.6572">POST /token DPoP: &lt;signed_dpop_jwt&gt;</text><path d="M94.293,1734.0156 L94.293,1802.0156 L507.293,1802.0156 L507.293,1744.0156 L497.293,1734.0156 L94.293,1734.0156" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M497.293,1734.0156 L497.293,1744.0156 L507.293,1744.0156 L497.293,1734.0156" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="100.293" y="1748.2979">Token Exchange Request Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1759.9385">grant_type=refresh_token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1771.5791">&amp;refresh_token=&lt;Refresh_Token&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1783.2197">&amp;client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1794.8604">&amp;client_assertion=&lt;Client_Assertion_JWT_</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="312.8564" y="1794.8604">without</text><text fill="#000000" font-family="Helvetica" font-size="10" x="356.1914" y="1794.8604">_Attestation&gt;</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1824.8594" y2="1824.8594"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1824.8594" y2="1837.8594"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1837.8594" y2="1837.8594"/><polygon fill="#181818" points="1107.5371,1833.8594,1097.5371,1837.8594,1107.5371,1841.8594,1103.5371,1837.8594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1820.501">(28)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1820.501">Verify Refresh token</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1863.5" y2="1863.5"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1863.5" y2="1876.5"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1876.5" y2="1876.5"/><polygon fill="#181818" points="1107.5371,1872.5,1097.5371,1876.5,1107.5371,1880.5,1103.5371,1876.5" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1859.1416">(29)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1859.1416">Invalidate Refresh token</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1902.1406" y2="1902.1406"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1902.1406" y2="1915.1406"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1915.1406" y2="1915.1406"/><polygon fill="#181818" points="1107.5371,1911.1406,1097.5371,1915.1406,1107.5371,1919.1406,1103.5371,1915.1406" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1897.7822">(30)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1897.7822">Validate client_assertion (sig, claims)</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1940.7813" y2="1940.7813"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1940.7813" y2="1953.7813"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1953.7813" y2="1953.7813"/><polygon fill="#181818" points="1107.5371,1949.7813,1097.5371,1953.7813,1107.5371,1957.7813,1103.5371,1953.7813" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1936.4229">(31)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1936.4229">Validate DPoP Proof JWT</text><path d="M49.293,1979.7813 L109.249,1979.7813 L109.249,1983.4219 L99.249,1993.4219 L49.293,1993.4219 L49.293,1979.7813" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="439.4531" style="stroke:#000000;stroke-width:1.5;" width="1406.376" x="49.293" y="1979.7813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="64.293" y="1990.0635">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="124.249" y="1991.0635">[Validations Successful]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="49.293" x2="1455.6689" y1="2374.9531" y2="2374.9531"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="54.293" y="2386.2354">[Validation Failed]</text><polygon fill="#181818" points="1397.6689,2017.0625,1407.6689,2021.0625,1397.6689,2025.0625,1401.6689,2021.0625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1403.6689" y1="2021.0625" y2="2021.0625"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="2016.7041">(32)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="2016.7041">POST /v1/data/authz, body {  "input": {...}}</text><polygon fill="#181818" points="1107.5371,2077.625,1097.5371,2081.625,1107.5371,2085.625,1103.5371,2081.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1101.5371" x2="1408.6689" y1="2081.625" y2="2081.625"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.5371" y="2059.8057">(33)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1138.0645" y="2042.3447">200 OK, body {"allow": true,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1144.4219" y="2053.9854">"access_token_ttl": "360",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1144.4219" y="2065.626">"refresh_token_ttl": "43200",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1144.4219" y="2077.2666">"scope": "RS specific scopes"}</text><path d="M68.293,2093.625 L128.249,2093.625 L128.249,2097.2656 L118.249,2107.2656 L68.293,2107.2656 L68.293,2093.625" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="256.3281" style="stroke:#000000;stroke-width:1.5;" width="1362.376" x="68.293" y="2093.625"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="83.293" y="2103.9072">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="143.249" y="2104.9072">[Policy Decision allowed]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="68.293" x2="1430.6689" y1="2305.6719" y2="2305.6719"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="73.293" y="2316.9541">[Policy Decision denied]</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="2134.9063" y2="2134.9063"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="2134.9063" y2="2147.9063"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="2147.9063" y2="2147.9063"/><polygon fill="#181818" points="1107.5371,2143.9063,1097.5371,2147.9063,1107.5371,2151.9063,1103.5371,2147.9063" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="2130.5479">(34)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="2130.5479">Generate AS Access Token (AT) and Refresh Token (RT)</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2173.5469" y2="2169.5469"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2173.5469" y2="2177.5469"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="1085.5371" y1="2173.5469" y2="2173.5469"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="2169.1885">(35)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="2169.1885">200 OK, new tokens</text><path d="M1101.5371,2186.5469 L1101.5371,2289.5469 L1386.5371,2289.5469 L1386.5371,2196.5469 L1376.5371,2186.5469 L1101.5371,2186.5469" fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><path d="M1376.5371,2186.5469 L1376.5371,2196.5469 L1386.5371,2196.5469 L1376.5371,2186.5469" fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1107.5371" y="2200.8291">Token Response Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.5371" y="2212.4697">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.8945" y="2224.1104">"access_token": "&lt;AS_Access_Token&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.8945" y="2235.751">"token_type": "DPoP", // Indicate DPoP is required</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.8945" y="2247.3916">"expires_in": 3600,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.8945" y="2259.0322">"refresh_token": "&lt;AS_Refresh_Token&gt;" // Optional</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.8945" y="2270.6729">// ... other parameters</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.5371" y="2282.3135">}</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2341.9531" y2="2337.9531"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2341.9531" y2="2345.9531"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="1085.5371" y1="2341.9531" y2="2341.9531"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="2337.5947">(36)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="2337.5947">403 Forbidden</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2411.2344" y2="2407.2344"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2411.2344" y2="2415.2344"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="1085.5371" y1="2411.2344" y2="2411.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="2406.876">(37)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="2406.876">400 Bad Request</text><!--SRC=[nLZXSjf84lxFK_Hfgow0aUqusUmUPRjAniJsseavO2zrUxvY1sc0YSM8Q4PsI2fliu-n__9YrpqpGX9WEtMtM-Sg5w3fxkdf_hhx6x5C9pARZtaANdr_l-7LrAsG2vQoEKHymh9Olqwa7eXF79xlRrzyo-OSpdbynxK8MKdcrCgyIMIY5YpaqKgwasIfu6b9DkPogcT1z3vJ6cGYUMbDyGyPbo7lymbFwSi92s-dQPB9g9F4IGhlPaAN5GRh2iKP3cfxpvuIrCkOmpY9ezgplLhjBukKJUSCD4y-WKupNgi5eSPTVrPuWd7o4RohxeK7tvtD4gMjAm3cUIyLyw-_fMgfD9-Zn1Mxup92BG0dyKjt640d5bngN1ym6IrFqkHU6Wa0z19ZAXPCQYS5J5cj6-dKZ2YQ9OErTQLVWi5A0mAjkT9CYqJYoTCx4V8RMG-YkP2GYkbCguQtOM7OUsCiu2Sj5XkLXIuJAVaj1OL4Yrz9UYE75_uPq_oUBRqrhS6R4oC_U5FlDFmJhvORjr4Dv5XmpLCCpB3RENzxVNLzzizQEN1d6KkZpRYLzmWoFRCXw9tsRYJzJ5BngGW2sjzGwdKBZLuIYt09NJaLafSZi7BM9MPd9__c7xjjTtQW3MVT8UmXeaDUiqzzNCyb_JQaN6UfX8FzVRY-1CdlVIFS1gjJOp6ciO09P8ehS26380ovKZ1CRhc4-eKKMh3O_Un-36TCJZdS2pqh9xzX3bmuwxwrePDop1ISzf8UNF8bz9X8eJx1H5OjMWCoGLc3cpP6KYcqx8-Pub6XIwh6sbZ8ICZfRWqrdy7HqH4CXa5_s8PWEEpYr-75zLiOT3lcivx8U6bqzKmep8oUDKYdjkaq-ipYC8l9xLusnbIPpS-PcY6q-UvqjmM3y-3W-rTrkuohFxsxR3IUiCMAQ8tmp36r9svSmZguaRzkNp-2ys1mNbzaOzo6V80TcyN6hvNzg2ftTX0QN9VpSYDDfhOR9mlbY9yAJhxuLX-RQIQdcEaq0fcbCEPYVYE5nGDcpkJF3x2viao5CuYoD9nD-UJhxxDKjsvm14241Y-avjDKwA-_QUpmohciu5C6Y_JhxnCkTz4DSXzFGPqXFmLz_tj6xb6CUfs-WlhB5dpVWXzQE3Zm_taB3Wwm8S31YyQDn89zw9nGnzhxaB5OJ9O8cLEcMQC5Iamb8ij2-HATe1rz5qigexujevKZXP_uuPpid47tZd9mbKppzMenEYlbJbatvbfM4nLRqE6fxioOa0-Wo5QHMnYW6JwdRp-z6xeCBt1GP2dtzMBUeYo5SKRHha1XK3gmCtKXSHNHH11VrL7txUdsAgA2gJrMvkvte72EcPEYWz1ihdUBPhE2FFWkfeznd74tf9hDhPOwCHDpXC56zsaRY_JtsNq2U48fhmtUOMXCZKHqxBN0KzbuuscXmxB8h0Q3aS7tg2kZHI9GyEV-LKMIVroWvEukTWFllHQaXJ_A4g6SuDFFk7ohZL5gMoCCz6WuGtwqID7iiGTV2fMzFUWYSOgmII7gKuxLNW9qOHdnr9xoEJwzRHlMeTe9mq7GjeVoIqfj1CG1kR7IDiSibKc4rM3SEy56- -fbVHl86kMZcxFPwAbSQ8GrYlwG7UV3Qib_V-yOXVdxKgj-rh4CORnqq1dbW1mXqRb32nIlXXkHX9Z7yUTj6s8UrEa8Jq9kwm2qaFjsV64ABvJAaFpYcA4qsjL2AyVVaCSsW_x5AUOwcUS3s5aPPEFtFDIv6O5n4Jghui2XzL-7VQwG_cBKBFseelRVrc2GOJkcKdSMSnr7MROYc_n0SgFzMDpng7HqaseIAPvjBm8L9WjkPOqJ2id9Xqoa278xZJSS0MRYNuB9zjmNbD1m8luHUPraCH4YbC1h0-QQ4k_FS6fIzWi5r2QYQFHe2bJbQAbYt_THZYIeWJ9girLh_d6fuJjHLHBTWjSWYgeMGITR6TZZU3T4g9ScoSJqnqrQzIJeropa7NOBGTjQ0tf9MF4GROiTglDoAusdjDGT85CgFtz_VslQ8Y5YrGnsFpy5f9cUqzFUzM1OVPnzOyCshCd8cc-sveA1AxSJooOf3S5W2z1NZkRzoZJpRsfI9U9EtiEUjjIw_xe3Fxxwsuk6iTM6Gqj8HXJC4GRpU8qI0-R8MLrBPBEvHi_xT0d5M-z94Ytpl4rJl8UCC67yYEO7teCcrU5X17mIQ1iFVLw02E2loZQaaLaxEdHW7Lcmsk0VRv5yR4UxZTaHpskLNJTb-U1_J3yVTxdiofG_vYnrFMt3uj6XcpKhSZ52w8yiJMasHoLYOG-Kft-LNd0vNIMt3Vz0SXbHILOERwPR2sS0LLNZKRrrBvzMRJPNofnOGuGzbRZgEj5wUCzgyTTgF5PyysBOvvQAk1jXd-E54c-45Aqaq-ktmF-A7AxP-IFuuRfhtpp2DqVr7qSLdsfotqeP_qmEzVHCsUnkrSxsS3lxCvfPQk5f2yvMVENHqQ43SAL7_P_R3A9pizCys5-mP7cATzTLAUPdNHUxa7TvRJyk-hzrdeSQ21s0nTg-O792Q50XcJLJOfB5PNEzRdagtZtVewl87eNyKml6c6si1AnHkSYe63vZhNmXnAEQltA6RjZsFLUkWiGZJkvHWLwiubsOIjNEA3UFT4obzUBLlcTNAsZ9br- -GAjE8EUmNdy0Qi53CH4Xc8VA8uVejEwTtYckqbihC4uuohmHlpDieId5BnYilMuBXWsW5ndhFNVOA5ig26TnU6pADjTgrKwgrMPrRR5DKywBUqHUSKZ45vWjNgcqQiTS2sRU02iae79Lz0eIGC8467TBGhuLhZ0aYdj1MHax9pvI8q4xOSRsAwOhYSjTgHQxHrjTBmY5B2xfubFYdmdU5L8mnKwlXOlGVQaEV2fEcethMOwu5DKabrFpSly5l4xIiS3HB5rzKtaOKqLvm6icueUis1l5Iqpo2OloLbWKsaheFm00]--></g></svg>