<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1478px" preserveAspectRatio="none" style="width:1415px;height:1478px;background:#FFFFFF;" version="1.1" viewBox="0 0 1415 1478" width="1415px" zoomAndPan="magnify"><defs/><g><rect fill="#F8F8FF" height="1466.9688" style="stroke:#181818;stroke-width:0.5;" width="627.6787" x="39.793" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="345.1704" y="15.2822">LEI</text><rect fill="#E6E6FA" height="1450.3281" style="stroke:#181818;stroke-width:0.5;" width="409.3872" x="39.793" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="205.3899" y="31.9229">Prim&#228;rsystem</text><rect fill="#F4A460" height="1433.6875" style="stroke:#181818;stroke-width:0.5;" width="89" x="39.793" y="39.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="51.793" y="48.5635">ZETA Client</text><rect fill="#C9FFC9" height="1466.9688" style="stroke:#181818;stroke-width:0.5;" width="729.5654" x="679.4717" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1019.894" y="15.2822">Anbieter</text><rect fill="#F4A460" height="1450.3281" style="stroke:#181818;stroke-width:0.5;" width="618.502" x="679.4717" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="955.5781" y="31.9229">ZETA Guard</text><rect fill="#8FBC8F" height="1450.3281" style="stroke:#181818;stroke-width:0.5;" width="99.0635" x="1309.9736" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1321.9736" y="31.9229">TI 2.0 Dienst</text><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="1268.7656" width="8" x="15.8965" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="19.3965" x2="19.3965" y1="126.5625" y2="1395.3281"/></g><g><title>ZETA</title><rect fill="#000000" fill-opacity="0.00000" height="1268.7656" width="8" x="80.793" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="84.293" x2="84.293" y1="126.5625" y2="1395.3281"/></g><g><title/><rect fill="#FFFFFF" height="1255.7656" style="stroke:#181818;stroke-width:1;" width="10" x="79.293" y="134.5625"/></g><g><title>TPM</title><rect fill="#000000" fill-opacity="0.00000" height="1268.7656" width="8" x="416.0586" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="419.5586" x2="419.5586" y1="126.5625" y2="1395.3281"/></g><g><title>Konnektor or</title><rect fill="#000000" fill-opacity="0.00000" height="1268.7656" width="8" x="501.1069" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="504.6069" x2="504.6069" y1="126.5625" y2="1395.3281"/></g><g><title/><rect fill="#FFFFFF" height="76.9219" style="stroke:#181818;stroke-width:1;" width="10" x="499.6069" y="300.25"/></g><g><title>SM(C)-B</title><rect fill="#000000" fill-opacity="0.00000" height="1268.7656" width="8" x="632.8569" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="636.3569" x2="636.3569" y1="126.5625" y2="1395.3281"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="631.3569" y="325.8906"/></g><g><title>PEP</title><rect fill="#000000" fill-opacity="0.00000" height="1268.7656" width="8" x="712.8726" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="716.3726" x2="716.3726" y1="126.5625" y2="1395.3281"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="1268.7656" width="8" x="814.248" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="817.748" x2="817.748" y1="126.5625" y2="1395.3281"/></g><g><title/><rect fill="#FFFFFF" height="489.375" style="stroke:#181818;stroke-width:1;" width="10" x="812.748" y="795.75"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="1268.7656" width="8" x="1250.1875" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1253.6875" x2="1253.6875" y1="126.5625" y2="1395.3281"/></g><g><title>Resource</title><rect fill="#000000" fill-opacity="0.00000" height="1268.7656" width="8" x="1356.0054" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1359.5054" x2="1359.5054" y1="126.5625" y2="1395.3281"/></g><text fill="#000000" font-family="Helvetica" font-size="10" x="5" y="124.2041">User</text><ellipse cx="19.3965" cy="63.4219" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M19.3965,71.4219 L19.3965,98.4219 M6.3965,79.4219 L32.3965,79.4219 M19.3965,98.4219 L6.3965,113.4219 M19.3965,98.4219 L32.3965,113.4219" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="62.8179" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="71.2339" y="104.5635">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="69.8179" y="116.2041">Client</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="402.1753" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="409.1753" y="116.2041">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="465.1802" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="472.1802" y="104.5635">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="476.1865" y="116.2041">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="609.2422" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="616.2422" y="116.2041">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.8018" x="683.4717" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="707.1831" y="104.5635">PEP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="690.4717" y="116.2041">http Proxy</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="759.2734" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="807.8677" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="766.2734" y="116.2041">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1213.4014" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1243.8071" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1220.4014" y="116.2041">Policy Engine</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60.5283" x="1329.2412" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1336.2412" y="104.5635">Resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1343.1089" y="116.2041">Server</text><text fill="#000000" font-family="Helvetica" font-size="10" x="5" y="1464.6104">User</text><ellipse cx="19.3965" cy="1403.8281" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M19.3965,1411.8281 L19.3965,1438.8281 M6.3965,1419.8281 L32.3965,1419.8281 M19.3965,1438.8281 L6.3965,1453.8281 M19.3965,1438.8281 L32.3965,1453.8281" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="62.8179" y="1395.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="71.2339" y="1411.6104">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="69.8179" y="1423.251">Client</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="402.1753" y="1395.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="409.1753" y="1411.6104">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="465.1802" y="1395.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="472.1802" y="1411.6104">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="476.1865" y="1423.251">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="609.2422" y="1395.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="616.2422" y="1411.6104">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.8018" x="683.4717" y="1395.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="707.1831" y="1411.6104">PEP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="690.4717" y="1423.251">http Proxy</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="759.2734" y="1395.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="807.8677" y="1411.6104">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="766.2734" y="1423.251">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1213.4014" y="1395.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1243.8071" y="1411.6104">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1220.4014" y="1423.251">Policy Engine</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60.5283" x="1329.2412" y="1395.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1336.2412" y="1411.6104">Resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1343.1089" y="1423.251">Server</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="152.2031" y2="152.2031"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="152.2031" y2="165.2031"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="165.2031" y2="165.2031"/><polygon fill="#181818" points="100.293,161.2031,90.293,165.2031,100.293,169.2031,96.293,165.2031" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="147.8447">(01)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="147.8447">Create "SM(C)-B Access Token" (JWT)</text><path d="M320.0762,139.5625 L320.0762,277.5625 L678.0762,277.5625 L678.0762,149.5625 L668.0762,139.5625 L320.0762,139.5625" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M668.0762,139.5625 L668.0762,149.5625 L678.0762,149.5625 L668.0762,139.5625" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="326.0762" y="153.8447">SM(C)-B Access Token Claims:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="326.0762" y="165.4854">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="177.126">"iss": "&lt;client_id&gt;", // Issuer is the client</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="188.7666">"sub": "&lt;Telematik-ID from SM(C)-B&gt;", // Subject is the institution</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="200.4072">"aud": "&lt;AS_Token_Endpoint_URL&gt;", // Audience is the AS</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="212.0479">"exp": ..., // Short-lived</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="223.6885">"iat": ...,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="235.3291">"jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="246.9697">"nonce": "&lt;Challenge from DCR&gt;", // Binding to DCR</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="258.6104">"scope": ... // As required for the Resource Server access</text><text fill="#000000" font-family="Helvetica" font-size="10" x="326.0762" y="270.251">}</text><polygon fill="#181818" points="487.6069,296.25,497.6069,300.25,487.6069,304.25,491.6069,300.25" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="493.6069" y1="300.25" y2="300.25"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="295.8916">(02)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="295.8916">externalAuthenticate (JWT-hash)</text><polygon fill="#181818" points="619.3569,321.8906,629.3569,325.8906,619.3569,329.8906,623.3569,325.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="509.6069" x2="625.3569" y1="325.8906" y2="325.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" x="516.6069" y="321.5322">(03)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="541.1343" y="321.5322">sign (JWT-hash)</text><polygon fill="#181818" points="520.6069,347.5313,510.6069,351.5313,520.6069,355.5313,516.6069,351.5313" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="514.6069" x2="630.3569" y1="351.5313" y2="351.5313"/><text fill="#000000" font-family="Helvetica" font-size="10" x="526.6069" y="347.1729">(04)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="551.1343" y="347.1729">JWT-Signature</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="377.1719" y2="373.1719"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="377.1719" y2="381.1719"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="498.6069" y1="377.1719" y2="377.1719"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="372.8135">(05)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="372.8135">JWT-signature</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="402.8125" y2="402.8125"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="402.8125" y2="415.8125"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="415.8125" y2="415.8125"/><polygon fill="#181818" points="100.293,411.8125,90.293,415.8125,100.293,419.8125,96.293,415.8125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="398.4541">(06)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="398.4541">Create DPoP Key Pair (for Token Exchange)</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="441.4531" y2="441.4531"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="441.4531" y2="454.4531"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="454.4531" y2="454.4531"/><polygon fill="#181818" points="100.293,450.4531,90.293,454.4531,100.293,458.4531,96.293,454.4531" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="437.0947">(07)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="437.0947">Create DPoP Proof JWT for Token Exchange</text><path d="M349.3584,428.8125 L349.3584,624.8125 L627.3584,624.8125 L627.3584,438.8125 L617.3584,428.8125 L349.3584,428.8125" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M617.3584,428.8125 L617.3584,438.8125 L627.3584,438.8125 L617.3584,428.8125" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="355.3584" y="443.0947">DPoP Proof JWT Claims (for Token Exchange):</text><text fill="#000000" font-family="Helvetica" font-size="10" x="355.3584" y="454.7354">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="466.376">"typ": "dpop+jwt",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="478.0166">"alg": "ES256",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="489.6572">"jwk": {</text><text fill="#000000" font-family="Helvetica" font-size="10" x="368.0732" y="501.2979">"kty": "EC",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="368.0732" y="512.9385">"x": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="368.0732" y="524.5791">"y": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="368.0732" y="536.2197">"crv": "P-256"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="547.8604">}</text><text fill="#000000" font-family="Helvetica" font-size="10" x="355.3584" y="559.501">}.{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="571.1416">"jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="582.7822">"htm": "POST",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="594.4229">"htu": "&lt;AS_Token_Endpoint_URL&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="606.0635">"iat": ...</text><text fill="#000000" font-family="Helvetica" font-size="10" x="355.3584" y="617.7041">}.(sig by DPoP_Private_Key)</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="647.7031" y2="647.7031"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="647.7031" y2="660.7031"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="660.7031" y2="660.7031"/><polygon fill="#181818" points="100.293,656.7031,90.293,660.7031,100.293,664.7031,96.293,660.7031" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="643.3447">(08)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="643.3447">Create Client Assertion JWT for Token Exchange (for Auth)</text><path d="M424.5586,635.0625 L424.5586,773.0625 L753.5586,773.0625 L753.5586,645.0625 L743.5586,635.0625 L424.5586,635.0625" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M743.5586,635.0625 L743.5586,645.0625 L753.5586,645.0625 L743.5586,635.0625" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="430.5586" y="649.3447">Client Assertion JWT Claims (for Auth):</text><text fill="#000000" font-family="Helvetica" font-size="10" x="430.5586" y="660.9854">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="436.916" y="672.626">"iss": "&lt;client_id&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="436.916" y="684.2666">"sub": "&lt;client_id&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="436.916" y="695.9072">"aud": "&lt;AS_Token_Endpoint_URL&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="436.916" y="707.5479">"exp": ..., // Short-lived</text><text fill="#000000" font-family="Helvetica" font-size="10" x="436.916" y="719.1885">"jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="436.916" y="730.8291">// Include DPoP public key hash</text><text fill="#000000" font-family="Helvetica" font-size="10" x="436.916" y="742.4697">"cnf": { "jkt": "&lt;Base64URL(SHA256(DPoP_Public_JWK))&gt;" }</text><text fill="#000000" font-family="Helvetica" font-size="10" x="430.5586" y="754.1104">}</text><text fill="#000000" font-family="Helvetica" font-size="10" x="430.5586" y="765.751">(sig by Client_Instance_Private_Key)</text><polygon fill="#181818" points="800.748,791.75,810.748,795.75,800.748,799.75,804.748,795.75" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="806.748" y1="795.75" y2="795.75"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="791.3916">(09)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="791.3916">POST /token (RFC 8693)</text><path d="M94.293,808.75 L94.293,911.75 L514.293,911.75 L514.293,818.75 L504.293,808.75 L94.293,808.75" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M504.293,808.75 L504.293,818.75 L514.293,818.75 L504.293,808.75" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="100.293" y="823.0322">Token Exchange Request Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="106.6504" y="834.6729">grant_type=urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="#000000" font-family="Helvetica" font-size="10" x="106.6504" y="846.3135">&amp;subject_token=&lt;SM(C)-B_Assertion_Token&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="106.6504" y="857.9541">&amp;subject_token_type=urn:ietf:params:oauth:token-type:jwt // Or custom</text><text fill="#000000" font-family="Helvetica" font-size="10" x="106.6504" y="869.5947">&amp;client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer</text><text fill="#000000" font-family="Helvetica" font-size="10" x="106.6504" y="881.2354">&amp;client_assertion=&lt;Client_Assertion_JWT_for_Auth&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="106.6504" y="892.876">&amp;resource=&lt;Optional: Target Resource URI&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="106.6504" y="904.5166">&amp;audience=&lt;Optional: Target Audience&gt;</text><line style="stroke:#181818;stroke-width:1;" x1="822.748" x2="864.748" y1="934.5156" y2="934.5156"/><line style="stroke:#181818;stroke-width:1;" x1="864.748" x2="864.748" y1="934.5156" y2="947.5156"/><line style="stroke:#181818;stroke-width:1;" x1="823.748" x2="864.748" y1="947.5156" y2="947.5156"/><polygon fill="#181818" points="833.748,943.5156,823.748,947.5156,833.748,951.5156,829.748,947.5156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="829.748" y="930.1572">(10)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="854.2754" y="930.1572">Validate client_assertion (sig by Client_Instance_PK, claims)</text><line style="stroke:#181818;stroke-width:1;" x1="822.748" x2="864.748" y1="973.1563" y2="973.1563"/><line style="stroke:#181818;stroke-width:1;" x1="864.748" x2="864.748" y1="973.1563" y2="986.1563"/><line style="stroke:#181818;stroke-width:1;" x1="823.748" x2="864.748" y1="986.1563" y2="986.1563"/><polygon fill="#181818" points="833.748,982.1563,823.748,986.1563,833.748,990.1563,829.748,986.1563" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="829.748" y="968.7979">(11)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="854.2754" y="968.7979">Validate subject_token (sig by SM(C)-B_PK, claims)</text><line style="stroke:#181818;stroke-width:1;" x1="822.748" x2="864.748" y1="1011.7969" y2="1011.7969"/><line style="stroke:#181818;stroke-width:1;" x1="864.748" x2="864.748" y1="1011.7969" y2="1024.7969"/><line style="stroke:#181818;stroke-width:1;" x1="823.748" x2="864.748" y1="1024.7969" y2="1024.7969"/><polygon fill="#181818" points="833.748,1020.7969,823.748,1024.7969,833.748,1028.7969,829.748,1024.7969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="829.748" y="1007.4385">(12)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="854.2754" y="1007.4385">Check if client_id is bound to the SM(C)-B identity (sub claim in subject_token)</text><path d="M68.293,1036.7969 L128.249,1036.7969 L128.249,1040.4375 L118.249,1050.4375 L68.293,1050.4375 L68.293,1036.7969" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="334.5313" style="stroke:#000000;stroke-width:1.5;" width="1088.5869" x="68.293" y="1036.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="83.293" y="1047.0791">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="143.249" y="1048.0791">[Validations Successful]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="68.293" x2="1156.8799" y1="1248.8438" y2="1248.8438"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="73.293" y="1260.126">[Validation Failed]</text><line style="stroke:#181818;stroke-width:1;" x1="822.748" x2="864.748" y1="1078.0781" y2="1078.0781"/><line style="stroke:#181818;stroke-width:1;" x1="864.748" x2="864.748" y1="1078.0781" y2="1091.0781"/><line style="stroke:#181818;stroke-width:1;" x1="823.748" x2="864.748" y1="1091.0781" y2="1091.0781"/><polygon fill="#181818" points="833.748,1087.0781,823.748,1091.0781,833.748,1095.0781,829.748,1091.0781" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="829.748" y="1073.7197">(13)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="854.2754" y="1073.7197">Generate AS Access Token (AT) and Refresh Token (RT)</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="1116.7188" y2="1112.7188"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="1116.7188" y2="1120.7188"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="811.748" y1="1116.7188" y2="1116.7188"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="1112.3604">(14)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="1112.3604">200 OK</text><path d="M827.748,1129.7188 L827.748,1232.7188 L1112.748,1232.7188 L1112.748,1139.7188 L1102.748,1129.7188 L827.748,1129.7188" fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><path d="M1102.748,1129.7188 L1102.748,1139.7188 L1112.748,1139.7188 L1102.748,1129.7188" fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="833.748" y="1144.001">Token Response Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="833.748" y="1155.6416">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="840.1055" y="1167.2822">"access_token": "&lt;AS_Access_Token&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="840.1055" y="1178.9229">"token_type": "DPoP", // Indicate DPoP is required</text><text fill="#000000" font-family="Helvetica" font-size="10" x="840.1055" y="1190.5635">"expires_in": 3600,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="840.1055" y="1202.2041">"refresh_token": "&lt;AS_Refresh_Token&gt;" // Optional</text><text fill="#000000" font-family="Helvetica" font-size="10" x="840.1055" y="1213.8447">// ... other parameters</text><text fill="#000000" font-family="Helvetica" font-size="10" x="833.748" y="1225.4854">}</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="1285.125" y2="1281.125"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="1285.125" y2="1289.125"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="811.748" y1="1285.125" y2="1285.125"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="1280.7666">(15)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="1280.7666">400 Bad Request</text><path d="M822.748,1298.125 L822.748,1366.125 L1128.748,1366.125 L1128.748,1308.125 L1118.748,1298.125 L822.748,1298.125" fill="#FFC0CB" style="stroke:#181818;stroke-width:0.5;"/><path d="M1118.748,1298.125 L1118.748,1308.125 L1128.748,1308.125 L1118.748,1298.125" fill="#FFC0CB" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="828.748" y="1312.4072">Error Response:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="828.748" y="1324.0479">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="835.1055" y="1335.6885">"error": "invalid_grant", // Or "invalid_client"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="835.1055" y="1347.3291">"error_description": "Token exchange validation failed."</text><text fill="#000000" font-family="Helvetica" font-size="10" x="828.748" y="1358.9697">}</text><!--SRC=[ZLVhSXet5Fw_Jt6wcMd0xcBgf9wMiJs3CR69xPW1qamxdc74hW2PHQAI5fjayZPzaxvOZwIzSJ7E7nkaxrnqldE395hmP3wY4lnAlLxrFJLZV44acKD4noI9zGV1TPzzfV1hVVVb9pAdS4tZ9TKi92NCfSFS2IxKWeGqoj4jaKX6PGaRKpxHqsRqc2WDN71QkbFqduJoaFRec4hpuOA4iuaK2OzQ8XOIlaoPBWlqDmMADnnxHszV0-fLJ64auiXxU-HvtayBIIPp0fgAhw1bGZsl6Meq-rdX4qRY6VpRTiU7DrTJeRJp1S2UToMR__UlL2kbwHmHjsH9UOHI02dYx_QW2QsOKQxnlazujBgGuebR102wYK5b2y9rYWAYdDG3JyKi5DKQXTwcqA1xPoNmlm4Mi3BeHd1EP-P91bfy4_A13ph15T7qYQpy3Qd-tON5z-yghMfmuNkPSXUJ9Xynggd4PmtQhUjFzxVtLtzvvMTV9KH6swyksxZkMXFTTlU1JxLUG5UAvvM_XMicUjftq4k4cgz2igz4Cy6HPRaqVcn9TTk5I5V4B5n1cqyOf-kXSZuFEd1SgyCbnXnJzCqbaRC-9LUIqbrazPmtFQemrKFwm5CdriZA0vPIUtYOVGhECxeRq98K2SZZ3Cqmf4h1GCmezw7oySkWwd612CacK_GiDlz6SKAjhOE3NNAedR2vQXmSMD2tz0K-KyflW7yQMkD35ftxly3H4NIKIh17C0LwIi7TPZ8g6LcP0Otf72C-2pgNC9O2oyjPJdNqaz4Z3NMcX64OcKuCGvacaaHMKxC_j5uEspnQ28QEVExTfbgQISHCfMPgclrCcZulKBfMgpbhc00wYDcIHldZY4u1sScZPiOW7ldv6JQVa5etMbCIcxv4tMikMxtKXml68yOde8KvpECGYWLr1goZ2YIs5oPf16Ci9kDibWvfIWAnb5W5tsqs61wzKX8KjNXuYAb0dx6WE8bDVYC2sotIRZ8Wc18rhNe576LDVLefnIQyZ38NQxg3057clez8eXD9ovg2ypmPSw3AWNiozh8hkd13Lz0bJ4B51C4bN_ivd1ACQzLx2qNcDZ0gIc4w12EYC6Yvf16qkaOkxhNNR6AJ46FZ9spRt5ig6zAkI7PwlbKvUcMopyTyNHm-FkaYdqWyCHVj_l5l9yNfuzCCJpDfF9ZfbOMrSWmUFczc9vwjTfo5ScbEku6naHv_TsbL-xOlsQTwRWNl-uFoORAt3BVgARLKmQo0qSfoCCJHjqH2XiXYTMTgRpANVcygdAgsRU_cpx5X2c1_rzkfhaoeLV533N2pqUswUwrr_N2Jsi6IwRyyZ9CeJUz5Ci9P1JEi3rFGcMJ8noQbKCLCMryki8nEtgFzIl-wYPbHSSHOwU77BpVLwhcVfOdzcn7eOZViO8Scs0nVvzADNzjiJ2h1aRQSLNeVMl3xoH_lrgZ2uaebjqZReBfdrZCSjXSYMcLC0Kma3jWXrXizIoHlu98nRjXrJZK4GKSQ5X0OGCFw4T2izfs2dvMRH4DxUtQQZgbXdYkEmlETy7s6dJLh65k0uUrUGeWRhPXdkjBS8RcfFUeSDiYnkUPWH8bCjyWTEizEKmAB1s7o3p7fXuQe_5qodKPdf_SBWo9n0mP4JgWk1jNdNYV7atJqxi1dK_cyb1ukAVBiQC2V96QHAVLDXrzEl9jV46ngjhf7tHe_kQwCrRqwMbCQpe2D8QzfirUCp4yBCztDpCxM9nQPYQjNQ20PEOsumwmRhtearfbZ-325IuyTyUCajb7SSk2ASYhD8vhzzGMjqXnK0HTZf6ACH4spunvkUqRJ-kHi3jRyjct2z8SADeKQzWFdRnKtum64-1k7uFQLHWK8YkbI08pHxD6TzD5bvujze077zJhStzZRzGftM5VWazAEN5GvfjW28qGtgXjAGz7qLHiJ5zsimReufKLQ6eDc2kSbQi0c3Ed-Yej3cEy7h5ZDoiBOc_583PcnzEwaNbzJBHqFwwwav6I-s99FQwCaYwTcAHIOJX9iYPiVHYf7VCz_5TZAeJ56fKWY-41Od7gwHO5RoTuZ3HSaoXhcotmi69-Lc6XBYPCmO-954gY1cISplZHk3Ms7TP753fSVXwKVf6NHOKHLA9aDZ57Z4Y3hoh0idZgsJwtvBuO6Fs295RCdyFu7]--></g></svg>