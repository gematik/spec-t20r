<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1875px" preserveAspectRatio="none" style="width:1201px;height:1875px;background:#FFFFFF;" version="1.1" viewBox="0 0 1201 1875" width="1201px" zoomAndPan="magnify"><defs/><g><rect fill="#F8F8FF" height="1863.2969" style="stroke:#181818;stroke-width:0.5;" width="432.5269" x="149.8936" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="357.6951" y="15.2822">LEI</text><rect fill="#E6E6FA" height="1846.6563" style="stroke:#181818;stroke-width:0.5;" width="432.5269" x="149.8936" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="327.0603" y="31.9229">Prim&#228;rsystem</text><rect fill="#F4A460" height="1830.0156" style="stroke:#181818;stroke-width:0.5;" width="89" x="149.8936" y="39.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="161.8936" y="48.5635">ZETA Client</text><rect fill="#C9FFC9" height="1863.2969" style="stroke:#181818;stroke-width:0.5;" width="402.2939" x="594.4204" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="771.207" y="15.2822">Anbieter</text><rect fill="#F4A460" height="1846.6563" style="stroke:#181818;stroke-width:0.5;" width="291.2305" x="594.4204" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="706.8911" y="31.9229">ZETA Guard</text><rect fill="#8FBC8F" height="1846.6563" style="stroke:#181818;stroke-width:0.5;" width="99.0635" x="897.6509" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="909.6509" y="31.9229">TI 2.0 Dienst</text><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="1665.0938" width="8" x="44.5" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="48" x2="48" y1="126.5625" y2="1791.6563"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="43" y="313.6875"/></g><g><title>ZETA</title><rect fill="#000000" fill-opacity="0.00000" height="1665.0938" width="8" x="190.8936" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="194.3936" x2="194.3936" y1="126.5625" y2="1791.6563"/></g><g><title/><rect fill="#FFFFFF" height="1638.0938" style="stroke:#181818;stroke-width:1;" width="10" x="189.3936" y="134.5625"/></g><g><title>TPM</title><rect fill="#000000" fill-opacity="0.00000" height="1665.0938" width="8" x="549.2988" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="552.7988" x2="552.7988" y1="126.5625" y2="1791.6563"/></g><g><title/><rect fill="#FFFFFF" height="238.4063" style="stroke:#181818;stroke-width:1;" width="10" x="547.7988" y="364.9688"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="1665.0938" width="8" x="653.395" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="656.895" x2="656.895" y1="126.5625" y2="1791.6563"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="651.895" y="223.125"/></g><g><title/><rect fill="#FFFFFF" height="962.5938" style="stroke:#181818;stroke-width:1;" width="10" x="651.895" y="783.0625"/></g><g><title>PDP DB</title><rect fill="#000000" fill-opacity="0.00000" height="1665.0938" width="8" x="852.4009" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="855.9009" x2="855.9009" y1="126.5625" y2="1791.6563"/></g><g><title/><rect fill="#FFFFFF" height="378.1719" style="stroke:#181818;stroke-width:1;" width="10" x="850.9009" y="1112.875"/></g><g><title>Resource</title><rect fill="#000000" fill-opacity="0.00000" height="1665.0938" width="8" x="943.6826" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="947.1826" x2="947.1826" y1="126.5625" y2="1791.6563"/></g><text fill="#000000" font-family="Helvetica" font-size="10" x="33.6035" y="124.2041">User</text><ellipse cx="48" cy="63.4219" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M48,71.4219 L48,98.4219 M35,79.4219 L61,79.4219 M48,98.4219 L35,113.4219 M48,98.4219 L61,113.4219" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="172.9185" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="181.3345" y="104.5635">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="179.9185" y="116.2041">Client</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="535.4155" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="542.4155" y="116.2041">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="598.4204" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="647.0146" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="605.4204" y="116.2041">Authorization Server</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="51.5" x="830.1509" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="837.1509" y="116.2041">PDP DB</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60.5283" x="916.9185" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="923.9185" y="104.5635">Resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="930.7861" y="116.2041">Server</text><text fill="#000000" font-family="Helvetica" font-size="10" x="33.6035" y="1860.9385">User</text><ellipse cx="48" cy="1800.1563" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M48,1808.1563 L48,1835.1563 M35,1816.1563 L61,1816.1563 M48,1835.1563 L35,1850.1563 M48,1835.1563 L61,1850.1563" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="172.9185" y="1791.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="181.3345" y="1807.9385">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="179.9185" y="1819.5791">Client</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="535.4155" y="1791.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="542.4155" y="1807.9385">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="598.4204" y="1791.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="647.0146" y="1807.9385">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="605.4204" y="1819.5791">Authorization Server</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="51.5" x="830.1509" y="1791.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="837.1509" y="1807.9385">PDP DB</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60.5283" x="916.9185" y="1791.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="923.9185" y="1807.9385">Resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="930.7861" y="1819.5791">Server</text><path d="M8,138.5625 L67.9561,138.5625 L67.9561,142.2031 L57.9561,152.2031 L8,152.2031 L8,138.5625" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1629.0938" style="stroke:#000000;stroke-width:1.5;" width="1187.0103" x="8" y="138.5625"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="23" y="148.8447">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="82.9561" y="149.8447">[Client has no client_id]</text><line style="stroke:#181818;stroke-width:1;" x1="199.3936" x2="241.3936" y1="179.8438" y2="179.8438"/><line style="stroke:#181818;stroke-width:1;" x1="241.3936" x2="241.3936" y1="179.8438" y2="192.8438"/><line style="stroke:#181818;stroke-width:1;" x1="200.3936" x2="241.3936" y1="192.8438" y2="192.8438"/><polygon fill="#181818" points="210.3936,188.8438,200.3936,192.8438,210.3936,196.8438,206.3936,192.8438" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.3936" y="175.4854">(01)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="230.9209" y="175.4854">Generate Client Instance Key Pair (for Client Auth)</text><path d="M494.9766,167.2031 L494.9766,200.2031 L855.9766,200.2031 L855.9766,177.2031 L845.9766,167.2031 L494.9766,167.2031" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M845.9766,167.2031 L845.9766,177.2031 L855.9766,177.2031 L845.9766,167.2031" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="500.9766" y="181.4854">Key Pair for private_key_jwt</text><text fill="#000000" font-family="Helvetica" font-size="10" x="500.9766" y="193.126">(could potentially be TPM-backed, but distinct from Attestation Key)</text><polygon fill="#181818" points="639.895,219.125,649.895,223.125,639.895,227.125,643.895,223.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.3936" x2="645.895" y1="223.125" y2="223.125"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.3936" y="218.7666">(02)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="230.9209" y="218.7666">GET /nonce</text><polygon fill="#181818" points="210.3936,244.7656,200.3936,248.7656,210.3936,252.7656,206.3936,248.7656" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.3936" x2="650.895" y1="248.7656" y2="248.7656"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.3936" y="244.4072">(03)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="240.9209" y="244.4072">return 200 OK new-nonce: nonce</text><path d="M27,260.7656 L86.9561,260.7656 L86.9561,264.4063 L76.9561,274.4063 L27,274.4063 L27,260.7656" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="207.125" style="stroke:#000000;stroke-width:1.5;" width="546.7988" x="27" y="260.7656"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="42" y="271.0479">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="101.9561" y="272.0479">[Client has no TPM Attestation Key]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="27" x2="573.7988" y1="409.6094" y2="409.6094"/><polygon fill="#181818" points="64,309.6875,54,313.6875,64,317.6875,60,313.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="58" x2="188.3936" y1="313.6875" y2="313.6875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="70" y="303.5088">(04)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="94.5273" y="297.6885">Obtain Admin</text><text fill="#000000" font-family="Helvetica" font-size="10" x="94.5273" y="309.3291">access to TPM</text><polygon fill="#181818" points="177.3936,335.3281,187.3936,339.3281,177.3936,343.3281,181.3936,339.3281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="53" x2="183.3936" y1="339.3281" y2="339.3281"/><text fill="#000000" font-family="Helvetica" font-size="10" x="60" y="334.9697">(05)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.5273" y="334.9697">TPM Admin access</text><polygon fill="#181818" points="535.7988,360.9688,545.7988,364.9688,535.7988,368.9688,539.7988,364.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.3936" x2="541.7988" y1="364.9688" y2="364.9688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.3936" y="360.6104">(06)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="230.9209" y="360.6104">Trigger Generation of TPM Attestation Key Pair</text><polygon fill="#181818" points="210.3936,386.6094,200.3936,390.6094,210.3936,394.6094,206.3936,390.6094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.3936" x2="546.7988" y1="390.6094" y2="390.6094"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.3936" y="386.251">(07)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="240.9209" y="386.251">Return Attestation Public Key / Certificate Chain</text><polygon fill="#181818" points="535.7988,430.25,545.7988,434.25,535.7988,438.25,539.7988,434.25" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.3936" x2="541.7988" y1="434.25" y2="434.25"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.3936" y="429.8916">(08)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="230.9209" y="429.8916">Load existing TPM Attestation Key</text><polygon fill="#181818" points="210.3936,455.8906,200.3936,459.8906,210.3936,463.8906,206.3936,459.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.3936" x2="546.7988" y1="459.8906" y2="459.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.3936" y="455.5322">(09)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="240.9209" y="455.5322">Return Attestation Public Key / Certificate Chain</text><line style="stroke:#181818;stroke-width:1;" x1="199.3936" x2="241.3936" y1="499.5313" y2="499.5313"/><line style="stroke:#181818;stroke-width:1;" x1="241.3936" x2="241.3936" y1="499.5313" y2="512.5313"/><line style="stroke:#181818;stroke-width:1;" x1="200.3936" x2="241.3936" y1="512.5313" y2="512.5313"/><polygon fill="#181818" points="210.3936,508.5313,200.3936,512.5313,210.3936,516.5313,206.3936,512.5313" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.3936" y="495.1729">(10)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="230.9209" y="495.1729">Get TCG Event Log (from OS/Firmware)</text><path d="M439.9961,486.8906 L439.9961,554.8906 L783.9961,554.8906 L783.9961,496.8906 L773.9961,486.8906 L439.9961,486.8906" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M773.9961,486.8906 L773.9961,496.8906 L783.9961,496.8906 L773.9961,486.8906" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="445.9961" y="501.1729">Trusted Computing Group Event Log contains:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="445.9961" y="512.8135">- Device identifiers</text><text fill="#000000" font-family="Helvetica" font-size="10" x="445.9961" y="524.4541">- Boot state, Verified Boot state</text><text fill="#000000" font-family="Helvetica" font-size="10" x="445.9961" y="536.0947">- OS Version, Patch Level</text><text fill="#000000" font-family="Helvetica" font-size="10" x="445.9961" y="547.7354">- (optional with WDAC) App ID, App Version, App Signature Hash</text><polygon fill="#181818" points="535.7988,573.7344,545.7988,577.7344,535.7988,581.7344,539.7988,577.7344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.3936" x2="541.7988" y1="577.7344" y2="577.7344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.3936" y="573.376">(11)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="230.9209" y="573.376">Get TPM Quote for PCRs 0, 1, 2 (with nonce, signed with AIK)</text><polygon fill="#181818" points="210.3936,599.375,200.3936,603.375,210.3936,607.375,206.3936,603.375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.3936" x2="546.7988" y1="603.375" y2="603.375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.3936" y="599.0166">(12)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="240.9209" y="599.0166">Return Quote</text><path d="M562.7988,590.7344 L562.7988,669.7344 L795.7988,669.7344 L795.7988,600.7344 L785.7988,590.7344 L562.7988,590.7344" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M785.7988,590.7344 L785.7988,600.7344 L795.7988,600.7344 L785.7988,590.7344" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="568.7988" y="605.0166">Quote contains:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="568.7988" y="616.6572">- Signed nonce</text><text fill="#000000" font-family="Helvetica" font-size="10" x="568.7988" y="628.2979">- Device identifiers</text><text fill="#000000" font-family="Helvetica" font-size="10" x="568.7988" y="639.9385">- Boot state, Verified Boot state</text><text fill="#000000" font-family="Helvetica" font-size="10" x="568.7988" y="651.5791">- OS Version, Patch Level</text><text fill="#000000" font-family="Helvetica" font-size="10" x="568.7988" y="663.2197">- App ID, App Version, App Signature Hash</text><line style="stroke:#181818;stroke-width:1;" x1="199.3936" x2="241.3936" y1="693.2188" y2="693.2188"/><line style="stroke:#181818;stroke-width:1;" x1="241.3936" x2="241.3936" y1="693.2188" y2="706.2188"/><line style="stroke:#181818;stroke-width:1;" x1="200.3936" x2="241.3936" y1="706.2188" y2="706.2188"/><polygon fill="#181818" points="210.3936,702.2188,200.3936,706.2188,210.3936,710.2188,206.3936,706.2188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.3936" y="688.8604">(13)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="230.9209" y="688.8604">Create Client Statement</text><path d="M364.2979,680.5781 L364.2979,759.5781 L597.2979,759.5781 L597.2979,690.5781 L587.2979,680.5781 L364.2979,680.5781" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M587.2979,680.5781 L587.2979,690.5781 L597.2979,690.5781 L587.2979,680.5781" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="370.2979" y="694.8604">Attestation Statement includes:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="370.2979" y="706.501">- Signed nonce</text><text fill="#000000" font-family="Helvetica" font-size="10" x="370.2979" y="718.1416">- Device identifiers</text><text fill="#000000" font-family="Helvetica" font-size="10" x="370.2979" y="729.7822">- Boot state, Verified Boot state</text><text fill="#000000" font-family="Helvetica" font-size="10" x="370.2979" y="741.4229">- OS Version, Patch Level</text><text fill="#000000" font-family="Helvetica" font-size="10" x="370.2979" y="753.0635">- App ID, App Version, App Signature Hash</text><polygon fill="#181818" points="639.895,779.0625,649.895,783.0625,639.895,787.0625,643.895,783.0625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="199.3936" x2="645.895" y1="783.0625" y2="783.0625"/><text fill="#000000" font-family="Helvetica" font-size="10" x="206.3936" y="778.7041">(14)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="230.9209" y="778.7041">POST /register (RFC 7591)</text><path d="M204.3936,796.0625 L204.3936,968.0625 L658.3936,968.0625 L658.3936,806.0625 L648.3936,796.0625 L204.3936,796.0625" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M648.3936,796.0625 L648.3936,806.0625 L658.3936,806.0625 L648.3936,796.0625" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="210.3936" y="810.3447">DCR Request Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.3936" y="821.9854">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="833.626">"redirect_uris": ["..."],</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="845.2666">"client_name": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="856.9072">"token_endpoint_auth_method": "private_key_jwt",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="868.5479">"grant_types": ["urn:ietf:params:oauth:grant-type:token-exchange","refresh_token"],</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="880.1885">"jwks": { "keys": [ &lt;Client_Instance_Public_Key_JWK&gt; ] },</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="891.8291">"nonce": "&lt;nonce&gt;", // Replay protection</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="903.4697">// Custom parameter for attestation:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="915.1104">"urn:gematik:params:oauth:client-attestation-type:tpm2": {</text><text fill="#000000" font-family="Helvetica" font-size="10" x="226.2871" y="926.751">"attestation_data": "&lt;Base64(TPM Attestation Statement)&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="226.2871" y="938.3916">"attestation_format": "tpm-attestation-jwt"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="219.9297" y="950.0322">}</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.3936" y="961.6729">}</text><line style="stroke:#181818;stroke-width:1;" x1="661.895" x2="703.895" y1="991.6719" y2="991.6719"/><line style="stroke:#181818;stroke-width:1;" x1="703.895" x2="703.895" y1="991.6719" y2="1004.6719"/><line style="stroke:#181818;stroke-width:1;" x1="662.895" x2="703.895" y1="1004.6719" y2="1004.6719"/><polygon fill="#181818" points="672.895,1000.6719,662.895,1004.6719,672.895,1008.6719,668.895,1004.6719" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="668.895" y="987.3135">(15)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="693.4224" y="987.3135">Validate nonce</text><line style="stroke:#181818;stroke-width:1;" x1="661.895" x2="703.895" y1="1041.9531" y2="1041.9531"/><line style="stroke:#181818;stroke-width:1;" x1="703.895" x2="703.895" y1="1041.9531" y2="1054.9531"/><line style="stroke:#181818;stroke-width:1;" x1="662.895" x2="703.895" y1="1054.9531" y2="1054.9531"/><polygon fill="#181818" points="672.895,1050.9531,662.895,1054.9531,672.895,1058.9531,668.895,1054.9531" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="668.895" y="1031.7744">(16)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="693.4224" y="1025.9541">Validate TPM</text><text fill="#000000" font-family="Helvetica" font-size="10" x="693.4224" y="1037.5947">Attestation Statement</text><path d="M816.4722,1017.6719 L816.4722,1061.6719 L1029.4722,1061.6719 L1029.4722,1027.6719 L1019.4722,1017.6719 L816.4722,1017.6719" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1019.4722,1017.6719 L1019.4722,1027.6719 L1029.4722,1027.6719 L1019.4722,1017.6719" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="822.4722" y="1031.9541">Check signature against trusted roots.</text><text fill="#000000" font-family="Helvetica" font-size="10" x="822.4722" y="1043.5947">Extract device/OS/App status.</text><text fill="#000000" font-family="Helvetica" font-size="10" x="822.4722" y="1055.2354">Verify Attestation Key properties.</text><path d="M159.3936,1071.5938 L219.3496,1071.5938 L219.3496,1075.2344 L209.3496,1085.2344 L159.3936,1085.2344 L159.3936,1071.5938" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="682.0625" style="stroke:#000000;stroke-width:1.5;" width="1010.6167" x="159.3936" y="1071.5938"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="174.3936" y="1081.876">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="234.3496" y="1082.876">[Attestation valid]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="159.3936" x2="1170.0103" y1="1709.375" y2="1709.375"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="164.3936" y="1720.6572">[Attestation invalid]</text><polygon fill="#181818" points="838.9009,1108.875,848.9009,1112.875,838.9009,1116.875,842.9009,1112.875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="661.895" x2="844.9009" y1="1112.875" y2="1112.875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="668.895" y="1108.5166">(17)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="693.4224" y="1108.5166">Check if Client already exists</text><polygon fill="#181818" points="672.895,1134.5156,662.895,1138.5156,672.895,1142.5156,668.895,1138.5156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="666.895" x2="849.9009" y1="1138.5156" y2="1138.5156"/><text fill="#000000" font-family="Helvetica" font-size="10" x="678.895" y="1134.1572">(18)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="703.4224" y="1134.1572">&#160;</text><path d="M865.9009,1151.5156 L865.9009,1184.5156 L1091.9009,1184.5156 L1091.9009,1161.5156 L1081.9009,1151.5156 L865.9009,1151.5156" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1081.9009,1151.5156 L1081.9009,1161.5156 L1091.9009,1161.5156 L1081.9009,1151.5156" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1165.7979">Check if client_id already exists in DB for</text><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1177.4385">- Client_Instance_Public_Key_JWK</text><path d="M178.3936,1193.7969 L238.3496,1193.7969 L238.3496,1197.4375 L228.3496,1207.4375 L178.3936,1207.4375 L178.3936,1193.7969" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="305.25" style="stroke:#000000;stroke-width:1.5;" width="966.6167" x="178.3936" y="1193.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="193.3936" y="1204.0791">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.3496" y="1205.0791">[Client exists in DB]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="178.3936" x2="1145.0103" y1="1254.0781" y2="1254.0781"/><polygon fill="#181818" points="210.3936,1231.0781,200.3936,1235.0781,210.3936,1239.0781,206.3936,1235.0781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="204.3936" x2="650.895" y1="1235.0781" y2="1235.0781"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.3936" y="1230.7197">(19)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="240.9209" y="1230.7197">409 Conflict</text><line style="stroke:#181818;stroke-width:1;" x1="661.895" x2="703.895" y1="1278.7188" y2="1278.7188"/><line style="stroke:#181818;stroke-width:1;" x1="703.895" x2="703.895" y1="1278.7188" y2="1291.7188"/><line style="stroke:#181818;stroke-width:1;" x1="662.895" x2="703.895" y1="1291.7188" y2="1291.7188"/><polygon fill="#181818" points="672.895,1287.7188,662.895,1291.7188,672.895,1295.7188,668.895,1291.7188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="668.895" y="1274.3604">(20)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="693.4224" y="1274.3604">Generate client_id</text><polygon fill="#181818" points="838.9009,1325,848.9009,1329,838.9009,1333,842.9009,1329" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="661.895" x2="844.9009" y1="1329" y2="1329"/><text fill="#000000" font-family="Helvetica" font-size="10" x="668.895" y="1318.8213">(21)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="693.4224" y="1313.001">Store client metadata,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="693.4224" y="1324.6416">incl. Client Instance Key</text><path d="M865.9009,1342 L865.9009,1468 L1123.9009,1468 L1123.9009,1352 L1113.9009,1342 L865.9009,1342" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1113.9009,1342 L1113.9009,1352 L1123.9009,1352 L1113.9009,1342" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1356.2822">Store client metadata in DB:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1367.9229">- client_id</text><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1379.5635">- client_instance_key</text><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1391.2041">- attestation_data</text><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1402.8447">- attestation_key</text><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1414.4854">- redirect_uris</text><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1426.126">- client_name</text><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1437.7666">- token_endpoint_auth_method</text><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1449.4072">- grant_types</text><text fill="#000000" font-family="Helvetica" font-size="10" x="871.9009" y="1461.0479">- state // Client registered but not yet activated</text><polygon fill="#181818" points="672.895,1487.0469,662.895,1491.0469,672.895,1495.0469,668.895,1491.0469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="666.895" x2="849.9009" y1="1491.0469" y2="1491.0469"/><text fill="#000000" font-family="Helvetica" font-size="10" x="678.895" y="1486.6885">(22)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="703.4224" y="1486.6885">201 Created</text><line style="stroke:#181818;stroke-width:1;" x1="200.3936" x2="210.3936" y1="1530.6875" y2="1526.6875"/><line style="stroke:#181818;stroke-width:1;" x1="200.3936" x2="210.3936" y1="1530.6875" y2="1534.6875"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="199.3936" x2="650.895" y1="1530.6875" y2="1530.6875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.3936" y="1526.3291">(23)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="240.9209" y="1526.3291">201 Created</text><path d="M204.3936,1543.6875 L204.3936,1692.6875 L658.3936,1692.6875 L658.3936,1553.6875 L648.3936,1543.6875 L204.3936,1543.6875" fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><path d="M648.3936,1543.6875 L648.3936,1553.6875 L658.3936,1553.6875 L648.3936,1543.6875" fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="210.3936" y="1557.9697">DCR Response Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.3936" y="1569.6104">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="1581.251">"client_id": "&lt;generated-client-id&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="1592.8916">"client_id_issued_at": ...,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="1604.5322">"client_name": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="1616.1729">"token_endpoint_auth_method": "private_key_jwt",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="1627.8135">"grant_types": ["urn:ietf:params:oauth:grant-type:token-exchange","refresh_token"],</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="1639.4541">"jwks": { &lt;Client_Instance_Public_Key_JWK&gt; }, // Confirming registered key</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="1651.0947">// ... other registered metadata</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="1662.7354">"registration_access_token": "...", // Optional for config updates</text><text fill="#000000" font-family="Helvetica" font-size="10" x="216.751" y="1674.376">"registration_client_uri": "..." // Optional for config updates</text><text fill="#000000" font-family="Helvetica" font-size="10" x="210.3936" y="1686.0166">}</text><line style="stroke:#181818;stroke-width:1;" x1="200.3936" x2="210.3936" y1="1745.6563" y2="1741.6563"/><line style="stroke:#181818;stroke-width:1;" x1="200.3936" x2="210.3936" y1="1745.6563" y2="1749.6563"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="199.3936" x2="650.895" y1="1745.6563" y2="1745.6563"/><text fill="#000000" font-family="Helvetica" font-size="10" x="216.3936" y="1741.2979">(24)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="240.9209" y="1741.2979">400 Bad Request</text><!--SRC=[pLVRRjj647tNLqoLX_eYsRAHjWWH190bnt7jnAxb9cZhG5YH8saZQfTTBcqhWV-cVz8VwyoIb9QKd0He0_I94kUoCxDdpWn5PhNAvYCqqDpgTBQRZNGcLIACc4E4Ov75zgLMTY0_8XnqDWlVY3d2AunlqSfGU3hzNEUrLZfDH8ZHKhkdCoFHUBengecTTgCFMMf1QOMUBCK_CrGXNk4O3Vyu4k5iOdIcefwEjO5tKsbzWq7TO9N3OMF_-oyfsaMCCD9nrFX-lz7uBZ5YCXTWKNy4Qp9iDBgXfLD_JIc3aRw7vldnQHEUd4nrQlDG0DpxIoFdV_zbqaLgSKuQv-8MLKHM08N6xyVNNUZ54fKb-K2eQ75az9ro6W0K9TLK9aBPGWj4cblTgCBCgP9RTjYe6rrVldOMz6J5Kgryvk5trKYYHKCHN1_tNhsvEByu-QtXHtYI2HEj1-YVrCtiTE3EkknVtYZ-gutyAApKYkfiRjd_cXNfzezAA-WV-K6MHRe-XSEz3lGfMyB6axumim6A4uEugKnNUH1Nc1B6GhnHnTcLCYtpBugwkziGyRB4KtAWD8Jktr16P5f8sY_ANm6Se48ZB9PlJYawGH22Crp0fP06jiQ4aaBAzTWcHqgJXP6JgGrMYgoN67bBteOpN0m_t5cuKLkXpk884h9GLeeuNi08-KRR8y8_HYqOPHOYcLgfGWjZe-VGjHOf35TqShzT2Js_ejrT3lxu6lQfpKB6Qlw-lKgktGx0eCsCWiDE1oxEGE5Tswa7a5kHsNh566sr25pPLo5mp-GHN8oia0gwqLog6oN24DCKhFFXR9nc9IOoSWUm1UG6DUyiTiwlgS8JiY_kY6FHuqtXkVexBonS7HV0LPw_ht-PZM8PEhDzw25XRao4nmYOKYgCt3Z5zP02EDSY0hntDpLvj4h_IGGgQco0AwELoA1t0iUtB3ZN4q8d0-PYiFzIclcTC5Y7vxKXBiQ8o7gUP2xo4-BSn7CH4blIkMbmezh4zhUIq2yZHkkOs3tbjqTQM-3miGLlqR0WybwooiM09IdbrwBhiE4Kpl4MOnPjwOJp5Z7SIJk5T_rkRnkwIGAd_PPxBWtvpq1EbA2QqJGIwRInTWsk1bJaNpBEaflkidULGgS51oquX2rtXeDt2rBoHP6wLztJCwvDzNvSanHNv1pMgfSVKgdG8FVfJlXM5VlQucm4IS-WHsW3FcvElsgP-O1SwW1nK9n5-3_FrAF0oui1SQ312RKbKSNMrSiU_FJ3iuDg6p1l5EPFOdunYZCinixEJhztHHYW7O86qv6E5i7EJY7xL3m1cWOZQJ2qGzfvqcO0VpJtzlQQxrihZMBIA5gDIEx4djJg6QeXTNQY9Ma9Ic4uHngl4IlNvePlE34q48TsaM1-B44re44_3jpoamQQNGLEgyrQWJkfZVVXLAW9DbiK-jXWEXqwGINa3tSpTle9cdImSm_FypeDoq4upDbgI6mr_FdTsGju3m-U1mSEpk2v-_MYsOBzVQfc4ei5JKEwWP0XjZGWOOy8YJZBXSyBY-jXiO9ZiFBEkKvmJgzdrNJpMhSzgoBtP7x82IrTi1TFQnW9ArouHoB57vzkrMbysGhRBxnBg7kXY2aezaC7LgBWorkPFJHMJzvMLCumnQWkWHp0Mn7BY9ksDimtQ530j9TjYhZMuBqfXZF7W7aRYGbJcENbrmq4GosQxjseutjh16qUaUlkVHebt7xiFMEnQ-d5siIbgqruSc6wLomHliOjH-joNoQIxuYkP_F8vB8bHKoC5ItosPfl0xbskon03ebgFpkLehvBZyjjh-QKY8tsKaPQOT66p-DykMWMLrPPb7oVXR-rxIk0fvrdD7NLcBpQt5svM6out-KUwk-hwmKCwBgrARM0-aSmebitYfbxRzCMM_Xvl7YmsMUUtgePsskX-U_AAiwM1xAqtdcFYAf65QPTFuhvrNlxEAzwIXw7Uc_TV7ACb6TUJX5g3jx9gMAme6M3ciEHS-cmWeergBgDuh1pK8pXg0HIeuAIrRIkgtvcQ4syZwNLt4eJhLAi3IweK61pUNEE-YO5rg9sGQCogfBTIdyeqpJ3QEZ8ZYRQ9gtD0-zVZBnlE_JyiVV5OVVWnXbtCQtNl3nx6F5HwmOR5G2qdT94yxJATlBFpyNv9yqm_mOguYpBoEukogsPvsF88KmWItW8f8ywAww4EgTqzRMU7kgCnsnL8NMfrcXz1UJyo-ufVMSUqLTIiKsjVygq-QEzyGy0]--></g></svg>