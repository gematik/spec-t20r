<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1993px" preserveAspectRatio="none" style="width:1160px;height:1993px;background:#FFFFFF;" version="1.1" viewBox="0 0 1160 1993" width="1160px" zoomAndPan="magnify"><defs/><g><rect fill="#F8F8FF" height="1981.1406" style="stroke:#181818;stroke-width:0.5;" width="549.9497" x="17.5" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="284.0129" y="15.2822">LEI</text><rect fill="#E6E6FA" height="1964.5" style="stroke:#181818;stroke-width:0.5;" width="549.9497" x="17.5" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="253.3782" y="31.9229">Prim&#228;rsystem</text><rect fill="#F4A460" height="1947.8594" style="stroke:#181818;stroke-width:0.5;" width="89" x="17.5" y="39.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="29.5" y="48.5635">ZETA Client</text><rect fill="#C9FFC9" height="1981.1406" style="stroke:#181818;stroke-width:0.5;" width="377.0352" x="579.4497" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="743.6069" y="15.2822">Anbieter</text><rect fill="#F4A460" height="1964.5" style="stroke:#181818;stroke-width:0.5;" width="265.9717" x="579.4497" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="679.291" y="31.9229">ZETA Guard</text><rect fill="#8FBC8F" height="1964.5" style="stroke:#181818;stroke-width:0.5;" width="99.0635" x="857.4214" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="869.4214" y="31.9229">TI 2.0 Dienst</text><g><title>ZETA</title><rect fill="#000000" fill-opacity="0.00000" height="1849.6563" width="8" x="58.5" y="93.2031"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="62" x2="62" y1="93.2031" y2="1942.8594"/></g><g><title/><rect fill="#FFFFFF" height="1822.6563" style="stroke:#181818;stroke-width:1;" width="10" x="57" y="101.2031"/></g><g><title>ZETA Attestation Service</title><rect fill="#000000" fill-opacity="0.00000" height="1849.6563" width="8" x="226.5732" y="93.2031"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="230.0732" x2="230.0732" y1="93.2031" y2="1942.8594"/></g><g><title/><rect fill="#FFFFFF" height="465.4531" style="stroke:#181818;stroke-width:1;" width="10" x="225.0732" y="275.6875"/></g><g><title>TPM</title><rect fill="#000000" fill-opacity="0.00000" height="1849.6563" width="8" x="542.5664" y="93.2031"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="546.0664" x2="546.0664" y1="93.2031" y2="1942.8594"/></g><g><title/><rect fill="#FFFFFF" height="345.6094" style="stroke:#181818;stroke-width:1;" width="10" x="541.0664" y="328.9688"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="1849.6563" width="8" x="638.4243" y="93.2031"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="641.9243" x2="641.9243" y1="93.2031" y2="1942.8594"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="636.9243" y="196.7656"/></g><g><title/><rect fill="#FFFFFF" height="985.875" style="stroke:#181818;stroke-width:1;" width="10" x="636.9243" y="910.9844"/></g><g><title>PDP DB</title><rect fill="#000000" fill-opacity="0.00000" height="1849.6563" width="8" x="812.1714" y="93.2031"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="815.6714" x2="815.6714" y1="93.2031" y2="1942.8594"/></g><g><title/><rect fill="#FFFFFF" height="378.1719" style="stroke:#181818;stroke-width:1;" width="10" x="810.6714" y="1264.0781"/></g><g><title>Resource</title><rect fill="#000000" fill-opacity="0.00000" height="1849.6563" width="8" x="903.4531" y="93.2031"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="906.9531" x2="906.9531" y1="93.2031" y2="1942.8594"/></g><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="40.5249" y="54.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="48.9409" y="71.2041">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="47.5249" y="82.8447">Client</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.6826" x="160.7319" y="54.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="167.7319" y="71.2041">ZETA Attestation Service</text><text fill="#000000" font-family="Helvetica" font-size="10" x="194.2065" y="82.8447">(Admin rights)</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="528.6831" y="66.5625"/><text fill="#000000" font-family="Helvetica" font-size="10" x="535.6831" y="82.8447">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="583.4497" y="54.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="632.0439" y="71.2041">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="590.4497" y="82.8447">Authorization Server</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="51.5" x="789.9214" y="66.5625"/><text fill="#000000" font-family="Helvetica" font-size="10" x="796.9214" y="82.8447">PDP DB</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60.5283" x="876.689" y="54.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="883.689" y="71.2041">Resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="890.5566" y="82.8447">Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="40.5249" y="1942.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" x="48.9409" y="1959.1416">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="47.5249" y="1970.7822">Client</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.6826" x="160.7319" y="1942.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" x="167.7319" y="1959.1416">ZETA Attestation Service</text><text fill="#000000" font-family="Helvetica" font-size="10" x="194.2065" y="1970.7822">(Admin rights)</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="528.6831" y="1942.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" x="535.6831" y="1959.1416">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="583.4497" y="1942.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" x="632.0439" y="1959.1416">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="590.4497" y="1970.7822">Authorization Server</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="51.5" x="789.9214" y="1942.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" x="796.9214" y="1959.1416">PDP DB</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60.5283" x="876.689" y="1942.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" x="883.689" y="1959.1416">Resource</text><text fill="#000000" font-family="Helvetica" font-size="10" x="890.5566" y="1970.7822">Server</text><path d="M8,105.2031 L67.9561,105.2031 L67.9561,108.8438 L57.9561,118.8438 L8,118.8438 L8,105.2031" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1813.6563" style="stroke:#000000;stroke-width:1.5;" width="1146.7808" x="8" y="105.2031"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="23" y="115.4854">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="82.9561" y="116.4854">[Client has no client_id]</text><line style="stroke:#181818;stroke-width:1;" x1="67" x2="109" y1="158.125" y2="158.125"/><line style="stroke:#181818;stroke-width:1;" x1="109" x2="109" y1="158.125" y2="171.125"/><line style="stroke:#181818;stroke-width:1;" x1="68" x2="109" y1="171.125" y2="171.125"/><polygon fill="#181818" points="78,167.125,68,171.125,78,175.125,74,171.125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="74" y="147.9463">(01)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="98.5273" y="142.126">Generate Client Instance</text><text fill="#000000" font-family="Helvetica" font-size="10" x="98.5273" y="153.7666">Key Pair (for Client Auth)</text><path d="M235.0732,133.8438 L235.0732,166.8438 L596.0732,166.8438 L596.0732,143.8438 L586.0732,133.8438 L235.0732,133.8438" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M586.0732,133.8438 L586.0732,143.8438 L596.0732,143.8438 L586.0732,133.8438" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="241.0732" y="148.126">Key Pair for private_key_jwt</text><text fill="#000000" font-family="Helvetica" font-size="10" x="241.0732" y="159.7666">(could potentially be TPM-backed, but distinct from Attestation Key)</text><polygon fill="#181818" points="624.9243,192.7656,634.9243,196.7656,624.9243,200.7656,628.9243,196.7656" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="67" x2="630.9243" y1="196.7656" y2="196.7656"/><text fill="#000000" font-family="Helvetica" font-size="10" x="74" y="192.4072">(02)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="98.5273" y="192.4072">GET /nonce</text><polygon fill="#181818" points="78,218.4063,68,222.4063,78,226.4063,74,222.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="72" x2="635.9243" y1="222.4063" y2="222.4063"/><text fill="#000000" font-family="Helvetica" font-size="10" x="84" y="218.0479">(03)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="108.5273" y="218.0479">return 200 OK new-nonce: nonce</text><path d="M46,234.4063 L105.9561,234.4063 L105.9561,238.0469 L95.9561,248.0469 L46,248.0469 L46,234.4063" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="644.9375" style="stroke:#000000;stroke-width:1.5;" width="802.0566" x="46" y="234.4063"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="61" y="244.6885">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="120.9561" y="245.6885">[ZETA Attestation Service available]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="46" x2="848.0566" y1="810.4219" y2="810.4219"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="51" y="821.7041">[ZETA Attestation 'Service is not available]</text><polygon fill="#181818" points="213.0732,271.6875,223.0732,275.6875,213.0732,279.6875,217.0732,275.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="67" x2="219.0732" y1="275.6875" y2="275.6875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="74" y="271.3291">(04)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="98.5273" y="271.3291">Get Attestation</text><path d="M214.0732,287.6875 L274.0293,287.6875 L274.0293,291.3281 L264.0293,301.3281 L214.0732,301.3281 L214.0732,287.6875" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="176.4844" style="stroke:#000000;stroke-width:1.5;" width="361.5029" x="214.0732" y="287.6875"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="229.0732" y="297.9697">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="289.0293" y="298.9697">[ZETA TPM Service has no TPM Attestation Key]</text><polygon fill="#181818" points="529.0664,324.9688,539.0664,328.9688,529.0664,332.9688,533.0664,328.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="235.0732" x2="535.0664" y1="328.9688" y2="328.9688"/><text fill="#000000" font-family="Helvetica" font-size="10" x="242.0732" y="324.6104">(05)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="266.6006" y="324.6104">Generate Attestation Key Pair</text><polygon fill="#181818" points="246.0732,350.6094,236.0732,354.6094,246.0732,358.6094,242.0732,354.6094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="240.0732" x2="540.0664" y1="354.6094" y2="354.6094"/><text fill="#000000" font-family="Helvetica" font-size="10" x="252.0732" y="350.251">(06)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="276.6006" y="350.251">Return Attestation Public Key</text><polygon fill="#181818" points="529.0664,376.25,539.0664,380.25,529.0664,384.25,533.0664,380.25" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="235.0732" x2="535.0664" y1="380.25" y2="380.25"/><text fill="#000000" font-family="Helvetica" font-size="10" x="242.0732" y="375.8916">(07)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="266.6006" y="375.8916">Get Certificate Chain</text><polygon fill="#181818" points="246.0732,401.8906,236.0732,405.8906,246.0732,409.8906,242.0732,405.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="240.0732" x2="540.0664" y1="405.8906" y2="405.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" x="252.0732" y="401.5322">(08)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="276.6006" y="401.5322">Return Certificate Chain</text><line style="stroke:#181818;stroke-width:1;" x1="235.0732" x2="277.0732" y1="443.1719" y2="443.1719"/><line style="stroke:#181818;stroke-width:1;" x1="277.0732" x2="277.0732" y1="443.1719" y2="456.1719"/><line style="stroke:#181818;stroke-width:1;" x1="236.0732" x2="277.0732" y1="456.1719" y2="456.1719"/><polygon fill="#181818" points="246.0732,452.1719,236.0732,456.1719,246.0732,460.1719,242.0732,456.1719" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="242.0732" y="432.9932">(09)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="266.6006" y="427.1729">Store AK Handle, AK Public Key</text><text fill="#000000" font-family="Helvetica" font-size="10" x="266.6006" y="438.8135">and Certificate Chain</text><line style="stroke:#181818;stroke-width:1;" x1="235.0732" x2="277.0732" y1="495.8125" y2="495.8125"/><line style="stroke:#181818;stroke-width:1;" x1="277.0732" x2="277.0732" y1="495.8125" y2="508.8125"/><line style="stroke:#181818;stroke-width:1;" x1="236.0732" x2="277.0732" y1="508.8125" y2="508.8125"/><polygon fill="#181818" points="246.0732,504.8125,236.0732,508.8125,246.0732,512.8125,242.0732,508.8125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="242.0732" y="491.4541">(10)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="266.6006" y="491.4541">Select AK Handle</text><line style="stroke:#181818;stroke-width:1;" x1="235.0732" x2="277.0732" y1="534.4531" y2="534.4531"/><line style="stroke:#181818;stroke-width:1;" x1="277.0732" x2="277.0732" y1="534.4531" y2="547.4531"/><line style="stroke:#181818;stroke-width:1;" x1="236.0732" x2="277.0732" y1="547.4531" y2="547.4531"/><polygon fill="#181818" points="246.0732,543.4531,236.0732,547.4531,246.0732,551.4531,242.0732,547.4531" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="242.0732" y="530.0947">(11)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="266.6006" y="530.0947">Get TCG Event Log (from OS/Firmware)</text><polygon fill="#181818" points="529.0664,580.7344,539.0664,584.7344,529.0664,588.7344,533.0664,584.7344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="235.0732" x2="535.0664" y1="584.7344" y2="584.7344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="242.0732" y="574.5557">(12)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="266.6006" y="568.7354">Get TPM Quote for PCRs (4, 5, 7, 10, 11, 22 oder 23)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="266.6006" y="580.376">and nonce, signed with AK</text><path d="M556.0664,560.4531 L556.0664,651.4531 L826.0664,651.4531 L826.0664,570.4531 L816.0664,560.4531 L556.0664,560.4531" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M816.0664,560.4531 L816.0664,570.4531 L826.0664,570.4531 L816.0664,560.4531" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="574.7354">PCR 4: Boot Loader Code, Digest</text><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="586.376">PCR 5: Boot Loader Configuration, Digest</text><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="598.0166">PCR 7: Secure Boot State / Policy, Digest</text><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="609.6572">PCR   10:OS Kernel / IMA, Digest</text><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="621.2979">PCR 11: OS Components / VSM, Digest,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="632.9385">PCR 22 oder 23 (wenn frei) App Data (ID, Version,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="644.5791">Signature Hash),   Digest</text><polygon fill="#181818" points="246.0732,670.5781,236.0732,674.5781,246.0732,678.5781,242.0732,674.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="240.0732" x2="540.0664" y1="674.5781" y2="674.5781"/><text fill="#000000" font-family="Helvetica" font-size="10" x="252.0732" y="670.2197">(13)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="276.6006" y="670.2197">Return TPM Quote</text><path d="M556.0664,661.9375 L556.0664,717.9375 L783.0664,717.9375 L783.0664,671.9375 L773.0664,661.9375 L556.0664,661.9375" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M773.0664,661.9375 L773.0664,671.9375 L783.0664,671.9375 L773.0664,661.9375" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="676.2197">Quote contains:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="687.8604">- nonce</text><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="699.501">- Attested Data (PCR Select, PCR Digest),</text><text fill="#000000" font-family="Helvetica" font-size="10" x="562.0664" y="711.1416">- Signature</text><polygon fill="#181818" points="78,737.1406,68,741.1406,78,745.1406,74,741.1406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="72" x2="224.0732" y1="741.1406" y2="741.1406"/><text fill="#000000" font-family="Helvetica" font-size="10" x="84" y="736.7822">(14)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="108.5273" y="736.7822">Return Attestation</text><line style="stroke:#181818;stroke-width:1;" x1="67" x2="109" y1="778.4219" y2="778.4219"/><line style="stroke:#181818;stroke-width:1;" x1="109" x2="109" y1="778.4219" y2="791.4219"/><line style="stroke:#181818;stroke-width:1;" x1="68" x2="109" y1="791.4219" y2="791.4219"/><polygon fill="#181818" points="78,787.4219,68,791.4219,78,795.4219,74,791.4219" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="74" y="768.2432">(15)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="98.5273" y="762.4229">Create Client Statement</text><text fill="#000000" font-family="Helvetica" font-size="10" x="98.5273" y="774.0635">with posture-tpm</text><line style="stroke:#181818;stroke-width:1;" x1="67" x2="109" y1="858.3438" y2="858.3438"/><line style="stroke:#181818;stroke-width:1;" x1="109" x2="109" y1="858.3438" y2="871.3438"/><line style="stroke:#181818;stroke-width:1;" x1="68" x2="109" y1="871.3438" y2="871.3438"/><polygon fill="#181818" points="78,867.3438,68,871.3438,78,875.3438,74,871.3438" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="74" y="848.165">(16)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="98.5273" y="842.3447">Create Client Statement</text><text fill="#000000" font-family="Helvetica" font-size="10" x="98.5273" y="853.9854">with posture-software</text><polygon fill="#181818" points="624.9243,906.9844,634.9243,910.9844,624.9243,914.9844,628.9243,910.9844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="67" x2="630.9243" y1="910.9844" y2="910.9844"/><text fill="#000000" font-family="Helvetica" font-size="10" x="74" y="906.626">(17)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="98.5273" y="906.626">POST /register (RFC 7591)</text><path d="M72,923.9844 L72,1095.9844 L526,1095.9844 L526,933.9844 L516,923.9844 L72,923.9844" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M516,923.9844 L516,933.9844 L526,933.9844 L516,923.9844" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="78" y="938.2666">DCR Request Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="78" y="949.9072">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="961.5479">"redirect_uris": ["..."],</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="973.1885">"client_name": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="984.8291">"token_endpoint_auth_method": "private_key_jwt",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="996.4697">"grant_types": ["urn:ietf:params:oauth:grant-type:token-exchange","refresh_token"],</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1008.1104">"jwks": { "keys": [ &lt;Client_Instance_Public_Key_JWK&gt; ] },</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1019.751">"nonce": "&lt;nonce&gt;", // Replay protection</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1031.3916">// Custom parameter for attestation:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1043.0322">"urn:gematik:params:oauth:client-attestation-type:tpm2": {</text><text fill="#000000" font-family="Helvetica" font-size="10" x="93.8936" y="1054.6729">"client_statement": "&lt;Base64(Client Statement)&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="93.8936" y="1066.3135">"client_statement_format": "client-statement-jwt"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="87.5361" y="1077.9541">}</text><text fill="#000000" font-family="Helvetica" font-size="10" x="78" y="1089.5947">}</text><line style="stroke:#181818;stroke-width:1;" x1="646.9243" x2="688.9243" y1="1119.5938" y2="1119.5938"/><line style="stroke:#181818;stroke-width:1;" x1="688.9243" x2="688.9243" y1="1119.5938" y2="1132.5938"/><line style="stroke:#181818;stroke-width:1;" x1="647.9243" x2="688.9243" y1="1132.5938" y2="1132.5938"/><polygon fill="#181818" points="657.9243,1128.5938,647.9243,1132.5938,657.9243,1136.5938,653.9243,1132.5938" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="653.9243" y="1115.2354">(18)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="678.4517" y="1115.2354">Validate nonce</text><line style="stroke:#181818;stroke-width:1;" x1="646.9243" x2="688.9243" y1="1169.875" y2="1169.875"/><line style="stroke:#181818;stroke-width:1;" x1="688.9243" x2="688.9243" y1="1169.875" y2="1182.875"/><line style="stroke:#181818;stroke-width:1;" x1="647.9243" x2="688.9243" y1="1182.875" y2="1182.875"/><polygon fill="#181818" points="657.9243,1178.875,647.9243,1182.875,657.9243,1186.875,653.9243,1182.875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="653.9243" y="1159.6963">(19)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="678.4517" y="1153.876">Validate TPM</text><text fill="#000000" font-family="Helvetica" font-size="10" x="678.4517" y="1165.5166">Attestation</text><path d="M755.4712,1145.5938 L755.4712,1201.5938 L1031.4712,1201.5938 L1031.4712,1155.5938 L1021.4712,1145.5938 L755.4712,1145.5938" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1021.4712,1145.5938 L1021.4712,1155.5938 L1031.4712,1155.5938 L1021.4712,1145.5938" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="761.4712" y="1159.876">Check signature against trusted roots</text><text fill="#000000" font-family="Helvetica" font-size="10" x="761.4712" y="1171.5166">(https://go.microsoft.com/fwlink/?linkid=2097925).</text><text fill="#000000" font-family="Helvetica" font-size="10" x="761.4712" y="1183.1572">Extract device/OS/App status.</text><text fill="#000000" font-family="Helvetica" font-size="10" x="761.4712" y="1194.7979">Verify Attestation Key properties.</text><path d="M27,1211.1563 L86.9561,1211.1563 L86.9561,1214.7969 L76.9561,1224.7969 L27,1224.7969 L27,1211.1563" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="693.7031" style="stroke:#000000;stroke-width:1.5;" width="1102.7808" x="27" y="1211.1563"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="42" y="1221.4385">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="101.9561" y="1222.4385">[Attestation valid]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="27" x2="1129.7808" y1="1860.5781" y2="1860.5781"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="32" y="1871.8604">[Attestation invalid]</text><polygon fill="#181818" points="798.6714,1260.0781,808.6714,1264.0781,798.6714,1268.0781,802.6714,1264.0781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="646.9243" x2="804.6714" y1="1264.0781" y2="1264.0781"/><text fill="#000000" font-family="Helvetica" font-size="10" x="653.9243" y="1253.8994">(20)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="678.4517" y="1248.0791">Check if Client</text><text fill="#000000" font-family="Helvetica" font-size="10" x="678.4517" y="1259.7197">already exists</text><polygon fill="#181818" points="657.9243,1285.7188,647.9243,1289.7188,657.9243,1293.7188,653.9243,1289.7188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="651.9243" x2="809.6714" y1="1289.7188" y2="1289.7188"/><text fill="#000000" font-family="Helvetica" font-size="10" x="663.9243" y="1285.3604">(21)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="688.4517" y="1285.3604">&#160;</text><path d="M825.6714,1302.7188 L825.6714,1335.7188 L1051.6714,1335.7188 L1051.6714,1312.7188 L1041.6714,1302.7188 L825.6714,1302.7188" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1041.6714,1302.7188 L1041.6714,1312.7188 L1051.6714,1312.7188 L1041.6714,1302.7188" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1317.001">Check if client_id already exists in DB for</text><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1328.6416">- Client_Instance_Public_Key_JWK</text><path d="M46,1345 L105.9561,1345 L105.9561,1348.6406 L95.9561,1358.6406 L46,1358.6406 L46,1345" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="305.25" style="stroke:#000000;stroke-width:1.5;" width="1058.7808" x="46" y="1345"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="61" y="1355.2822">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="120.9561" y="1356.2822">[Client exists in DB]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="46" x2="1104.7808" y1="1405.2813" y2="1405.2813"/><polygon fill="#181818" points="78,1382.2813,68,1386.2813,78,1390.2813,74,1386.2813" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="72" x2="635.9243" y1="1386.2813" y2="1386.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="84" y="1381.9229">(22)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="108.5273" y="1381.9229">409 Conflict</text><line style="stroke:#181818;stroke-width:1;" x1="646.9243" x2="688.9243" y1="1429.9219" y2="1429.9219"/><line style="stroke:#181818;stroke-width:1;" x1="688.9243" x2="688.9243" y1="1429.9219" y2="1442.9219"/><line style="stroke:#181818;stroke-width:1;" x1="647.9243" x2="688.9243" y1="1442.9219" y2="1442.9219"/><polygon fill="#181818" points="657.9243,1438.9219,647.9243,1442.9219,657.9243,1446.9219,653.9243,1442.9219" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="653.9243" y="1425.5635">(23)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="678.4517" y="1425.5635">Generate client_id</text><polygon fill="#181818" points="798.6714,1476.2031,808.6714,1480.2031,798.6714,1484.2031,802.6714,1480.2031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="646.9243" x2="804.6714" y1="1480.2031" y2="1480.2031"/><text fill="#000000" font-family="Helvetica" font-size="10" x="653.9243" y="1470.0244">(24)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="678.4517" y="1464.2041">Store client metadata,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="678.4517" y="1475.8447">incl. Client Instance Key</text><path d="M825.6714,1493.2031 L825.6714,1619.2031 L1083.6714,1619.2031 L1083.6714,1503.2031 L1073.6714,1493.2031 L825.6714,1493.2031" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1073.6714,1493.2031 L1073.6714,1503.2031 L1083.6714,1503.2031 L1073.6714,1493.2031" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1507.4854">Store client metadata in DB:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1519.126">- client_id</text><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1530.7666">- client_instance_key</text><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1542.4072">- attestation_data</text><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1554.0479">- attestation_key</text><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1565.6885">- redirect_uris</text><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1577.3291">- client_name</text><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1588.9697">- token_endpoint_auth_method</text><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1600.6104">- grant_types</text><text fill="#000000" font-family="Helvetica" font-size="10" x="831.6714" y="1612.251">- state // Client registered but not yet activated</text><polygon fill="#181818" points="657.9243,1638.25,647.9243,1642.25,657.9243,1646.25,653.9243,1642.25" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="651.9243" x2="809.6714" y1="1642.25" y2="1642.25"/><text fill="#000000" font-family="Helvetica" font-size="10" x="663.9243" y="1637.8916">(25)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="688.4517" y="1637.8916">201 Created</text><line style="stroke:#181818;stroke-width:1;" x1="68" x2="78" y1="1681.8906" y2="1677.8906"/><line style="stroke:#181818;stroke-width:1;" x1="68" x2="78" y1="1681.8906" y2="1685.8906"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="67" x2="635.9243" y1="1681.8906" y2="1681.8906"/><text fill="#000000" font-family="Helvetica" font-size="10" x="84" y="1677.5322">(26)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="108.5273" y="1677.5322">201 Created</text><path d="M72,1694.8906 L72,1843.8906 L526,1843.8906 L526,1704.8906 L516,1694.8906 L72,1694.8906" fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><path d="M516,1694.8906 L516,1704.8906 L526,1704.8906 L516,1694.8906" fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="78" y="1709.1729">DCR Response Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="78" y="1720.8135">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1732.4541">"client_id": "&lt;generated-client-id&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1744.0947">"client_id_issued_at": ...,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1755.7354">"client_name": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1767.376">"token_endpoint_auth_method": "private_key_jwt",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1779.0166">"grant_types": ["urn:ietf:params:oauth:grant-type:token-exchange","refresh_token"],</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1790.6572">"jwks": { &lt;Client_Instance_Public_Key_JWK&gt; }, // Confirming registered key</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1802.2979">// ... other registered metadata</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1813.9385">"registration_access_token": "...", // Optional for config updates</text><text fill="#000000" font-family="Helvetica" font-size="10" x="84.3574" y="1825.5791">"registration_client_uri": "..." // Optional for config updates</text><text fill="#000000" font-family="Helvetica" font-size="10" x="78" y="1837.2197">}</text><line style="stroke:#181818;stroke-width:1;" x1="68" x2="78" y1="1896.8594" y2="1892.8594"/><line style="stroke:#181818;stroke-width:1;" x1="68" x2="78" y1="1896.8594" y2="1900.8594"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="67" x2="635.9243" y1="1896.8594" y2="1896.8594"/><text fill="#000000" font-family="Helvetica" font-size="10" x="84" y="1892.501">(27)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="108.5273" y="1892.501">400 Bad Request</text><!--SRC=[jLXjSzku4VwkNx5LFiHAz6OrQIQSQpgsv3XkahDgUNBJgsyq40b9Y4Y01u1sb9lyc_wJ_h7k0YG5IdAkdKupauWYdbtiwxEhiC8gMMGBhg5zCXnssYsp4J9dccMGy2KhKljMIJiJNpcS3eyV_iWo3kzuUi-jY5c0cNZCHoMLoLdCanezLeKMN0VObCkLNPybdmjZGIh9WpF3VosuZFaDNt9D3-SitgoqAcGoLgdIyDDQs51WjY-mys7K6ZpzFQ3TfXmMAarQJmUjrXzopLOP0ylLLx2wuAtMGds1zeUBgpOykLmhO_tz0ExzL8liN__KPciipn3nWTrpcQ2p02NYvulRCnYdWakBvpCca-svLW_I8G3GD0oao9cq9GgOyL9tiXHpK5HB2blxGZ-VpMe9EBEM6ykiK1BTrVSYvdVov2p9X0GjLcjhEkq33RVJZqu3Vj9XTL7rwGDm9XU2MwxHXzkByRiVhpzSN_wz5VfuMJ2T7BeOtdHMsBMtTZgPtadwghJukhENz1z88NPoNad1v3mqiWhpxHMC-aEOOBomf9vCcDxCEBlKd1yBz8qtueORB4qAKNbt8z2r_sLQdZzliRHEqXeLI0Mn-pON2OgM9xqtrLC4brnopIoltboXTKpIZU_v5gPCQ3XPOasNnnIG3cgI2aLSlYAeWOJBjRX7TVCDtyu_FrZ0vCQgI1F8KK9QmT9q2mjEAUqji6zuqeL5OI4HnWePMrXgbJMg1DLt6hRx73r_JjPVtC80spEcSlVlUpllUhq8DBU5bZ0Q3k7wFKZ-q7Fm2BmKYb787YjDOFTCf6oHSXVudGrKqzu2RaD11wirKjrMcifqqAizxyhqaqhKJ81ISvcPFRYBTIb3u9ut9u8Rxse8dnQBLCH7B_6cZpdMt19vaYfWpOJyZk83B06RUXryPfL6gz_3E-opb7VfSMV8dSItZzoB1Trg7QZZASUwgFKT0CYFs_4bNDnJSZwe5LOi5T7rRF1MwEo1QTvf7NEUdFnRGPLCbJiTtnWuUT65brrurSNnWdzFkp0QWKAwXD4VEzvqLpXTC68bUG8FmgxHDgS_R0hK1YyYE5UAJ6AaOOnwkaW0AqpFdIJ0ots0N8fLeLtkciXN58UumBWwWPcbm0rWgZ2gsoOKqFJeUeQnrfAd2BhwUDP4d9v661oyBijniabh4FHfzh42TJrgvpYSF70fiJEvwC1PdiE4MGOdLvCkVEBQaB58K1WFPid2TyoiErsqmwjhxTMJQykofEeC7CJFvoN6-OV5OQ8xsVE1fmTVuHXyRmSPwukawyBkh-rq2LfRjIk09ZySDirUf_kd2CQQ1pJf4f3Xqvrq5P3ZsCLRUZRFYFjJmmyvvMb51OAOm3xABV_TZKOjBPMu7pbxrDoWj4e18C-cHS9zL7EjaYAc0H5-k_TvTQ_yHVJ8WYYr7kFawVKCILdp5J8wbi_9pTinl7hv-hGvDa0jA_4dARrOf0KloUJPimccyOQM8HoLvohPHi-UbMU_bPy0RSqJeJ7hSrpUJ3k2VxJx_Nxxb-uEKSu-YJiUdhlZuDIg3PTp35gk1A8OkZ3FE0xyXC1xWomKN6aSqNExpRc_5WiemjLZ6RajpaIAL4KErIDKv6xgyI_nciaLRtVHT6mcivwxWuR9dnysfFGtQEF5JZtyuECqhqRpt9Ff7Cbq_jUVth-1N-1ReC6r2NdmWtjwq-x2O83Hp5EsfVnQ35bLvlG73yUuvI9XElDfXN9y62GxscadNrSymzURfhi-rhr0glGzpqRaKAqYI8ofIjAPUyuC_zEBa_rwxxm9OdzCU8xMea6aepIYFkfHvdR2trgxJ-wet0QBGrN54NnYgKYez_PMYoC8P31S4nli4JRWUCtZZPiLdXlPYkZCqkBk64mZcnlSaTRMvYOQ35QgdubOA-hgVgoomV8X5N8p-0lzAv8_ZuQlNxqUlUpqx-J55wiP3iQ44waCSDeHDPCPXS5ZP6Qnt1ui3rW0ESrURlhbxXCYxiaj5wJQOx_RkixspeYgSN4SfaXHoHRu5-nru-Gyl5U5AjeZTcfx1oapKQkirrHeAaMomeMQ2hAKwC7tsw7Ua6KrLeATEDHPwZlO6YDuCNpjPZ5gzTEB-Bm9trL2lQQ5Y_PX1AkroAC0sunX_J0SKiJ6_VtrErZP7WyU7DVftTlrRE_0jF1T5SLDVI6T1cqy9vsF73M56eHyU1NHSF3sSVeDG07L1c-DNty6LTIgOOCDHRybQBXkSR_3xd0SNYbiLCL1gRfrO3GyBUTkKc-aZIhPZUTzw7TcsohubRSRRmQtByFtvXiqcB9TPyunvAgijQHN4fr8ckIumy-5CGLFveuNSV0TGnsVY__3PFp_piPmElxkJFpcffxRg7Kcv2giaR1gtVp3082oQnny0Qfgf_1-V-mNz3cBOsvCQMSLHb9tdTCvIzqOZTrI3qLEuy8yggnC2NPEfUe_rVHjd_7SzXcokf07lBuhP7nsb3U4SvPKIrUh_YrMW-X_6rh_1W00]--></g></svg>